<!-- views/product-details.ejs -->
<% const p = product; %>

<!-- Flash -->
<% if (success && success.length > 0) { %>
  <div class="flash flash-success">✅ <%= success %></div>
<% } %>
<% if (error && error.length > 0) { %>
  <div class="flash flash-error">❌ <%= error %></div>
<% } %>

<main class="product-details <%= themeCss && themeCss.includes('dark') ? 'dark-theme' : 'light-theme' %>">
  <article class="pd-wrap">
    <div class="pd-media">
      <img src="<%= p.imageUrl %>" alt="<%= p.name %>" />
    </div>

    <div class="pd-info">
      <h1><%= p.name %></h1>
      <p class="pd-price">R <%= Number(p.price||0).toFixed(2) %></p>
      <p class="pd-stock"><%= (p.stock||0) > 0 ? '✅ In stock' : '❌ Out of stock' %></p>

      <p class="pd-desc"><%= p.description || '' %></p>

      <div class="pd-actions">
        <a class="btn btn-primary"
           href="/api/cart/add?pid=<%= p.customId %>"
           <%= (p.stock||0) > 0 ? '' : 'aria-disabled="true" tabindex="-1"' %>>
          ➕ Add to Cart
        </a>
        <a class="btn" href="/sales">← Back to Shop</a>
      </div>
    </div>
  </article>
</main>

<style nonce="<%= nonce %>">
  .pd-wrap{display:grid;grid-template-columns:1fr 1fr;gap:1.25rem;align-items:start}
  .pd-media img{width:100%;height:auto;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.1)}
  .pd-info h1{margin:0 0 .25rem;font-size:clamp(1.25rem,2.4vw,1.8rem)}
  .pd-price{font-weight:900;color:#2563eb;margin:.25rem 0}
  .pd-stock{font-weight:700;margin:.25rem 0 1rem}
  .pd-actions{display:flex;gap:.6rem}
  .btn{display:inline-block;padding:.6rem 1rem;border-radius:10px;text-decoration:none;border:1px solid #d1d5db}
  .btn-primary{background:#2563eb;color:#fff;border-color:#2563eb}
  .btn[aria-disabled="true"]{background:#9ca3af;border-color:#9ca3af;pointer-events:none}
  @media (max-width:820px){.pd-wrap{grid-template-columns:1fr}}
</style>
