<!-- views/business-verify-pending.ejs -->
<% const NONCE = typeof nonce !== 'undefined' ? nonce : '' %>
<% const b = business || {} %>
<% const role = (b.role || 'buyer') %>

<div class="vp-page <%= themeCss && themeCss.includes('dark') ? 'vp-dark' : 'vp-light' %>">
  <!-- Background decor -->
  <div class="vp-bg" aria-hidden="true">
    <span class="vp-blob vp-blob-1"></span>
    <span class="vp-blob vp-blob-2"></span>
    <span class="vp-blob vp-blob-3"></span>
    <span class="vp-grid"></span>
  </div>

  <main class="vp-wrap">
    <!-- Left: Brand / Steps (collapses on mobile) -->
    <aside class="vp-left">
      <div class="vp-brand">
        <div class="vp-logo" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="22" height="22">
            <path fill="currentColor" d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
          </svg>
        </div>
        <div>
          <div class="vp-brandname">Unicoporate</div>
          <div class="vp-tagline">Business verification</div>
        </div>
      </div>

      <div class="vp-left-card">
        <h2 class="vp-left-title">Almost there ✨</h2>
        <p class="vp-left-sub">
          We sent a verification link to your email. Verify to unlock your dashboard.
        </p>

        <div class="vp-steps">
          <div class="vp-step vp-step-done">
            <span class="vp-step-dot">1</span>
            <div>
              <div class="vp-step-title">Account created</div>
              <div class="vp-step-desc">Your business account is ready</div>
            </div>
          </div>

          <div class="vp-step vp-step-done">
            <span class="vp-step-dot">2</span>
            <div>
              <div class="vp-step-title">Verification sent</div>
              <div class="vp-step-desc">Check your inbox (and spam)</div>
            </div>
          </div>

          <div class="vp-step">
            <span class="vp-step-dot">3</span>
            <div>
              <div class="vp-step-title">Access dashboard</div>
              <div class="vp-step-desc">Start managing products & orders</div>
            </div>
          </div>
        </div>

        <div class="vp-mini">
          <div class="vp-mini-row">
            <span class="vp-mini-label">Business</span>
            <span class="vp-mini-value"><%= b.name || '—' %></span>
          </div>
          <div class="vp-mini-row">
            <span class="vp-mini-label">Role</span>
            <span class="vp-pill vp-pill-<%= role %>"><%= role.toUpperCase() %></span>
          </div>
        </div>

        <div class="vp-benefits">
          <div class="vp-benefit">
            <span class="vp-ic vp-ic-green" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
            </span>
            <div>
              <div class="vp-benefit-title">Full access</div>
              <div class="vp-benefit-desc">Dashboard, products, orders & analytics</div>
            </div>
          </div>

          <div class="vp-benefit">
            <span class="vp-ic vp-ic-blue" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/></svg>
            </span>
            <div>
              <div class="vp-benefit-title">Safer account</div>
              <div class="vp-benefit-desc">Email verification protects your business</div>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Right: Main card -->
    <section class="vp-right">
      <!-- Flash (works even without global flash partial) -->
      <div class="vp-flash">
        <% if (success && success.length) { %>
          <div class="vp-alert vp-alert-success"><%= success[0] %></div>
        <% } %>
        <% if (error && error.length) { %>
          <div class="vp-alert vp-alert-error"><%= error[0] %></div>
        <% } %>
        <% if (warning && warning.length) { %>
          <div class="vp-alert vp-alert-warn"><%= warning[0] %></div>
        <% } %>
        <% if (info && info.length) { %>
          <div class="vp-alert vp-alert-info"><%= info[0] %></div>
        <% } %>
      </div>

      <div class="vp-card">
        <header class="vp-head">
          <div class="vp-head-ic" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="26" height="26">
              <path fill="currentColor" d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V8l8 5 8-5v10zm-8-7L4 6h16l-8 5z"/>
            </svg>
          </div>
          <div>
            <h1 class="vp-title">Verify your email</h1>
            <p class="vp-sub">One last step to unlock your business dashboard.</p>
          </div>
        </header>

        <div class="vp-section vp-section-purple">
          <div class="vp-section-top">
            <div class="vp-section-title">Your email</div>
            <span class="vp-status">
              <span class="vp-status-dot"></span> Pending verification
            </span>
          </div>

          <div class="vp-emailbox">
            <span class="vp-email-ic" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
            </span>
            <div class="vp-email">
              <div class="vp-email-label">Email address</div>
              <div class="vp-email-value"><%= b.email || '—' %></div>
            </div>
          </div>

          <div class="vp-instructions">
            <div class="vp-instr">
              <span class="vp-num">1</span>
              <div><b>Open your inbox</b><div class="vp-muted">Look for “Verify your business email”.</div></div>
            </div>
            <div class="vp-instr">
              <span class="vp-num">2</span>
              <div><b>Click the verification link</b><div class="vp-muted">The link expires for security.</div></div>
            </div>
            <div class="vp-instr">
              <span class="vp-num">3</span>
              <div><b>Return to dashboard</b><div class="vp-muted">You’ll be redirected automatically.</div></div>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <form action="/business/verify/resend" method="post" class="vp-actions" id="resendForm">
          <button type="submit" class="vp-btn vp-btn-primary" id="resendBtn">
            <span class="vp-btn-ic" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18">
                <path fill="currentColor" d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
              </svg>
            </span>
            Resend verification email
          </button>

          <!-- ✅ Gmail + Outlook nearby -->
          <div class="secondary-actions">
            <a href="https://mail.google.com" target="_blank" rel="noreferrer" class="btn btn-secondary">
              Gmail
            </a>

            <a href="https://outlook.live.com/mail/" target="_blank" rel="noreferrer" class="btn btn-secondary">
              Outlook
            </a>

            <a href="/business/change-email" class="btn btn-outline">
              Change email
            </a>

            <a href="/business/logout" class="btn btn-outline">
              Logout
            </a>
          </div>
        </form>

        <div class="vp-section vp-section-blue">
          <div class="vp-support">
            <div>
              <div class="vp-section-title">Need help?</div>
              <div class="vp-muted">If you can’t find the email, check spam/junk, then resend.</div>
            </div>
            <div class="vp-support-links">
              <a href="/business/support" class="vp-link">Contact support</a>
              <a href="/business/faq" class="vp-link">FAQ</a>
            </div>
          </div>
        </div>

        <div class="vp-footnote">
          Tip: search your inbox for <b>Unicoporate</b> or <b>Verify</b>.
        </div>
      </div>
    </section>
  </main>
</div>

<style nonce="<%= NONCE %>">
  :root{
    --blue:#2563EB;
    --purple:#7C3AED;
    --green:#22C55E;
    --black:#0F172A;
    --slate:#475569;
    --line:rgba(148,163,184,.35);
    --card:rgba(255,255,255,.92);
    --card2:rgba(255,255,255,.72);
    --shadow: 0 18px 50px rgba(2,6,23,.18);
    --r:18px;
  }

  .vp-page{ position:relative; min-height:100vh; overflow:hidden; }
  .vp-light{ background: radial-gradient(800px 400px at 20% 10%, rgba(124,58,237,.20), transparent 60%),
                      radial-gradient(900px 500px at 90% 20%, rgba(37,99,235,.18), transparent 60%),
                      radial-gradient(700px 450px at 40% 95%, rgba(34,197,94,.14), transparent 60%),
                      linear-gradient(180deg, #F8FAFF, #EEF2FF 65%, #F1F5F9); }
  .vp-dark{ background: radial-gradient(800px 400px at 20% 10%, rgba(124,58,237,.22), transparent 60%),
                    radial-gradient(900px 500px at 90% 20%, rgba(37,99,235,.18), transparent 60%),
                    radial-gradient(700px 450px at 40% 95%, rgba(34,197,94,.10), transparent 60%),
                    linear-gradient(180deg, #0B1220, #050A14); }

  .vp-bg{ position:absolute; inset:0; pointer-events:none; }
  .vp-blob{ position:absolute; filter: blur(60px); opacity:.45; border-radius:999px; }
  .vp-blob-1{ width:360px;height:360px; background:rgba(124,58,237,.65); top:-120px; left:-120px; }
  .vp-blob-2{ width:320px;height:320px; background:rgba(37,99,235,.55); top:-90px; right:-120px; }
  .vp-blob-3{ width:280px;height:280px; background:rgba(34,197,94,.45); bottom:-120px; left:18%; }
  .vp-grid{
    position:absolute; inset:-2px;
    background-image: linear-gradient(to right, rgba(148,163,184,.10) 1px, transparent 1px),
                      linear-gradient(to bottom, rgba(148,163,184,.10) 1px, transparent 1px);
    background-size: 44px 44px;
    opacity:.35;
    mask-image: radial-gradient(circle at 50% 20%, black 0, transparent 72%);
  }

  .vp-wrap{
    position:relative;
    z-index:2;
    max-width: 1100px;
    margin: 0 auto;
    padding: 18px 14px 28px;
    display:grid;
    grid-template-columns: 1.02fr .98fr;
    gap: 16px;
  }

  /* Mobile first: stack */
  @media (max-width: 980px){
    .vp-wrap{ grid-template-columns: 1fr; gap: 14px; padding: 14px 12px 22px; }
  }

  .vp-left{ display:flex; flex-direction:column; gap:12px; }
  .vp-brand{
    display:flex; align-items:center; gap:10px;
    padding: 10px 10px;
    border-radius: 16px;
    background: rgba(255,255,255,.35);
    border: 1px solid var(--line);
    backdrop-filter: blur(10px);
  }
  .vp-dark .vp-brand{ background: rgba(15,23,42,.45); }
  .vp-logo{
    width:40px;height:40px;border-radius:14px;
    display:grid;place-items:center;
    background: linear-gradient(135deg, rgba(124,58,237,.22), rgba(37,99,235,.18));
    color: var(--purple);
    border: 1px solid rgba(124,58,237,.25);
  }
  .vp-dark .vp-logo{ color:#E9D5FF; border-color: rgba(124,58,237,.25); }
  .vp-brandname{ font-weight: 900; letter-spacing:.2px; color: var(--black); }
  .vp-dark .vp-brandname{ color:#F8FAFC; }
  .vp-tagline{ font-size: 12px; color: var(--slate); font-weight:700; }
  .vp-dark .vp-tagline{ color: rgba(226,232,240,.72); }

  .vp-left-card{
    border-radius: var(--r);
    background: linear-gradient(135deg, rgba(124,58,237,.92), rgba(37,99,235,.78));
    color: #fff;
    padding: 14px;
    box-shadow: var(--shadow);
    border: 1px solid rgba(255,255,255,.22);
  }
  .vp-left-title{ margin:0 0 6px; font-size: 18px; font-weight: 950; }
  .vp-left-sub{ margin:0 0 12px; font-size: 13px; opacity:.92; line-height:1.5; }

  .vp-steps{ display:grid; gap:10px; margin: 10px 0 12px; }
  .vp-step{
    display:flex; gap:10px; align-items:flex-start;
    padding:10px;
    background: rgba(255,255,255,.10);
    border: 1px solid rgba(255,255,255,.14);
    border-radius: 14px;
  }
  .vp-step-dot{
    width:30px;height:30px;border-radius:999px;
    display:grid;place-items:center;
    font-weight: 900;
    background: rgba(255,255,255,.12);
    border: 1px solid rgba(255,255,255,.18);
    flex: 0 0 30px;
  }
  .vp-step-done .vp-step-dot{ background: rgba(34,197,94,.92); border-color: rgba(34,197,94,.35); }
  .vp-step-title{ font-weight: 900; font-size: 13px; }
  .vp-step-desc{ font-size: 12px; opacity:.88; margin-top:2px; }

  .vp-mini{
    margin-top: 8px;
    padding: 10px;
    border-radius: 14px;
    background: rgba(15,23,42,.18);
    border: 1px solid rgba(255,255,255,.16);
  }
  .vp-mini-row{
    display:flex; justify-content:space-between; gap:10px;
    font-size: 12px;
    padding: 6px 0;
    border-bottom: 1px dashed rgba(255,255,255,.22);
  }
  .vp-mini-row:last-child{ border-bottom: none; }
  .vp-mini-label{ opacity:.85; font-weight:800; }
  .vp-mini-value{ font-weight:900; }
  .vp-pill{
    display:inline-flex; align-items:center; justify-content:center;
    padding: 5px 10px;
    border-radius: 999px;
    font-size: 11px;
    font-weight: 950;
    letter-spacing:.3px;
    border: 1px solid rgba(255,255,255,.18);
    background: rgba(255,255,255,.10);
  }
  .vp-pill-seller{ box-shadow: 0 0 0 3px rgba(34,197,94,.15) inset; }
  .vp-pill-supplier{ box-shadow: 0 0 0 3px rgba(124,58,237,.18) inset; }
  .vp-pill-buyer{ box-shadow: 0 0 0 3px rgba(37,99,235,.18) inset; }

  .vp-benefits{ margin-top: 10px; display:grid; gap:10px; }
  .vp-benefit{ display:flex; gap:10px; align-items:flex-start; }
  .vp-ic{
    width:34px;height:34px;border-radius:12px;
    display:grid;place-items:center;
    background: rgba(255,255,255,.12);
    border: 1px solid rgba(255,255,255,.16);
    flex: 0 0 34px;
  }
  .vp-ic-blue{ color:#BFDBFE; }
  .vp-ic-green{ color:#BBF7D0; }
  .vp-benefit-title{ font-weight: 900; font-size: 13px; }
  .vp-benefit-desc{ font-size: 12px; opacity:.88; margin-top:2px; }

  /* Right */
  .vp-right{ display:flex; flex-direction:column; gap:10px; }
  .vp-flash{ display:grid; gap:8px; }
  .vp-alert{
    padding: 10px 12px;
    border-radius: 14px;
    font-weight: 900;
    font-size: 12.5px;
    border: 1px solid rgba(148,163,184,.25);
    background: rgba(255,255,255,.65);
    backdrop-filter: blur(10px);
  }
  .vp-dark .vp-alert{ background: rgba(15,23,42,.55); color:#E2E8F0; border-color: rgba(148,163,184,.18); }
  .vp-alert-success{ border-color: rgba(34,197,94,.35); }
  .vp-alert-error{ border-color: rgba(239,68,68,.35); }
  .vp-alert-warn{ border-color: rgba(245,158,11,.35); }
  .vp-alert-info{ border-color: rgba(37,99,235,.35); }

  .vp-card{
    border-radius: var(--r);
    background: var(--card);
    border: 1px solid var(--line);
    box-shadow: var(--shadow);
    padding: 14px;
    backdrop-filter: blur(10px);
  }
  .vp-dark .vp-card{
    background: rgba(15,23,42,.62);
    border-color: rgba(148,163,184,.18);
  }

  .vp-head{ display:flex; gap:12px; align-items:flex-start; margin-bottom: 10px; }
  .vp-head-ic{
    width:44px;height:44px;border-radius: 16px;
    display:grid; place-items:center;
    color: #fff;
    background: linear-gradient(135deg, var(--purple), var(--blue));
    box-shadow: 0 10px 20px rgba(124,58,237,.22);
    flex: 0 0 44px;
  }
  .vp-title{ margin:0; font-size: 18px; font-weight: 950; color: var(--black); }
  .vp-dark .vp-title{ color:#F8FAFC; }
  .vp-sub{ margin:4px 0 0; font-size: 12.5px; color: var(--slate); font-weight: 700; }
  .vp-dark .vp-sub{ color: rgba(226,232,240,.72); }

  .vp-section{
    border-radius: 16px;
    padding: 12px;
    border: 1px solid var(--line);
    background: var(--card2);
    margin: 10px 0;
  }
  .vp-dark .vp-section{
    background: rgba(2,6,23,.35);
    border-color: rgba(148,163,184,.18);
  }
  .vp-section-purple{ border-color: rgba(124,58,237,.28); }
  .vp-section-blue{ border-color: rgba(37,99,235,.26); }

  .vp-section-top{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom: 10px; }
  .vp-section-title{ font-weight: 950; color: var(--black); }
  .vp-dark .vp-section-title{ color:#F8FAFC; }

  .vp-status{
    display:inline-flex; align-items:center; gap:8px;
    padding: 6px 10px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 900;
    color: rgba(124,58,237,.95);
    background: rgba(124,58,237,.10);
    border: 1px solid rgba(124,58,237,.20);
    white-space: nowrap;
  }
  .vp-dark .vp-status{ color:#E9D5FF; background: rgba(124,58,237,.14); border-color: rgba(124,58,237,.22); }
  .vp-status-dot{ width:8px; height:8px; border-radius:99px; background: var(--purple); box-shadow: 0 0 0 4px rgba(124,58,237,.12); }

  .vp-emailbox{
    display:flex; gap:10px; align-items:center;
    padding: 10px;
    border-radius: 14px;
    background: rgba(255,255,255,.72);
    border: 1px solid rgba(148,163,184,.25);
  }
  .vp-dark .vp-emailbox{ background: rgba(15,23,42,.55); border-color: rgba(148,163,184,.18); }
  .vp-email-ic{ color: var(--blue); }
  .vp-email-label{ font-size: 11px; font-weight: 900; color: var(--slate); }
  .vp-dark .vp-email-label{ color: rgba(226,232,240,.70); }
  .vp-email-value{ font-size: 13px; font-weight: 950; color: var(--black); word-break: break-word; }
  .vp-dark .vp-email-value{ color:#F8FAFC; }

  .vp-instructions{ margin-top: 10px; display:grid; gap:10px; }
  .vp-instr{ display:flex; gap:10px; align-items:flex-start; }
  .vp-num{
    width:28px;height:28px;border-radius: 999px;
    display:grid; place-items:center;
    background: rgba(37,99,235,.12);
    border: 1px solid rgba(37,99,235,.22);
    color: rgba(37,99,235,.95);
    font-weight: 950;
    flex: 0 0 28px;
  }
  .vp-dark .vp-num{ color:#BFDBFE; background: rgba(37,99,235,.16); border-color: rgba(37,99,235,.22); }
  .vp-muted{ font-size: 12px; color: var(--slate); font-weight: 700; margin-top:2px; }
  .vp-dark .vp-muted{ color: rgba(226,232,240,.72); }

  .vp-actions{ margin-top: 8px; }
  .vp-btn{
    width:100%;
    display:inline-flex; align-items:center; justify-content:center;
    gap:10px;
    padding: 11px 12px;
    border-radius: 14px;
    border: 1px solid rgba(148,163,184,.25);
    background: rgba(255,255,255,.70);
    color: var(--black);
    font-weight: 950;
    text-decoration:none;
    cursor:pointer;
    transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
  }
  .vp-dark .vp-btn{ background: rgba(15,23,42,.55); border-color: rgba(148,163,184,.18); color:#F8FAFC; }
  .vp-btn:active{ transform: translateY(1px); }

  .vp-btn-primary{
    background: linear-gradient(135deg, var(--purple), var(--blue));
    color:#fff;
    border-color: rgba(124,58,237,.35);
    box-shadow: 0 12px 26px rgba(124,58,237,.22);
  }
  .vp-btn-primary:hover{ box-shadow: 0 14px 30px rgba(124,58,237,.26); }

  .vp-btn-soft{
    background: rgba(124,58,237,.10);
    border-color: rgba(124,58,237,.22);
    color: rgba(124,58,237,.95);
  }
  .vp-dark .vp-btn-soft{ background: rgba(124,58,237,.14); color:#E9D5FF; }

  .vp-btn-ghost{
    background: transparent;
    border-color: rgba(148,163,184,.25);
    color: var(--slate);
  }
  .vp-dark .vp-btn-ghost{ color: rgba(226,232,240,.72); border-color: rgba(148,163,184,.18); }

  .vp-btn[disabled]{ opacity:.7; cursor:not-allowed; }

  .vp-btn-ic{ display:grid; place-items:center; }

  .vp-mail-links{
    margin-top: 10px;
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }
  .vp-mail-links .vp-btn-ghost{ grid-column: 1 / -1; }

  @media (max-width: 420px){
    .vp-mail-links{ grid-template-columns: 1fr; }
  }

  .vp-dot{ width:10px;height:10px;border-radius:99px; display:inline-block; }
  .vp-dot-gmail{ background: #EA4335; box-shadow: 0 0 0 4px rgba(234,67,53,.14); }
  .vp-dot-outlook{ background: #0A66C2; box-shadow: 0 0 0 4px rgba(10,102,194,.14); }

  .vp-support{
    display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
  }
  .vp-support-links{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; }
  .vp-link{
    font-weight: 950;
    color: rgba(37,99,235,.95);
    text-decoration:none;
    padding: 8px 10px;
    border-radius: 12px;
    border: 1px solid rgba(37,99,235,.22);
    background: rgba(37,99,235,.08);
  }
  .vp-dark .vp-link{ color:#BFDBFE; background: rgba(37,99,235,.14); border-color: rgba(37,99,235,.22); }
  .vp-link:hover{ text-decoration: underline; }

  .vp-footnote{
    margin-top: 10px;
    font-size: 12px;
    color: var(--slate);
    font-weight: 700;
    text-align:center;
  }
  .vp-dark .vp-footnote{ color: rgba(226,232,240,.70); }
</style>

<script nonce="<%= NONCE %>">
  // Disable resend button during submit (prevents double-click)
  (function () {
    const form = document.getElementById('resendForm');
    const btn = document.getElementById('resendBtn');
    if (!form || !btn) return;

    form.addEventListener('submit', function () {
      btn.disabled = true;
      btn.textContent = 'Sending...';
    });
  })();
</script>
