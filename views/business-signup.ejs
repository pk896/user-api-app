<!-- views/business-signup.ejs -->
<section class="auth-page mini">
  <h1 class="page-title">üìÑ Business Sign Up</h1>
  <p class="page-subtitle">
    Create a seller, supplier or buyer account with your real business details.
  </p>

  <!-- ‚úÖ Flash Messages -->
  <%- include('partials/massage', { success, error, info, warning, errors }) %>

  <form
    id="businessSignupForm"
    action="/business/signup"
    method="POST"
    class="auth-form card <%= themeCss && themeCss.includes('dark') ? 'dark-theme' : 'light-theme' %>"
    autocomplete="on"
    novalidate
  >
    <div class="form-group">
      <label for="name">Business name <span class="required">*</span></label>
      <input
        id="name"
        type="text"
        name="name"
        placeholder="Business Name"
        autocomplete="organization"
        required
      />
    </div>

    <div class="form-group">
      <label for="email">Business email <span class="required">*</span></label>
      <input
        id="email"
        type="email"
        name="email"
        placeholder="you@company.com"
        autocomplete="email"
        inputmode="email"
        required
      />
    </div>

    <div class="form-group">
      <label for="password">Password <span class="required">*</span></label>
      <div class="password-row">
        <input
          id="password"
          type="password"
          name="password"
          placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
          autocomplete="new-password"
          minlength="6"
          required
        />
        <button
          type="button"
          class="toggle-password"
          data-target="password"
          aria-label="Show password"
        >üëÅ</button>
      </div>
    </div>

    <div class="form-group">
      <label for="role">Business role <span class="required">*</span></label>
      <select id="role" name="role" required>
        <option value="">Select a role</option>
        <option value="seller">Seller</option>
        <option value="supplier">Supplier</option>
        <option value="buyer">Buyer</option>
      </select>
    </div>

    <div class="form-group">
      <label for="businessNumber">Business number <span class="required">*</span></label>
      <input
        id="businessNumber"
        type="text"
        name="businessNumber"
        placeholder="Business Registration Number"
        autocomplete="off"
        required
      />
    </div>

    <div class="form-group">
      <label for="phone">Business phone <span class="required">*</span></label>
      <input
        id="phone"
        type="tel"
        name="phone"
        placeholder="Phone Number"
        autocomplete="tel"
        required
      />
    </div>

    <div class="form-group">
      <label for="country">Country <span class="required">*</span></label>
      <input
        id="country"
        type="text"
        name="country"
        placeholder="Country"
        autocomplete="country-name"
        required
      />
    </div>

    <div class="form-group">
      <label for="city">City <span class="required">*</span></label>
      <input
        id="city"
        type="text"
        name="city"
        placeholder="City"
        autocomplete="address-level2"
        required
      />
    </div>

    <div class="form-group">
      <label for="address">Address <span class="required">*</span></label>
      <input
        id="address"
        type="text"
        name="address"
        placeholder="Business Address"
        autocomplete="street-address"
        required
      />
    </div>

    <div class="form-group">
      <label for="idOrPassport">ID or Passport <span class="required">*</span></label>
      <input
        id="idOrPassport"
        type="text"
        name="idOrPassport"
        placeholder="ID or Passport Number"
        autocomplete="off"
        required
      />
    </div>

    <button type="submit" class="btn xs primary wfull">Sign up</button>
  </form>

  <p class="auth-switch">
    Already have an account?
    <a href="/business/login">Log in here</a>
  </p>
</section>

<style nonce="<%= typeof nonce !== 'undefined' ? nonce : '' %>">
  .auth-page.mini {
    max-width: 380px;
    margin: .9rem auto 1.2rem;
    padding: .7rem .7rem 1rem;
    border-radius: 14px;
    background: linear-gradient(135deg, #e0f2ff, #eff6ff);
  }
  .dark-theme .auth-page.mini {
    background: radial-gradient(circle at top, #0f172a, #020617);
  }

  .page-title {
    text-align: center;
    font-size: 1.05rem;
    font-weight: 800;
    margin: .1rem 0 .25rem;
    color: #0f172a;
  }
  .page-subtitle {
    text-align: center;
    font-size: .78rem;
    color: #4b5563;
    margin: 0 0 .6rem;
  }
  .dark-theme .page-title { color: #e5e7eb; }
  .dark-theme .page-subtitle { color: #9ca3af; }

  .card {
    background: #eff6ff;
    border: 1px solid #bfdbfe;
    border-radius: 10px;
    padding: .75rem .75rem;
    box-shadow: 0 1px 3px rgba(15,23,42,.12);
  }
  .dark-theme.card {
    background: #020617;
    border-color: #1e3a8a;
    color: #e5e7eb;
  }

  .auth-form {
    display: grid;
    gap: .55rem;
  }

  .form-group {
    margin: 0;
    display: grid;
    gap: .25rem;
  }

  .form-group label {
    font-weight: 700;
    font-size: .82rem;
    color: #111827;
  }
  .dark-theme .form-group label {
    color: #e5e7eb;
  }

  input,
  select {
    width: 100%;
    padding: .42rem .5rem;
    border: 1px solid #bfdbfe;
    border-radius: 8px;
    font-size: .82rem;
    background: #ffffff;
    color: #0f172a;
    box-sizing: border-box;
  }
  input::placeholder,
  select::placeholder {
    font-size: .78rem;
    color: #9ca3af;
  }
  .dark-theme input,
  .dark-theme select {
    background: #020617;
    border-color: #1e3a8a;
    color: #e5e7eb;
  }
  .dark-theme input::placeholder,
  .dark-theme select::placeholder {
    color: #6b7280;
  }

  input:focus,
  select:focus {
    outline: none;
    border-color: #2563eb;
    box-shadow: 0 0 0 1px rgba(37,99,235,.35);
    background: #eff6ff;
  }
  .dark-theme input:focus,
  .dark-theme select:focus {
    background: #020617;
  }

  .password-row {
    position: relative;
    display: flex;
    align-items: center;
  }

  .password-row input {
    padding-right: 2rem;
  }

  .toggle-password {
    position: absolute;
    right: .4rem;
    top: 50%;
    transform: translateY(-50%);
    border: none;
    background: transparent;
    cursor: pointer;
    font-size: .9rem;
    padding: 0;
    line-height: 1;
  }

  .btn {
    display: inline-block;
    text-align: center;
    text-decoration: none;
    border-radius: 8px;
    padding: .4rem .55rem;
    font-size: .75rem;
    font-weight: 700;
    border: 1px solid transparent;
  }
  .btn.xs { padding: .34rem .48rem; font-size: .7rem; border-radius: 7px; }
  .btn.wfull { width: 100%; }
  .btn.primary {
    background: #2563eb;
    border-color: #2563eb;
    color: #ffffff;
  }
  .btn.primary:hover {
    filter: brightness(0.96);
  }

  .required { color: #e11d48; }

  .flash {
    margin: .35rem 0;
    padding: .5rem .6rem;
    border-radius: .6rem;
    font-size: .8rem;
  }
  .flash-success {
    background:#ecfdf5;
    color:#065f46;
    border:1px solid #a7f3d0;
  }
  .flash-error {
    background:#fef2f2;
    color:#991b1b;
    border:1px solid #fecaca;
  }

  .auth-switch {
    margin-top: .7rem;
    text-align: center;
    font-size: .82rem;
  }
  .auth-switch a {
    color: #2563eb;
    text-decoration: none;
    font-weight: 600;
  }
  .auth-switch a:hover { text-decoration: underline; }

  @media (max-width: 360px) {
    .auth-page.mini {
      max-width: 100%;
      margin: .5rem .3rem .9rem;
      padding: .6rem .45rem .9rem;
    }
    .page-title { font-size: .98rem; }
    .page-subtitle { font-size: .74rem; }
    input,
    select {
      font-size: .8rem;
      padding: .38rem .45rem;
    }
    .btn.xs {
      font-size: .68rem;
      padding: .32rem .44rem;
    }
  }
</style>

<script nonce="<%= typeof nonce !== 'undefined' ? nonce : '' %>">
  (function () {
    console.log("‚úÖ Business signup loaded with CSP nonce");

    const form = document.getElementById("businessSignupForm");
    if (form) {
      form.addEventListener("submit", (e) => {
        const requiredFields = form.querySelectorAll("[required]");
        let valid = true;

        requiredFields.forEach((field) => {
          const value = (field.value || "").trim();
          if (!value) {
            valid = false;
            field.style.borderColor = "#dc2626"; // red
          } else {
            field.style.borderColor = "#bfdbfe"; // default blue
          }
        });

        if (!valid) {
          e.preventDefault();
          alert("‚ö†Ô∏è Please fill in all required fields before submitting.");
        }
      });
    }

    // üëÅ Show/hide password
    document.querySelectorAll(".toggle-password").forEach((btn) => {
      const targetId = btn.getAttribute("data-target");
      const input = document.getElementById(targetId);
      if (!input) return;

      btn.addEventListener("click", () => {
        const isPwd = input.type === "password";
        input.type = isPwd ? "text" : "password";
        btn.textContent = isPwd ? "üôà" : "üëÅ";
      });
    });
  })();
</script>
