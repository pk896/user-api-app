<!-- views/business-profile.ejs -->
<div class="bp <%= themeCss.includes('dark') ? 'dark-theme' : 'light-theme' %>">
  <h1 class="bp-title">Business Profile</h1>
  <p class="bp-subtitle">
    Manage your business details and email verification
  </p>

  <!-- Flash messages -->
  <% (success || []).forEach(msg => { %>
    <div class="fm fm-success">✅ <%= msg %></div>
  <% }) %>
  <% (error || []).forEach(msg => { %>
    <div class="fm fm-error">❌ <%= msg %></div>
  <% }) %>

  <% const isVerified = business && business.isVerified; %>

  <!-- Profile Content -->
  <div class="bp-content">
    <!-- Left Column: Business Details -->
    <div class="bp-card bp-details">
      <div class="bp-card-header">
        <h2 class="bp-card-title">Business Details</h2>
        <span class="bp-role bp-role-<%= business.role %>">
          <%= business.role && business.role.toUpperCase() %>
        </span>
      </div>

      <div class="bp-details-grid">
        <div class="bp-detail">
          <span class="bp-detail-label">Business Name</span>
          <strong class="bp-detail-value"><%= business.name %></strong>
        </div>

        <div class="bp-detail">
          <span class="bp-detail-label">Email</span>
          <div class="bp-detail-email">
            <span class="bp-detail-value"><%= business.email %></span>
            <% if (isVerified) { %>
              <span class="bp-badge bp-badge-success">Verified</span>
            <% } else { %>
              <span class="bp-badge bp-badge-warning">Not Verified</span>
            <% } %>
          </div>
        </div>

        <div class="bp-detail">
          <span class="bp-detail-label">Business Number</span>
          <span class="bp-detail-value"><%= business.businessNumber %></span>
        </div>

        <div class="bp-detail">
          <span class="bp-detail-label">Phone</span>
          <span class="bp-detail-value"><%= business.phone %></span>
        </div>

        <div class="bp-detail">
          <span class="bp-detail-label">Country</span>
          <span class="bp-detail-value"><%= business.country %></span>
        </div>

        <div class="bp-detail">
          <span class="bp-detail-label">City</span>
          <span class="bp-detail-value"><%= business.city %></span>
        </div>

        <div class="bp-detail">
          <span class="bp-detail-label">Address</span>
          <span class="bp-detail-value"><%= business.address %></span>
        </div>

        <div class="bp-detail">
          <span class="bp-detail-label">ID / Passport</span>
          <span class="bp-detail-value"><%= business.idOrPassport %></span>
        </div>
      </div>
    </div>

    <!-- Right Column: Verification & Actions -->
    <div class="bp-card bp-verification">
      <div class="bp-card-header">
        <h2 class="bp-card-title">Email Verification</h2>
      </div>

      <% if (isVerified) { %>
        <div class="bp-verified">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <div>
            <p class="bp-verified-title">Email Verified</p>
            <p class="bp-verified-text">
              All business dashboards are fully available to you.
            </p>
          </div>
        </div>
      <% } else { %>
        <div class="bp-unverified">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-2.268-.833-3.036 0L4.33 16.5c-.77.833.192 2.5 1.732 2.5z" 
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <div>
            <p class="bp-unverified-title">Verification Required</p>
            <p class="bp-unverified-text">
              Full dashboard access requires email verification.
            </p>
          </div>
        </div>

        <div class="bp-verify-actions">
          <a href="/business/verify/start" class="bp-btn bp-btn-primary">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="none" aria-hidden="true">
              <path d="M2 2h2l.8 4m1 6h8l2-8H4.8M5 10l-.6 1.8c-.2.6.1 1.2.7 1.2h8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="6.5" cy="13.5" r="1.5" stroke="currentColor" stroke-width="1.5"/>
              <circle cx="12.5" cy="13.5" r="1.5" stroke="currentColor" stroke-width="1.5"/>
            </svg>
            Send Verification Email
          </a>
          <a href="/business/verify/pending" class="bp-btn bp-btn-secondary">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="none" aria-hidden="true">
              <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5"/>
              <path d="M8 5v3l2 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Check Status / Resend
          </a>
        </div>

        <p class="bp-hint">
          Check your spam folder if you don't see the email. Use "Check Status" to request a new link.
        </p>
      <% } %>

      <hr class="bp-divider">

      <!-- Profile Actions -->
      <div class="bp-actions">
        <a href="/business/profile/edit" class="bp-btn bp-btn-action">
          <svg width="14" height="14" viewBox="0 0 16 16" fill="none" aria-hidden="true">
            <path d="M11.5 2.5l2 2L5.5 13.5H3.5v-2L11.5 2.5z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Edit Profile
        </a>
        <a href="/business/change-password" class="bp-btn bp-btn-action">
          <svg width="14" height="14" viewBox="0 0 16 16" fill="none" aria-hidden="true">
            <path d="M4 8h8m-4-4V2M8 6v4m6 2a6 6 0 11-12 0 6 6 0 0112 0z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Change Password
        </a>
        <form id="bp-delete-form" action="/business/profile/delete" method="POST" class="bp-delete-form">
          <button type="submit" class="bp-btn bp-btn-danger">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="none" aria-hidden="true">
              <path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            Delete Account
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<style nonce="<%= nonce %>">
  /* ===== COMPANY COLORS & VARIABLES ===== */
  .bp {
    --blue: #2563EB;
    --purple: #7C3AED;
    --green: #22C55E;
    --black: #0F172A;
    --radius: 10px;
    --transition: all 0.2s ease;
  }

  /* ===== MAIN CONTAINER ===== */
  .bp {
    max-width: 1000px;
    margin: 0 auto;
    padding: 16px;
    min-height: 100vh;
  }

  /* ===== HEADER ===== */
  .bp-title {
    font-size: 20px;
    font-weight: 700;
    text-align: center;
    margin: 0 0 8px 0;
    color: var(--black);
  }

  .bp-subtitle {
    text-align: center;
    margin: 0 0 24px 0;
    color: #64748B;
    font-size: 14px;
  }

  .dark-theme .bp-title {
    color: #F1F5F9;
  }

  .dark-theme .bp-subtitle {
    color: #94A3B8;
  }

  /* ===== CONTENT LAYOUT ===== */
  .bp-content {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
    margin-top: 20px;
  }

  @media (min-width: 768px) {
    .bp-content {
      grid-template-columns: 1.5fr 1fr;
    }
  }

  /* ===== CARDS ===== */
  .bp-card {
    background: #FFFFFF;
    border: 1px solid #D1FAE5;
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: 0 2px 8px rgba(34, 197, 94, 0.08);
  }

  .dark-theme .bp-card {
    background: #132813;
    border-color: #2D5A2D;
    box-shadow: 0 2px 8px rgba(34, 197, 94, 0.12);
  }

  .bp-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 2px solid #D1FAE5;
  }

  .bp-card-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--black);
    margin: 0;
  }

  .dark-theme .bp-card-title {
    color: #F1F5F9;
  }

  /* ===== ROLE BADGE ===== */
  .bp-role {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .bp-role-seller {
    background: rgba(37, 99, 235, 0.1);
    color: var(--blue);
  }

  .bp-role-supplier {
    background: rgba(34, 197, 94, 0.1);
    color: var(--green);
  }

  .bp-role-buyer {
    background: rgba(124, 58, 237, 0.1);
    color: var(--purple);
  }

  /* ===== DETAILS GRID ===== */
  .bp-details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 16px;
  }

  @media (max-width: 480px) {
    .bp-details-grid {
      grid-template-columns: 1fr;
    }
  }

  .bp-detail {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .bp-detail-label {
    font-size: 12px;
    font-weight: 500;
    color: #64748B;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .bp-detail-value {
    font-size: 14px;
    font-weight: 600;
    color: var(--black);
    word-break: break-word;
  }

  .dark-theme .bp-detail-value {
    color: #F1F5F9;
  }

  .bp-detail-email {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  @media (min-width: 480px) {
    .bp-detail-email {
      flex-direction: row;
      align-items: center;
      flex-wrap: wrap;
    }
  }

  /* ===== BADGES ===== */
  .bp-badge {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
  }

  .bp-badge-success {
    background: rgba(34, 197, 94, 0.1);
    color: var(--green);
    border: 1px solid rgba(34, 197, 94, 0.2);
  }

  .bp-badge-warning {
    background: rgba(245, 158, 11, 0.1);
    color: #F59E0B;
    border: 1px solid rgba(245, 158, 11, 0.2);
  }

  /* ===== VERIFICATION STATES ===== */
  .bp-verified,
  .bp-unverified {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin-bottom: 20px;
  }

  .bp-verified svg {
    color: var(--green);
    flex-shrink: 0;
  }

  .bp-unverified svg {
    color: #F59E0B;
    flex-shrink: 0;
  }

  .bp-verified-title,
  .bp-unverified-title {
    font-size: 14px;
    font-weight: 600;
    margin: 0 0 4px 0;
    color: var(--black);
  }

  .bp-verified-text,
  .bp-unverified-text {
    font-size: 13px;
    color: #64748B;
    margin: 0;
    line-height: 1.4;
  }

  .dark-theme .bp-verified-title,
  .dark-theme .bp-unverified-title {
    color: #F1F5F9;
  }

  .dark-theme .bp-verified-text,
  .dark-theme .bp-unverified-text {
    color: #94A3B8;
  }

  /* ===== VERIFICATION ACTIONS ===== */
  .bp-verify-actions {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
    margin-bottom: 16px;
  }

  @media (min-width: 480px) {
    .bp-verify-actions {
      grid-template-columns: 1fr 1fr;
    }
  }

  /* ===== HINT TEXT ===== */
  .bp-hint {
    font-size: 12px;
    color: #64748B;
    line-height: 1.4;
    margin: 0;
    font-style: italic;
  }

  .dark-theme .bp-hint {
    color: #94A3B8;
  }

  /* ===== DIVIDER ===== */
  .bp-divider {
    border: none;
    border-top: 1px dashed #D1FAE5;
    margin: 20px 0;
  }

  .dark-theme .bp-divider {
    border-color: #2D5A2D;
  }

  /* ===== ACTIONS ===== */
  .bp-actions {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  @media (min-width: 480px) {
    .bp-actions {
      flex-direction: row;
      flex-wrap: wrap;
    }
  }

  /* ===== BUTTONS ===== */
  .bp-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px 16px;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 600;
    text-decoration: none;
    border: 1px solid transparent;
    cursor: pointer;
    transition: var(--transition);
    white-space: nowrap;
    flex: 1;
  }

  @media (min-width: 480px) {
    .bp-btn {
      flex: 0 1 auto;
    }
  }

  .bp-btn-primary {
    background: linear-gradient(135deg, var(--blue) 0%, var(--purple) 100%);
    color: white;
  }

  .bp-btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
  }

  .bp-btn-secondary {
    background: #FFFFFF;
    color: var(--blue);
    border-color: #D1FAE5;
  }

  .bp-btn-secondary:hover {
    background: #F8FAFC;
    border-color: var(--blue);
  }

  .bp-btn-action {
    background: rgba(34, 197, 94, 0.1);
    color: var(--green);
    border-color: rgba(34, 197, 94, 0.2);
  }

  .bp-btn-action:hover {
    background: rgba(34, 197, 94, 0.2);
    border-color: var(--green);
  }

  .bp-btn-danger {
    background: rgba(239, 68, 68, 0.1);
    color: #EF4444;
    border-color: rgba(239, 68, 68, 0.2);
  }

  .bp-btn-danger:hover {
    background: rgba(239, 68, 68, 0.2);
    border-color: #EF4444;
  }

  .dark-theme .bp-btn-secondary {
    background: #1A341A;
    color: #60A5FA;
    border-color: #2D5A2D;
  }

  .dark-theme .bp-btn-secondary:hover {
    background: #2D5A2D;
    border-color: var(--blue);
  }

  .dark-theme .bp-btn-action {
    background: rgba(34, 197, 94, 0.15);
    color: #22C55E;
    border-color: #2D5A2D;
  }

  .dark-theme .bp-btn-action:hover {
    background: rgba(34, 197, 94, 0.25);
    border-color: #22C55E;
  }

  /* ===== FLASH MESSAGES ===== */
  .fm {
    position: relative;
    padding: 12px 16px;
    border-radius: var(--radius);
    font-size: 13px;
    font-weight: 500;
    margin-bottom: 12px;
    animation: slideIn 0.3s ease-out;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  .fm-success {
    background: rgba(34, 197, 94, 0.1);
    color: #065F46;
    border: 1px solid rgba(34, 197, 94, 0.2);
  }

  .fm-error {
    background: rgba(239, 68, 68, 0.1);
    color: #991B1B;
    border: 1px solid rgba(239, 68, 68, 0.2);
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* ===== COMPACT MOBILE DESIGN ===== */
  @media (max-width: 360px) {
    .bp {
      padding: 12px;
    }
    
    .bp-card {
      padding: 16px;
    }
    
    .bp-title {
      font-size: 18px;
    }
    
    .bp-btn {
      padding: 10px;
      font-size: 12px;
    }
  }

  /* ===== DELETE FORM CONFIRMATION ===== */
  .bp-delete-form {
    width: 100%;
  }

  @media (min-width: 480px) {
    .bp-delete-form {
      width: auto;
    }
  }
</style>

<script nonce="<%= nonce %>">
document.addEventListener("DOMContentLoaded", () => {
  // Delete account confirmation
  const deleteForm = document.getElementById('bp-delete-form');
  if (deleteForm) {
    deleteForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Custom confirmation modal
      const confirmed = confirm(
        '⚠️ Are you sure you want to delete your business account?\n\n' +
        'This will permanently delete:\n' +
        '• Your business profile\n' +
        '• All products and listings\n' +
        '• Business dashboard access\n\n' +
        'This action cannot be undone.'
      );
      
      if (confirmed) {
        // Add loading state
        const submitBtn = this.querySelector('.bp-btn-danger');
        const originalHTML = submitBtn.innerHTML;
        submitBtn.innerHTML = `
          <svg width="14" height="14" viewBox="0 0 16 16" fill="none" aria-hidden="true">
            <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5" stroke-dasharray="20"/>
          </svg>
          Deleting...
        `;
        submitBtn.disabled = true;
        
        // Submit after delay
        setTimeout(() => {
          this.submit();
        }, 500);
      }
    });
  }
  
  // Add visual feedback to buttons
  const buttons = document.querySelectorAll('.bp-btn');
  buttons.forEach(btn => {
    btn.addEventListener('click', function(e) {
      if (!this.classList.contains('disabled')) {
        // Add click animation
        this.style.transform = 'scale(0.98)';
        setTimeout(() => {
          this.style.transform = '';
        }, 150);
      }
    });
  });
  
  // Add copy functionality to email
  const emailElement = document.querySelector('.bp-detail-email .bp-detail-value');
  if (emailElement) {
    emailElement.style.cursor = 'pointer';
    emailElement.title = 'Click to copy email';
    
    emailElement.addEventListener('click', function() {
      const email = this.textContent.trim();
      navigator.clipboard.writeText(email).then(() => {
        const originalText = this.textContent;
        this.textContent = 'Copied!';
        this.style.color = 'var(--green)';
        
        setTimeout(() => {
          this.textContent = originalText;
          this.style.color = '';
        }, 2000);
      });
    });
  }
  
  // Add animations
  const cards = document.querySelectorAll('.bp-card');
  cards.forEach((card, index) => {
    card.style.animationDelay = `${index * 0.1}s`;
    card.style.opacity = '0';
    card.style.transform = 'translateY(20px)';
    card.style.animation = 'cardSlideIn 0.4s ease-out forwards';
  });
  
  // Add animation CSS
  const style = document.createElement('style');
  style.textContent = `
    @keyframes cardSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  `;
  document.head.appendChild(style);
});
</script>