<!-- views/users-login.ejs -->
<section class="u-login-shell">
  <div class="u-login-page">
    <!-- Soft brand background -->
    <div class="u-login-bg">
      <div class="u-bg-circle u-bg-blue"></div>
      <div class="u-bg-circle u-bg-purple"></div>
      <div class="u-bg-circle u-bg-green"></div>
    </div>

    <!-- Main card -->
    <div class="u-login-card">
      <!-- HERO (top on mobile, left on desktop) -->
      <div class="u-login-hero">
        <div class="u-hero-inner">
          <div class="u-hero-brand">
            <div class="u-hero-logo">
              <svg viewBox="0 0 24 24" width="26" height="26">
                <path fill="currentColor" d="M12 2C6.49 2 2 6.48 2 12s4.49 10 10 10 10-4.48 10-10S17.51 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
            </div>
            <div class="u-hero-text">
              <span class="u-hero-sub">User portal</span>
              <h1 class="u-hero-title">Unicoporate.com</h1>
            </div>
          </div>

          <div class="u-hero-copy">
            <h2>Welcome back üëã</h2>
            <p>Sign in to access your dashboard, orders, and wishlist.</p>
          </div>

          <div class="u-hero-pills">
            <div class="u-hero-pill">
              <span class="u-dot u-dot-blue"></span>
              <div>
                <div class="u-pill-title">Secure sessions</div>
                <div class="u-pill-text">Encrypted logins, device-aware.</div>
              </div>
            </div>
            <div class="u-hero-pill">
              <span class="u-dot u-dot-purple"></span>
              <div>
                <div class="u-pill-title">Unified account</div>
                <div class="u-pill-text">Track orders & payments easily.</div>
              </div>
            </div>
            <div class="u-hero-pill">
              <span class="u-dot u-dot-green"></span>
              <div>
                <div class="u-pill-title">Built for growth</div>
                <div class="u-pill-text">For entrepreneurs & shoppers.</div>
              </div>
            </div>
          </div>

          <div class="u-hero-footer">
            <span class="u-hero-footer-text">New to the platform?</span>
            <a href="/users/signup" class="u-btn-secondary u-btn-small">
              <svg viewBox="0 0 24 24" width="16" height="16">
                <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
              </svg>
              Create account
            </a>
          </div>
        </div>
      </div>

      <!-- FORM -->
      <div class="u-login-main">
        <div class="u-login-main-inner">
          <header class="u-form-header">
            <h2>Sign in</h2>
            <p>Use your username and password to continue.</p>
          </header>

          <!-- Page-local flash -->
          <% (success || []).forEach(msg => { %>
            <div class="u-flash u-flash-success">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              <span><%= msg %></span>
            </div>
          <% }) %>

          <% (error || []).forEach(msg => { %>
            <div class="u-flash u-flash-error">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
              </svg>
              <span><%= msg %></span>
            </div>
          <% }) %>

          <form action="/users/login" method="POST" class="u-login-form" id="loginForm" novalidate>
            <!-- Username -->
            <div class="u-form-group">
              <label for="login-username" class="u-form-label">
                Username <span class="u-required">*</span>
              </label>
              <div class="u-input-wrapper u-username-pill">
                <span class="u-username-prefix">@</span>
                <input
                  id="login-username"
                  type="text"
                  name="username"
                  class="u-form-input"
                  autocomplete="username"
                  placeholder="e.g. phakisi.dev"
                  minlength="3"
                  maxlength="30"
                  required
                />
              </div>
              <div class="u-form-hint">
                3‚Äì30 characters. Letters, numbers, dots (<code>.</code>), underscores (<code>_</code>) or dashes (<code>-</code>). No spaces.
              </div>
            </div>

            <!-- Password -->
            <div class="u-form-group">
              <label for="login-password" class="u-form-label">
                Password <span class="u-required">*</span>
              </label>
              <div class="u-input-wrapper u-password-wrapper">
                <input
                  id="login-password"
                  type="password"
                  name="password"
                  class="u-form-input"
                  autocomplete="current-password"
                  placeholder="Your password"
                  minlength="6"
                  required
                />
                <button
                  type="button"
                  class="u-toggle-password"
                  id="showPasswordBtn"
                  aria-label="Toggle password visibility"
                >
                  <svg class="u-eye-icon" viewBox="0 0 24 24" width="20" height="20">
                    <path fill="currentColor" d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                  </svg>
                </button>
              </div>
              <div class="u-form-actions-row">
                <label class="u-checkbox-label">
                  <input type="checkbox" id="login-remember" name="remember" value="1" />
                  <span class="u-checkbox-custom"></span>
                  <span class="u-checkbox-text">Remember this device</span>
                </label>

                <div class="u-links-row">
                  <a href="/users/username/forgot" class="u-link-small">Forgot username?</a>
                  <span class="u-link-dot">¬∑</span>
                  <a href="/users/password/forgot" class="u-link-small">Forgot password?</a>
                </div>
              </div>
            </div>

            <!-- Submit -->
            <button type="submit" class="u-btn-primary u-full-width">
              <svg viewBox="0 0 24 24" width="18" height="18">
                <path fill="currentColor" d="M10 17v-3H3v-4h7V7l5 5-5 5z"/>
              </svg>
              <span>Sign in</span>
            </button>

            <!-- Security note -->
            <div class="u-security-note">
              <svg viewBox="0 0 24 24" width="16" height="16">
                <path fill="currentColor" d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
              </svg>
              <span>Your session is protected with secure encryption.</span>
            </div>

            <!-- Social Login -->
            <div class="u-social-login">
              <div class="u-divider">
                <span>Or continue with</span>
              </div>
              <a href="/auth/google" class="u-social-btn">
                <svg viewBox="0 0 24 24" width="18" height="18">
                  <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                  <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                  <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                  <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                <span>Continue with Google</span>
              </a>
              <p class="u-social-note">
                If you signed up with Google, use this option to sign in.
              </p>
            </div>

            <!-- Demo credentials -->
            <div class="u-demo-box">
              <details class="u-demo-details">
                <summary class="u-demo-summary">
                  <svg viewBox="0 0 24 24" width="16" height="16">
                    <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                  </svg>
                  <span>Quick demo login</span>
                </summary>
                <div class="u-demo-body">
                  <p>Use these credentials in development/testing:</p>
                  <div class="u-demo-creds">
                    <div class="u-cred-row">
                      <span>Username</span>
                      <code>demo_user</code>
                    </div>
                    <div class="u-cred-row">
                      <span>Password</span>
                      <code>demo123</code>
                    </div>
                  </div>
                  <button type="button" class="u-demo-btn" id="fillDemoBtn">
                    Fill demo credentials
                  </button>
                </div>
              </details>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .u-login-shell {
    box-sizing: border-box;
    width: 100%;
    display: flex;
    justify-content: center;
    padding: 12px 8px;
  }

  .u-login-page {
    position: relative;
    width: 100%;
    max-width: 960px;
  }

  .u-login-bg {
    position: absolute;
    inset: 0;
    overflow: hidden;
    pointer-events: none;
    z-index: 0;
  }

  .u-bg-circle {
    position: absolute;
    border-radius: 999px;
    filter: blur(80px);
    opacity: 0.35;
  }

  .u-bg-blue   { width: 260px; height: 260px; background:#2563EB; top:-80px; right:-120px; }
  .u-bg-purple { width: 220px; height:220px; background:#7C3AED; bottom:-120px; left:-120px; }
  .u-bg-green  { width: 180px; height:180px; background:#22C55E; top:45%; left:10%; }

  .u-login-card {
    position: relative;
    z-index: 1;
    display: grid;
    grid-template-columns: minmax(0, 1.05fr) minmax(0, 1fr);
    background:#fff;
    border-radius:18px;
    box-shadow:0 16px 40px rgba(15,23,42,0.18);
    overflow:hidden;
    width:100%;
  }

  /* HERO */
  .u-login-hero {
    background: radial-gradient(circle at top left, #2563EB 0%, #7C3AED 45%, #0F172A 100%);
    color:#fff;
    padding:18px 18px 16px;
    display:flex;
    align-items:stretch;
  }

  .u-hero-inner {
    display:flex;
    flex-direction:column;
    gap:14px;
    width:100%;
  }

  .u-hero-brand {
    display:flex;
    align-items:center;
    gap:10px;
  }

  .u-hero-logo {
    width:40px;
    height:40px;
    border-radius:14px;
    background:rgba(15,23,42,0.45);
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .u-hero-logo svg { color:#22C55E; }

  .u-hero-sub {
    font-size:10px;
    text-transform:uppercase;
    letter-spacing:0.13em;
    opacity:0.85;
  }

  .u-hero-title {
    font-size:18px;
    font-weight:800;
    letter-spacing:-0.02em;
    margin:2px 0 0;
  }

  .u-hero-copy h2 {
    font-size:16px;
    margin-bottom:2px;
  }

  .u-hero-copy p {
    font-size:12px;
    line-height:1.45;
    opacity:0.9;
  }

  .u-hero-pills {
    display:flex;
    flex-direction:column;
    gap:8px;
    margin-top:2px;
  }

  .u-hero-pill {
    display:flex;
    gap:8px;
    align-items:flex-start;
    padding:6px 8px;
    border-radius:10px;
    background:rgba(15,23,42,0.4);
    backdrop-filter:blur(10px);
  }

  .u-dot {
    width:8px;
    height:8px;
    border-radius:999px;
    margin-top:4px;
  }

  .u-dot-blue   { background:#2563EB; }
  .u-dot-purple { background:#7C3AED; }
  .u-dot-green  { background:#22C55E; }

  .u-pill-title {
    font-size:12px;
    font-weight:600;
  }

  .u-pill-text {
    font-size:10px;
    opacity:0.85;
  }

  .u-hero-footer {
    margin-top:auto;
    padding-top:6px;
    display:flex;
    align-items:center;
    gap:8px;
    font-size:11px;
  }

  .u-hero-footer-text { opacity:0.9; }

  .u-btn-secondary {
    display:inline-flex;
    align-items:center;
    gap:6px;
    border-radius:999px;
    padding:5px 10px;
    border:1px solid rgba(248,250,252,0.85);
    background:rgba(15,23,42,0.25);
    color:#F9FAFB;
    font-size:11px;
    text-decoration:none;
    cursor:pointer;
  }

  .u-btn-secondary:hover {
    background:rgba(15,23,42,0.45);
  }

  /* FORM SIDE */
  .u-login-main {
    background:#F9FAFB;
    padding:18px 16px 18px;
    display:flex;
    align-items:stretch;
  }

  .u-login-main-inner {
    width:100%;
    max-width:420px;
    margin:0 auto;
    display:flex;
    flex-direction:column;
    gap:12px;
  }

  .u-form-header h2 {
    font-size:18px;
    font-weight:700;
    color:#0F172A;
    margin-bottom:2px;
  }

  .u-form-header p {
    font-size:12px;
    color:#6B7280;
  }

  .u-flash {
    display:flex;
    align-items:center;
    gap:8px;
    padding:8px 10px;
    border-radius:10px;
    font-size:11px;
    margin-bottom:6px;
  }

  .u-flash svg { flex-shrink:0; }

  .u-flash-success {
    background:#DCFCE7;
    color:#166534;
    border-left:3px solid #22C55E;
  }

  .u-flash-error {
    background:#FEE2E2;
    color:#B91C1C;
    border-left:3px solid #EF4444;
  }

  .u-login-form {
    display:flex;
    flex-direction:column;
    gap:12px;
  }

  .u-form-group {
    display:flex;
    flex-direction:column;
    gap:5px;
  }

  .u-form-label {
    font-size:12px;
    font-weight:600;
    color:#0F172A;
    display:flex;
    align-items:center;
    gap:3px;
  }

  .u-required { color:#EF4444; }

  .u-input-wrapper { position:relative; }

  .u-form-input {
    width:100%;
    border-radius:10px;
    border:1px solid #E5E7EB;
    background:#fff;
    padding:9px 11px;
    font-size:13px;
    color:#0F172A;
    outline:none;
    transition:all 0.18s ease;
    box-sizing:border-box;
  }

  .u-form-input::placeholder { color:#9CA3AF; }

  .u-form-input:focus {
    border-color:#2563EB;
    box-shadow:0 0 0 2px rgba(37,99,235,0.25);
    background:#fff;
  }

  .u-username-pill .u-form-input { padding-left:40px; }

  .u-username-prefix {
    position:absolute;
    left:12px;
    top:50%;
    transform:translateY(-50%);
    font-size:12px;
    font-weight:700;
    color:#64748B;
  }

  .u-form-hint {
    font-size:10px;
    color:#6B7280;
  }

  .u-password-wrapper .u-form-input { padding-right:38px; }

  .u-toggle-password {
    position:absolute;
    right:6px;
    top:50%;
    transform:translateY(-50%);
    border:none;
    background:transparent;
    padding:4px;
    border-radius:999px;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#6B7280;
  }

  .u-toggle-password:hover {
    background:#E5E7EB;
    color:#111827;
  }

  .u-form-actions-row {
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:8px;
    margin-top:4px;
  }

  .u-checkbox-label {
    display:inline-flex;
    align-items:center;
    gap:6px;
    cursor:pointer;
    font-size:11px;
    color:#4B5563;
  }

  .u-checkbox-label input { display:none; }

  .u-checkbox-custom {
    width:15px;
    height:15px;
    border-radius:4px;
    border:1.4px solid #CBD5E1;
    position:relative;
    flex-shrink:0;
  }

  .u-checkbox-label input:checked + .u-checkbox-custom {
    background:#2563EB;
    border-color:#2563EB;
  }

  .u-checkbox-label input:checked + .u-checkbox-custom::after {
    content:'';
    position:absolute;
    left:4px;
    top:1px;
    width:6px;
    height:9px;
    border:solid #fff;
    border-width:0 1.6px 1.6px 0;
    transform:rotate(45deg);
  }

  .u-checkbox-text { font-size:11px; }

  .u-link-small {
    font-size:11px;
    color:#2563EB;
    text-decoration:none;
    font-weight:600;
  }

  .u-link-small:hover { text-decoration:underline; }

  .u-links-row{
    display:inline-flex;
    align-items:center;
    gap:8px;
    flex-wrap:wrap; /* mobile-friendly */
  }

  .u-link-dot{
    color:#94A3B8;
    font-weight:700;
    line-height:1;
  }

  .u-btn-primary {
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:7px;
    padding:9px 14px;
    border-radius:999px;
    border:none;
    background:linear-gradient(135deg,#2563EB,#7C3AED);
    color:#fff;
    font-size:13px;
    font-weight:600;
    cursor:pointer;
    box-shadow:0 10px 20px rgba(37,99,235,0.25);
    transition:transform 0.15s ease, box-shadow 0.15s ease, opacity 0.15s ease;
  }

  .u-btn-primary:hover {
    transform:translateY(-1px);
    box-shadow:0 12px 24px rgba(37,99,235,0.3);
  }

  .u-btn-primary:active {
    transform:translateY(0);
    box-shadow:0 6px 14px rgba(37,99,235,0.2);
  }

  .u-full-width { width:100%; margin-top:4px; }

  .u-security-note {
    margin-top:8px;
    display:flex;
    align-items:center;
    gap:6px;
    padding:7px 9px;
    border-radius:10px;
    background:#EFF6FF;
    color:#1D4ED8;
    font-size:10px;
  }

  .u-social-login { margin-top:8px; }

  .u-divider {
    display:flex;
    align-items:center;
    gap:8px;
    font-size:10px;
    color:#9CA3AF;
    margin-bottom:8px;
  }

  .u-divider::before,
  .u-divider::after {
    content:'';
    flex:1;
    height:1px;
    background:#E5E7EB;
  }

  .u-social-btn {
    border-radius:999px;
    border:1px solid #E5E7EB;
    background:#fff;
    padding:7px 10px;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:7px;
    font-size:12px;
    font-weight:600;
    color:#111827;
    text-decoration:none;
    cursor:pointer;
    transition:background 0.15s, box-shadow 0.15s, transform 0.15s;
  }

  .u-social-btn:hover {
    background:#F9FAFB;
    box-shadow:0 6px 16px rgba(15,23,42,0.08);
    transform:translateY(-1px);
  }

  .u-social-note {
    font-size:10px;
    color:#6B7280;
    margin-top:5px;
    text-align:center;
  }

  .u-demo-box { margin-top:10px; font-size:11px; }

  .u-demo-details {
    border-radius:12px;
    border:1px solid #E5E7EB;
    background:#F3F4F6;
    overflow:hidden;
  }

  .u-demo-summary {
    list-style:none;
    padding:7px 10px;
    display:flex;
    align-items:center;
    gap:7px;
    cursor:pointer;
    font-weight:600;
    font-size:11px;
    color:#111827;
  }

  .u-demo-summary::-webkit-details-marker { display:none; }

  .u-demo-body {
    padding:8px 10px 10px;
    border-top:1px solid #E5E7EB;
  }

  .u-demo-body p {
    margin-bottom:6px;
    color:#4B5563;
  }

  .u-demo-creds {
    display:flex;
    flex-direction:column;
    gap:5px;
    margin-bottom:7px;
  }

  .u-cred-row {
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:8px;
  }

  .u-cred-row span {
    font-size:11px;
    color:#4B5563;
  }

  .u-cred-row code {
    font-size:10px;
    padding:3px 7px;
    border-radius:7px;
    background:#fff;
    border:1px solid #E5E7EB;
    font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
  }

  .u-demo-btn {
    width:100%;
    border-radius:999px;
    border:none;
    padding:7px 9px;
    background:#7C3AED;
    color:#fff;
    font-size:11px;
    font-weight:600;
    cursor:pointer;
  }

  .u-demo-btn:hover { background:#6D28D9; }

  /* Responsive */
  @media (max-width: 900px) {
    .u-login-card {
      grid-template-columns:minmax(0,1fr);
    }
    .u-login-main {
      padding:16px 12px 16px;
    }
  }

  @media (max-width: 640px) {
    .u-login-shell {
      padding:8px 4px;
    }
    .u-login-card {
      border-radius:14px;
      box-shadow:0 10px 24px rgba(15,23,42,0.2);
    }
    .u-hero-pills {
      display:none; /* keep hero very compact on small phones */
    }
    .u-hero-footer {
      flex-wrap:wrap;
      justify-content:flex-start;
    }
    .u-login-main-inner {
      max-width:100%;
    }
    .u-form-actions-row {
      flex-direction:column;
      align-items:flex-start;
    }
    .u-bg-circle { opacity:0.2; filter:blur(70px); }
  }

  @media (max-width: 400px) {
    .u-hero-title { font-size:17px; }
    .u-hero-copy h2 { font-size:15px; }
    .u-form-header h2 { font-size:17px; }
    .u-form-input { font-size:12px; }
  }

  /* Optional dark theme if layout adds .dark-theme */
  .dark-theme .u-login-card { background:#020617; }
  .dark-theme .u-login-main { background:#020617; border-left:1px solid #111827; }
  .dark-theme .u-login-main-inner { color:#E5E7EB; }
  .dark-theme .u-form-input {
    background:#020617;
    border-color:#1E293B;
    color:#F9FAFB;
  }
  .dark-theme .u-form-input::placeholder { color:#64748B; }
  .dark-theme .u-demo-details {
    background:#020617;
    border-color:#1E293B;
  }
  .dark-theme .u-demo-body { border-top-color:#1E293B; }
  .dark-theme .u-cred-row code {
    background:#020617;
    border-color:#1E293B;
  }
</style>

<script nonce="<%= typeof nonce !== 'undefined' ? nonce : '' %>">
  (function () {
    'use strict';

    const usernameInput   = document.getElementById('login-username');
    const passwordInput   = document.getElementById('login-password');
    const showPasswordBtn = document.getElementById('showPasswordBtn');

    // Toggle password visibility
    if (passwordInput && showPasswordBtn) {
      showPasswordBtn.addEventListener('click', function () {
        const isPassword = passwordInput.type === 'password';
        passwordInput.type = isPassword ? 'text' : 'password';

        const eyeIcon = this.querySelector('.u-eye-icon');
        if (!eyeIcon) return;

        if (isPassword) {
          eyeIcon.innerHTML = '<path fill="currentColor" d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>';
        } else {
          eyeIcon.innerHTML = '<path fill="currentColor" d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>';
        }
      });
    }

    // Demo credentials filler
    const fillDemoBtn = document.getElementById('fillDemoBtn');
    if (fillDemoBtn) {
      fillDemoBtn.addEventListener('click', function () {
        if (usernameInput) {
          usernameInput.value = 'demo_user';
          usernameInput.focus();
        }
        if (passwordInput) {
          passwordInput.value = 'demo123';
        }

        const msg = document.createElement('div');
        msg.className = 'u-flash u-flash-success u-demo-inline';
        msg.innerHTML = `
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          <span>Demo credentials filled. Press ‚ÄúSign in‚Äù.</span>
        `;

        const container = document.querySelector('.u-login-main-inner');
        const form = document.getElementById('loginForm');
        if (container && form) {
          const existing = container.querySelector('.u-demo-inline');
          if (existing) existing.remove();
          container.insertBefore(msg, form);

          setTimeout(() => {
            msg.style.opacity = '0';
            msg.style.transform = 'translateY(-4px)';
            msg.style.transition = 'all 0.25s ease';
            setTimeout(() => msg.remove(), 260);
          }, 2500);
        }
      });
    }

    // Client-side validation
    const loginForm = document.getElementById('loginForm');
    if (loginForm) {
      loginForm.addEventListener('submit', function (e) {
        const submitBtn  = this.querySelector('.u-btn-primary');
        const usernameVal = (usernameInput && usernameInput.value || '').trim();
        const passwordVal = (passwordInput && passwordInput.value || '').trim();
        let isValid = true;

        const usernameRegex = /^[a-zA-Z0-9._-]{3,30}$/;

        if (!usernameVal || !usernameRegex.test(usernameVal)) {
          isValid = false;
          if (usernameInput) {
            usernameInput.style.borderColor = '#EF4444';
            usernameInput.style.boxShadow   = '0 0 0 2px rgba(239,68,68,0.25)';
          }
        }

        if (!passwordVal || passwordVal.length < 6) {
          isValid = false;
          if (passwordInput) {
            passwordInput.style.borderColor = '#EF4444';
            passwordInput.style.boxShadow   = '0 0 0 2px rgba(239,68,68,0.25)';
          }
        }

        if (!isValid) {
          e.preventDefault();

          const existing = document.querySelector('.u-login-main-inner .u-flash-inline-error');
          if (existing) existing.remove();

          const err = document.createElement('div');
          err.className = 'u-flash u-flash-error u-flash-inline-error';
          err.innerHTML = `
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="15" y1="9"  x2="9"  y2="15"></line>
              <line x1="9"  y1="9"  x2="15" y2="15"></line>
            </svg>
            <span>Enter a valid username (3‚Äì30, letters/numbers/._-) and a password of at least 6 characters.</span>
          `;
          const container = document.querySelector('.u-login-main-inner');
          if (container) {
            const header = container.querySelector('.u-form-header');
            container.insertBefore(err, header.nextSibling);

            setTimeout(() => {
              err.style.opacity = '0';
              err.style.transform = 'translateY(-4px)';
              err.style.transition = 'all 0.25s ease';
              setTimeout(() => err.remove(), 260);
            }, 5000);
          }
          return;
        }

        // Loading state
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.style.opacity = '0.8';
          submitBtn.innerHTML = `
            <svg class="u-spinner" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
            </svg>
            <span>Signing in‚Ä¶</span>
          `;

          const style = document.createElement('style');
          style.textContent = `
            @keyframes u-spin-login {
              from { transform: rotate(0deg); }
              to   { transform: rotate(360deg); }
            }
            .u-spinner {
              animation: u-spin-login 1s linear infinite;
            }
          `;
          document.head.appendChild(style);
        }
      });
    }

    // Remember me: save username in localStorage
    const rememberCheckbox = document.getElementById('login-remember');
    if (rememberCheckbox && usernameInput) {
      try {
        const saved = localStorage.getItem('login:username');
        if (saved) {
          usernameInput.value = saved;
          rememberCheckbox.checked = true;
        }
      } catch (err) {
        console.warn('Could not read saved username:', err);
      }

      usernameInput.addEventListener('input', function () {
        if (!rememberCheckbox.checked) return;
        const val = this.value.trim();
        try {
          if (val) localStorage.setItem('login:username', val);
        } catch (err) {
          console.warn('Could not save username:', err);
        }
      });

      rememberCheckbox.addEventListener('change', function () {
        try {
          if (!this.checked) {
            localStorage.removeItem('login:username');
          } else if (usernameInput.value.trim()) {
            localStorage.setItem('login:username', usernameInput.value.trim());
          }
        } catch (err) {
          console.warn('Remember me toggle error:', err);
        }
      });
    }

    // Subtle focus animation (no width changes)
    const inputs = document.querySelectorAll('.u-login-form .u-form-input');
    inputs.forEach((input) => {
      input.addEventListener('focus', function () {
        this.style.transform = 'translateY(-1px)';
      });
      input.addEventListener('blur', function () {
        this.style.transform = 'translateY(0)';
      });
    });

    // Autofocus username after render
    setTimeout(() => {
      if (usernameInput && !usernameInput.value) {
        usernameInput.focus();
      }
    }, 250);
  })();
</script>
