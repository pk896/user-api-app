<!-- views/add-product.ejs -->
<div class="pf-shell <%= themeCss && themeCss.includes('dark') ? 'theme-dark' : 'theme-light' %>">
  <div class="pf">
    <div class="pf-header">
      <div class="pf-pill">
        <span class="pf-pill-dot"></span>
        <span class="pf-pill-text">Business · Product Setup</span>
      </div>
      <h1 class="pf-title">➕ Add New Product</h1>
      <p class="pf-subtitle">
        Capture a clean product card for your shop in under a minute.
      </p>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="pf-toast-container"></div>

    <% if (!business) { %>
      <div class="pf-unauthorized">
        <div class="pf-unauth-icon">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 9v3m0 4h.01M5.07 20h13.86c1.05 0 1.72-1.12 1.23-2.05L13.23 4.52c-.52-.97-1.94-.97-2.46 0L3.84 17.95C3.35 18.88 4.02 20 5.07 20z"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
        </div>
        <p class="pf-unauth-text">
          You need a business account to add products.
        </p>
        <a href="/business/login" class="pf-btn pf-btn-primary">
          <span>Login to continue</span>
        </a>
      </div>
    <% } else { %>
      <form id="addProductForm" action="/products/add" method="POST" enctype="multipart/form-data">
        <!-- Form Grid -->
        <div class="pf-grid">
          <!-- Left Column -->
          <div class="pf-col">
            <!-- Product ID -->
            <div class="pf-field">
              <label class="pf-label">
                <span>CustomID <span class="pf-label-tag">required</span></span>
                <!-- ❗ name="id" to match router: req.body.id -->
                <input
                  type="text"
                  name="id"
                  placeholder="PROD-001 (fill it for advanced analytics & customization)"
                  required
                  class="pf-input"
                />
                <div class="pf-hint">custom Id must be unique and alphanumeric (20-30 characters).</div>
              </label>
            </div>

            <!-- Product Name -->
            <div class="pf-field">
              <label class="pf-label">
                <span>Product Name <em>*</em></span>
                <input
                  type="text"
                  name="name"
                  placeholder="e.g., Orange Juice 1L"
                  required
                  class="pf-input"
                />
              </label>
            </div>

            <!-- Price -->
            <div class="pf-field">
              <label class="pf-label">
                <span>Price (incl. VAT) <em>*</em></span>
                <div class="pf-input-group">
                  <span class="pf-input-prefix">R</span>
                  <input
                    type="number"
                    name="price"
                    placeholder="29.99"
                    step="0.01"
                    min="0"
                    required
                    class="pf-input pf-input-with-prefix"
                  />
                </div>
                <div class="pf-hint">Enter the selling price you want buyers to see.</div>
              </label>
            </div>

            <!-- Stock -->
            <div class="pf-field">
              <label class="pf-label">
                <span>Stock Quantity</span>
                <input
                  type="number"
                  name="stock"
                  placeholder="100"
                  min="0"
                  required
                  class="pf-input"
                />
                <div class="pf-hint">Leave empty for unlimited / on-demand.</div>
              </label>
            </div>

            <!-- Category (DROPDOWN, matches sales-products categories) -->
            <div class="pf-field">
              <label class="pf-label">
                <span>Category</span>
                <select name="category" class="pf-input pf-select">
                  <option value="">Choose category</option>
                  <!-- values match the catSelect filter on the shop page -->
                  <option value="electronics">Electronics</option>
                  <option value="fashion">Fashion</option>
                  <option value="home">Home</option>
                  <option value="beauty">Beauty</option>
                  <option value="groceries">Groceries</option>
                  <option value="clothes">Clothes</option>
                  <option value="second-hand-clothing">Second Hand Clothing</option>
                  <option value="uncategorized-second-hand-things">Uncategorized Second Hand Things</option>
                </select>
                <div class="pf-hint">Used for filters on the shopping page.</div>
              </label>
            </div>

            <!-- Color (default) -->
            <div class="pf-field">
              <label class="pf-label">
                <span>Default Color</span>
                <input
                  type="text"
                  name="color"
                  placeholder="e.g., Orange / Black / Blue"
                  required
                  class="pf-input"
                />
                <div class="pf-hint">Optional: shown as the first color if you use variants later.</div>
              </label>
            </div>
          </div>

          <!-- Right Column -->
          <div class="pf-col">
            <!-- Size (default) -->
            <div class="pf-field">
              <label class="pf-label">
                <span>Default Size</span>
                <input
                  type="text"
                  name="size"
                  placeholder="e.g., 1L Bottle / M / Size 7"
                  required
                  class="pf-input"
                />
              </label>
            </div>

            <!-- Quality (DROPDOWN) -->
            <div class="pf-field">
              <label class="pf-label">
                <span>Quality / Grade</span>
                <select name="quality" class="pf-input pf-select">
                  <option value="">Not specified</option>
                  <option value="standard">Standard</option>
                  <option value="premium">Premium</option>
                  <option value="grade-a">Grade A</option>
                  <option value="grade-b">Grade B</option>
                  <option value="economy">Economy</option>
                </select>
                <div class="pf-hint">Pick the quality level buyers should see.</div>
              </label>
            </div>

            <!-- Made In -->
            <div class="pf-field">
              <label class="pf-label">
                <span>Made In</span>
                <input
                  type="text"
                  name="made"
                  placeholder="e.g., South Africa"
                  class="pf-input"
                />
              </label>
            </div>

            <!-- Manufacturer -->
            <div class="pf-field">
              <label class="pf-label">
                <span>Manufacturer</span>
                <input
                  type="text"
                  name="manufacturer"
                  placeholder="e.g., PK's Engineering"
                  class="pf-input"
                />
              </label>
            </div>

            <!-- Matching Type (product.type controls shoes/clothes behaviour) -->
            <div class="pf-field">
              <label class="pf-label">
                <span>Matching Type</span>
                <input
                  type="text"
                  name="type"
                  placeholder="e.g., shoes, clothes, electronics, organic-juice"
                  required
                  class="pf-input"
                />
                <div class="pf-hint">
                  Controls behaviour on the shop page (use <strong>shoes</strong> or <strong>clothes</strong> for size &amp; color variants).
                </div>
              </label>
            </div>

            <!-- Description -->
            <div class="pf-field">
              <label class="pf-label">
                <span>Description</span>
                <textarea
                  name="description"
                  rows="2"
                  placeholder="Short description buyers will see (features, highlights, etc.)"
                  maxlength="500"
                  class="pf-textarea"
                ></textarea>
                <div class="pf-hint">Max 500 characters</div>
              </label>
            </div>
          </div>
        </div>

        <!-- Image Upload -->
        <div class="pf-image-section">
          <label class="pf-label pf-label-block">
            <span>Product Image <em>*</em></span>
            <div class="pf-image-upload">
              <input
                id="imageFile"
                type="file"
                name="imageFile"
                accept="image/*"
                required
                class="pf-file-input"
              />
              <div class="pf-image-upload-area">
                <div class="pf-image-upload-icon">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M12 5v14m-7-7h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                  </svg>
                </div>
                <div class="pf-image-upload-text">
                  <span>Click or tap to upload image</span>
                  <div class="pf-hint">JPG, PNG, GIF or WebP · Max 5MB</div>
                </div>
              </div>
            </div>
          </label>

          <div id="previewWrapper" class="pf-image-preview">
            <img id="imagePreview" class="pf-image-preview-img" alt="Product preview" />
            <button type="button" class="pf-image-remove" onclick="removeImage()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M6 18L18 6M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
              </svg>
            </button>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="pf-actions">
          <button type="submit" class="pf-btn pf-btn-primary">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="none" aria-hidden="true">
              <path d="M4 8l3 3 5-6M2 8a6 6 0 1112 0A6 6 0 012 8z"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span>Save Product</span>
          </button>
          <a href="/products/all" class="pf-btn pf-btn-secondary">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="none" aria-hidden="true">
              <path d="M10 12L6 8l4-4"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span>Back to Products</span>
          </a>
        </div>
      </form>
    <% } %>
  </div>
</div>

<style>
  /* ========= BRAND WRAPPER (dark body) ========= */
  .pf-shell {
    min-height: calc(100vh - 80px);
    padding: 12px 8px 18px;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    background: #0b1220; /* your favourite dark body color */
  }

  .pf-shell.theme-light {
    background: radial-gradient(circle at top, rgba(37, 99, 235, 0.15), transparent 60%),
                #0b1220;
  }

  .pf-shell.theme-dark {
    background: radial-gradient(circle at top, rgba(124, 58, 237, 0.25), transparent 65%),
                #0b1220;
  }

  /* ========= BRAND VARIABLES ========= */
  .pf {
    --blue: #2563EB;
    --purple: #7C3AED;
    --white: #F9FAFF;
    --pure-white: #FFFFFF;
    --dark-body: #0b1220;
    --dark-surface: #111827;
    --dark-soft: #1f2937;
    --text-main: #0f172a;
    --text-muted: #64748b;
    --border-subtle: #e2e8f0;
    --radius: 14px;
    --transition: all 0.18s ease-out;
  }

  /* ========= CONTAINER ========= */
  .pf {
    width: 100%;
    max-width: 720px;
    margin: 0 auto;
    padding: 16px 14px 18px;
    border-radius: var(--radius);
    background: radial-gradient(circle at top left, rgba(37, 99, 235, 0.08), transparent 55%),
                radial-gradient(circle at bottom right, rgba(124, 58, 237, 0.08), transparent 55%),
                var(--white);
    border: 1px solid rgba(148, 163, 184, 0.26);
    box-shadow: 0 18px 42px rgba(15, 23, 42, 0.4);
  }

  .pf-shell.theme-dark .pf {
    background: radial-gradient(circle at top left, rgba(37, 99, 235, 0.25), transparent 55%),
                radial-gradient(circle at bottom right, rgba(124, 58, 237, 0.2), transparent 55%),
                #0b1220;
    border-color: rgba(30, 64, 175, 0.7);
    color: #E5E7EB;
  }

  @media (min-width: 768px) {
    .pf {
      padding: 18px 18px 20px;
      max-width: 840px;
    }
    .pf-shell {
      padding: 18px 12px 26px;
      align-items: center;
    }
  }

  /* ========= HEADER ========= */
  .pf-header {
    text-align: left;
    margin-bottom: 16px;
  }

  .pf-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    border-radius: 999px;
    background: rgba(37, 99, 235, 0.08);
    border: 1px solid rgba(37, 99, 235, 0.3);
    margin-bottom: 6px;
  }

  .pf-pill-dot {
    width: 7px;
    height: 7px;
    border-radius: 999px;
    background: linear-gradient(135deg, #2563EB, #7C3AED);
  }

  .pf-pill-text {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.03em;
    text-transform: uppercase;
    color: #e5e7eb;
  }

  .pf-shell.theme-light .pf-pill-text {
    color: #1e293b;
  }

  .pf-title {
    font-size: 18px;
    font-weight: 700;
    margin: 2px 0 4px;
    color: #e5e7eb;
  }

  .pf-shell.theme-light .pf-title {
    color: #0f172a;
  }

  .pf-subtitle {
    margin: 0;
    font-size: 12px;
    color: #9CA3AF;
  }

  .pf-shell.theme-light .pf-subtitle {
    color: var(--text-muted);
  }

  /* ========= UNAUTHORIZED ========= */
  .pf-unauthorized {
    margin-top: 8px;
    padding: 20px 16px;
    border-radius: 10px;
    background: rgba(15, 23, 42, 0.9);
    border: 1px dashed rgba(148, 163, 184, 0.9);
    text-align: center;
    color: #E5E7EB;
  }

  .pf-shell.theme-light .pf-unauthorized {
    background: rgba(248, 250, 252, 0.95);
    color: var(--text-main);
  }

  .pf-unauth-icon {
    display: flex;
    justify-content: center;
    margin-bottom: 8px;
    color: #fbbf24;
  }

  .pf-unauth-text {
    margin: 0 0 14px;
    font-size: 13px;
    font-weight: 500;
  }

  /* ========= FORM LAYOUT ========= */
  .pf-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 14px;
    margin-top: 8px;
    margin-bottom: 18px;
  }

  .pf-col {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  @media (min-width: 640px) {
    .pf-grid {
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 18px;
    }
  }

  /* ========= FIELDS ========= */
  .pf-field {
    display: flex;
    flex-direction: column;
  }

  .pf-label {
    display: flex;
    flex-direction: column;
    gap: 5px;
    font-size: 12px;
    font-weight: 600;
    color: #E5E7EB;
  }

  .pf-shell.theme-light .pf-label {
    color: var(--text-main);
  }

  .pf-label em {
    color: #F97316;
    font-style: normal;
    margin-left: 2px;
  }

  .pf-label-tag {
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: #cbd5f5;
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 184, 0.8);
    padding: 2px 6px;
    margin-left: 6px;
  }

  .pf-shell.theme-light .pf-label-tag {
    color: var(--text-muted);
  }

  .pf-input,
  .pf-textarea,
  .pf-select {
    padding: 8px 9px;
    border-radius: 9px;
    border: 1px solid var(--border-subtle);
    font-size: 13px;
    font-family: inherit;
    background: #f9fafb;
    color: #0f172a;
    transition: var(--transition);
    min-height: 36px;
  }

  .pf-textarea {
    resize: vertical;
    min-height: 60px;
    line-height: 1.4;
  }

  .pf-input:focus,
  .pf-textarea:focus,
  .pf-select:focus {
    outline: none;
    border-color: #2563EB;
    box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.45);
    background: #ffffff;
  }

  .pf-shell.theme-dark .pf-input,
  .pf-shell.theme-dark .pf-textarea,
  .pf-shell.theme-dark .pf-select {
    background: #020617;
    border-color: rgba(51, 65, 85, 0.9);
    color: #E5E7EB;
  }

  .pf-shell.theme-dark .pf-input:focus,
  .pf-shell.theme-dark .pf-textarea:focus,
  .pf-shell.theme-dark .pf-select:focus {
    border-color: #7C3AED;
    box-shadow: 0 0 0 1px rgba(124, 58, 237, 0.7);
  }

  .pf-input-group {
    position: relative;
    display: flex;
    align-items: center;
  }

  .pf-input-prefix {
    position: absolute;
    left: 9px;
    font-size: 12px;
    color: var(--text-muted);
    font-weight: 600;
  }

  .pf-input-with-prefix {
    padding-left: 24px;
  }

  .pf-hint {
    font-size: 10px;
    color: #9CA3AF;
    margin-top: 2px;
  }

  .pf-shell.theme-light .pf-hint {
    color: var(--text-muted);
  }

  /* ========= IMAGE UPLOAD ========= */
  .pf-image-section {
    margin-bottom: 18px;
  }

  .pf-label-block {
    margin-bottom: 8px;
  }

  .pf-image-upload {
    position: relative;
  }

  .pf-file-input {
    position: absolute;
    inset: 0;
    opacity: 0;
    cursor: pointer;
  }

  .pf-image-upload-area {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 11px;
    border-radius: 10px;
    border: 1px dashed rgba(148, 163, 184, 0.9);
    background: rgba(15, 23, 42, 0.9);
    transition: var(--transition);
  }

  .pf-shell.theme-light .pf-image-upload-area {
    background: rgba(248, 250, 252, 0.95);
  }

  .pf-image-upload-area:hover {
    border-style: solid;
    border-color: #2563EB;
    box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.24);
  }

  .pf-image-upload-icon {
    padding: 8px;
    border-radius: 999px;
    background: radial-gradient(circle, rgba(37, 99, 235, 0.6), rgba(124, 58, 237, 0.4));
    display: flex;
    color: #fff;
  }

  .pf-image-upload-text span {
    display: block;
    font-size: 13px;
    font-weight: 600;
  }

  .pf-image-preview {
    display: none;
    position: relative;
    width: 110px;
    height: 110px;
    margin-top: 10px;
  }

  .pf-image-preview-img {
    width: 100%;
    height: 100%;
    border-radius: 10px;
    object-fit: cover;
    border: 1px solid rgba(148, 163, 184, 0.8);
  }

  .pf-image-remove {
    position: absolute;
    top: -6px;
    right: -6px;
    width: 22px;
    height: 22px;
    border-radius: 999px;
    border: 1px solid #EF4444;
    background: #0b1220;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #EF4444;
    cursor: pointer;
    transition: var(--transition);
  }

  .pf-image-remove:hover {
    background: #EF4444;
    color: #FFFFFF;
  }

  /* ========= BUTTONS ========= */
  .pf-actions {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 4px;
  }

  .pf-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    min-width: 130px;
    padding: 9px 15px;
    border-radius: 999px;
    font-size: 13px;
    font-weight: 600;
    border: 1px solid transparent;
    text-decoration: none;
    cursor: pointer;
    transition: var(--transition);
    white-space: nowrap;
  }

  .pf-btn svg {
    flex-shrink: 0;
  }

  .pf-btn-primary {
    background: linear-gradient(135deg, #2563EB, #7C3AED);
    color: #FFFFFF;
    box-shadow: 0 14px 32px rgba(37, 99, 235, 0.55);
  }

  .pf-btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 18px 40px rgba(37, 99, 235, 0.75);
  }

  .pf-btn-secondary {
    background: transparent;
    color: #bfdbfe;
    border-color: rgba(148, 163, 184, 0.9);
  }

  .pf-shell.theme-light .pf-btn-secondary {
    color: #2563EB;
  }

  .pf-btn-secondary:hover {
    background: rgba(37, 99, 235, 0.1);
    border-color: #2563EB;
  }

  /* ========= TOAST ========= */
  .pf-toast-container {
    position: fixed;
    bottom: 14px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 6px;
    pointer-events: none;
  }

  .pf-toast {
    max-width: 320px;
    padding: 10px 14px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 500;
    color: #FFFFFF;
    background: linear-gradient(135deg, #22C55E, #16A34A);
    box-shadow: 0 12px 30px rgba(15, 23, 42, 0.7);
    animation: toastSlideIn 0.25s ease-out;
    text-align: center;
  }

  .pf-toast.pf-toast-error {
    background: linear-gradient(135deg, #EF4444, #DC2626);
  }

  @keyframes toastSlideIn {
    from {
      opacity: 0;
      transform: translate(-50%, 18px);
    }
    to {
      opacity: 1;
      transform: translate(-50%, 0);
    }
  }

  /* ========= MOBILE COMPACT ========= */
  @media (max-width: 380px) {
    .pf-shell {
      padding: 10px 6px 16px;
    }
    .pf {
      padding: 14px 11px 16px;
    }
    .pf-title {
      font-size: 16px;
    }
    .pf-subtitle {
      font-size: 11px;
    }
    .pf-input,
    .pf-textarea,
    .pf-select {
      font-size: 12px;
      padding: 7px 8px;
      min-height: 34px;
    }
    .pf-btn {
      min-width: 120px;
      padding: 8px 13px;
      font-size: 12px;
    }
    .pf-image-upload-area {
      padding: 10px 9px;
    }
  }

  /* ========= VALIDATION & LOADING ========= */
  .pf-input:invalid,
  .pf-textarea:invalid {
    border-color: #EF4444;
  }

  .pf-input:invalid:focus,
  .pf-textarea:invalid:focus {
    box-shadow: 0 0 0 1px rgba(239, 68, 68, 0.55);
  }

  .pf-submitting .pf-btn-primary {
    opacity: 0.75;
    cursor: wait;
  }

  .pf-submitting .pf-btn-primary::after {
    content: '';
    display: inline-block;
    width: 11px;
    height: 11px;
    margin-left: 7px;
    border-radius: 999px;
    border: 2px solid rgba(255, 255, 255, 0.35);
    border-top-color: #FFFFFF;
    animation: spin 0.7s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }
</style>

<script nonce="<%= nonce %>">
document.addEventListener("DOMContentLoaded", () => {
  // Image preview
  const imageInput = document.getElementById("imageFile");
  const previewWrapper = document.getElementById("previewWrapper");
  const previewImg = document.getElementById("imagePreview");
  const form = document.getElementById("addProductForm");

  if (imageInput) {
    imageInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        // file size limit 5MB
        if (file.size > 5 * 1024 * 1024) {
          showToast("Image size must be less than 5MB", "error");
          imageInput.value = "";
          return;
        }

        // file type
        const validTypes = ["image/jpeg", "image/png", "image/gif", "image/webp"];
        if (!validTypes.includes(file.type)) {
          showToast("Only JPG, PNG, GIF or WebP images are allowed", "error");
          imageInput.value = "";
          return;
        }

        const url = URL.createObjectURL(file);
        previewImg.src = url;
        previewWrapper.style.display = "block";
      }
    });
  }

  // remove image
  window.removeImage = function () {
    if (imageInput) imageInput.value = "";
    previewWrapper.style.display = "none";
  };

  // toast
  function showToast(message, type = "success") {
    const container = document.getElementById("toast-container");
    if (!container) return;

    const toast = document.createElement("div");
    toast.className = "pf-toast" + (type === "error" ? " pf-toast-error" : "");
    toast.textContent = message;
    container.appendChild(toast);

    setTimeout(() => {
      toast.style.opacity = "0";
      toast.style.transform = "translate(-50%, 18px)";
      setTimeout(() => toast.remove(), 260);
    }, 3800);
  }

  // server-side messages (flash)
  const successMsg = "<%= (success && success.length > 0) ? success : '' %>";
  const errorMsg = "<%= (error && error.length > 0) ? error : '' %>";
  if (successMsg) showToast(successMsg);
  if (errorMsg) showToast(errorMsg, "error");

  // loading state on submit
  if (form) {
    form.addEventListener("submit", () => {
      const submitBtn = form.querySelector(".pf-btn-primary");
      form.classList.add("pf-submitting");
      if (submitBtn) submitBtn.disabled = true;

      setTimeout(() => {
        form.classList.remove("pf-submitting");
        if (submitBtn) submitBtn.disabled = false;
      }, 10000);
    });
  }

  // description counter
  const descriptionField = document.querySelector('textarea[name="description"]');
  if (descriptionField) {
    const hint = descriptionField.parentNode.querySelector(".pf-hint");
    descriptionField.addEventListener("input", () => {
      const length = descriptionField.value.length;
      if (hint) {
        hint.textContent = `${length}/500 characters`;
        if (length > 500) {
          hint.style.color = "#EF4444";
        } else if (length > 450) {
          hint.style.color = "#F59E0B";
        } else {
          hint.style.color = "";
        }
      }
    });
    descriptionField.dispatchEvent(new Event("input"));
  }

  // product ID auto-format (name="id")
  const productIdField = document.querySelector('input[name="id"]');
  if (productIdField) {
    productIdField.addEventListener("input", (e) => {
      let value = e.target.value.toUpperCase().replace(/[^A-Z0-9\-]/g, "");
      e.target.value = value;
    });
  }

  // price formatting
  const priceField = document.querySelector('input[name="price"]');
  if (priceField) {
    priceField.addEventListener("blur", (e) => {
      const num = parseFloat(e.target.value);
      if (!Number.isNaN(num)) {
        e.target.value = num.toFixed(2);
      }
    });
  }
});
</script>
