<!-- views/partials/rating-stars.ejs -->
<%
  // expects: avg (0..5), count (int), nonce (string)
  const a = Math.max(0, Math.min(5, Number(avg || 0)));
  const c = Math.max(0, Number(count || 0));

  const full = Math.floor(a);
  const frac = a - full;
  const half = frac >= 0.5;
%>

<div
  class="rs"
  aria-label="<%= c > 0
    ? ('Average rating ' + a.toFixed(1) + ' out of 5 based on ' + c + ' review' + (c === 1 ? '' : 's'))
    : 'No ratings yet' %>"
>
  <div class="rs-stars" aria-hidden="true">
    <% for (let i = 1; i <= 5; i++) { %>
      <% const isFull = i <= full; %>
      <% const isHalf = (!isFull && i === full + 1 && half); %>

      <span class="rs-star <%= isFull ? 'on' : (isHalf ? 'half' : 'off') %>">★</span>
    <% } %>
  </div>

  <div class="rs-meta">
    <% if (c > 0) { %>
      <span class="rs-avg"><%= a.toFixed(1) %></span>
      <span class="rs-count">(<%= c %>)</span>
    <% } else { %>
      <span class="rs-none">No ratings</span>
    <% } %>
  </div>
</div>

<style nonce="<%= nonce %>">
  .rs { display:inline-flex; align-items:center; gap:6px; line-height:1; }
  .rs-stars { display:flex; gap:2px; }
  .rs-star { font-size:14px; }

  .rs-star.on { color:#F59E0B; }
  .rs-star.off { color:#CBD5E1; }

  /* half = gray star with gold left-half overlay */
  .rs-star.half {
    color:#CBD5E1;
    position:relative;
    display:inline-block;
  }
  .rs-star.half::after{
    content:"★";
    position:absolute;
    left:0; top:0;
    width:50%;
    overflow:hidden;
    color:#F59E0B;
  }

  .rs-meta { display:flex; gap:4px; font-size:12px; color:#64748B; }
  .rs-avg { font-weight:700; color:#0F172A; }
  .rs-none { font-style:italic; color:#94A3B8; }
</style>
