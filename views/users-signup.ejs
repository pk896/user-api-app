<!-- views/users-signup.ejs -->
<section class="auth-page mini">
  <!-- stamp: users-signup -->
  <small class="stamp">view: users-signup</small>
  
  <div class="brand-header">
    <div class="logo-preview">
      <div class="logo-color blue"></div>
      <div class="logo-color purple"></div>
      <div class="logo-color green"></div>
      <div class="logo-color black"></div>
    </div>
    <h1 class="page-title">üöÄ Join Our Platform</h1>
    <p class="page-subtitle">
      Use your real email so we can verify your account and send important updates.
    </p>
  </div>

  <% (success || []).forEach(msg => { %>
    <div class="flash flash-success">
      <svg class="flash-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
      <%= msg %>
    </div>
  <% }) %>

  <% (error || []).forEach(msg => { %>
    <div class="flash flash-error">
      <svg class="flash-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="15" y1="9" x2="9" y2="15"></line>
        <line x1="9" y1="9" x2="15" y2="15"></line>
      </svg>
      <%= msg %>
    </div>
  <% }) %>

  <form
    action="/users/signup"
    method="post"
    class="auth-form card"
    autocomplete="off"
    novalidate
    id="signupForm"
  >
    <div class="form-section">
      <h3 class="section-title">
        <span class="section-number">1</span>
        Basic Information
      </h3>
      
      <label class="floating-label">
        <input
          type="email"
          name="email"
          id="email"
          required
          autocomplete="email"
          placeholder=" "
          inputmode="email"
        />
        <span class="label-text">Contact Email (Gmail/Outlook)</span>
        <small class="field-hint">
          We'll send a verification link to this address.
        </small>
        <div class="input-icon">‚úâÔ∏è</div>
      </label>

      <div class="input-group">
        <label class="floating-label">
          <input
            type="text"
            name="username"
            id="username"
            minlength="3"
            maxlength="30"
            required
            autocomplete="username"
            placeholder=" "
          />
          <span class="label-text">Username</span>
          <div class="input-icon">üë§</div>
        </label>
        <div class="char-counter" data-for="username">0/30</div>
      </div>

      <label class="floating-label">
        <input
          type="text"
          name="name"
          id="name"
          minlength="2"
          maxlength="80"
          required
          autocomplete="name"
          placeholder=" "
        />
        <span class="label-text">Full Name</span>
        <div class="input-icon">üìù</div>
      </label>

      <div class="input-group">
        <label class="floating-label">
          <input
            type="number"
            name="age"
            id="age"
            min="16"
            max="120"
            step="1"
            required
            autocomplete="off"
            placeholder=" "
          />
          <span class="label-text">Age <span class="age-note">(must be 16+)</span></span>
          <div class="input-icon">üéÇ</div>
        </label>
      </div>
    </div>

    <div class="form-section">
      <h3 class="section-title">
        <span class="section-number">2</span>
        Security
      </h3>

      <div class="input-group">
        <label class="floating-label">
          <input
            type="password"
            name="password"
            id="password"
            required
            minlength="6"
            placeholder=" "
            autocomplete="new-password"
          />
          <span class="label-text">Password</span>
          <div class="input-icon">üîí</div>
          <button
            type="button"
            class="toggle-password"
            data-target="password"
            aria-label="Show password"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
          </button>
        </label>
        <div class="password-strength">
          <div class="strength-bar"></div>
          <div class="strength-bar"></div>
          <div class="strength-bar"></div>
          <div class="strength-bar"></div>
          <span class="strength-text">Password strength</span>
        </div>
      </div>

      <label class="floating-label">
        <input
          type="password"
          name="confirm"
          id="confirm"
          required
          minlength="6"
          placeholder=" "
          autocomplete="new-password"
        />
        <span class="label-text">Confirm Password</span>
        <div class="input-icon">‚úì</div>
        <button
          type="button"
          class="toggle-password"
          data-target="confirm"
          aria-label="Show confirm password"
        >
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </button>
      </label>

      <div class="password-requirements">
        <p class="req-title">Password must include:</p>
        <ul class="req-list">
          <li class="req-item" data-check="length">At least 6 characters</li>
          <li class="req-item" data-check="number">One number</li>
          <li class="req-item" data-check="letter">One letter</li>
        </ul>
      </div>
    </div>

    <div class="form-section">
      <h3 class="section-title">
        <span class="section-number">3</span>
        Terms & Conditions
      </h3>

      <label class="checkbox-container">
        <input type="checkbox" name="confirm16" value="1" required id="ageConfirm" />
        <span class="checkmark"></span>
        <span class="checkbox-text">
          I confirm I am 16 years or older and agree to the 
          <a href="/terms" class="link">Terms of Service</a> and 
          <a href="/privacy" class="link">Privacy Policy</a>
        </span>
      </label>

      <label class="checkbox-container">
        <input type="checkbox" name="newsletter" value="1" id="newsletter" checked />
        <span class="checkmark"></span>
        <span class="checkbox-text">
          Send me occasional product updates and tips (optional)
        </span>
      </label>
    </div>

    <button type="submit" class="btn primary wfull submit-btn" id="submitBtn">
      <span class="btn-text">Create Account</span>
      <div class="spinner hidden">
        <div class="spinner-dot"></div>
        <div class="spinner-dot"></div>
        <div class="spinner-dot"></div>
      </div>
    </button>

    <div class="divider">
      <span class="divider-line"></span>
      <span class="divider-text">or continue with</span>
      <span class="divider-line"></span>
    </div>

    <div class="social-buttons">
      <a href="/auth/google" class="social-btn google" data-nav="true" rel="noopener">
        <svg class="social-icon" width="18" height="18" viewBox="0 0 24 24">
          <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
          <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
          <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
          <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
        </svg>
        <span>Continue with Google</span>
      </a>
      <p class="social-note">
        We'll use your Google email and profile information
      </p>
    </div>
  </form>

  <p class="auth-switch">
    Already have an account?
    <a href="/users/login" data-nav="true" rel="noopener" class="login-link">
      Log in here
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </a>
  </p>

  <div class="progress-indicator">
    <div class="progress-bar">
      <div class="progress-fill"></div>
    </div>
    <div class="progress-steps">
      <div class="step active" data-step="1">Info</div>
      <div class="step" data-step="2">Security</div>
      <div class="step" data-step="3">Terms</div>
    </div>
  </div>
</section>

<style nonce="<%= typeof nonce !== 'undefined' ? nonce : '' %>">
  /* Brand Color Variables */
  :root {
    --brand-blue: #2563EB;    /* Trust & Reliability */
    --brand-purple: #7C3AED;  /* Innovation & Creativity */
    --brand-green: #22C55E;   /* Growth & Success (Primary) */
    --brand-black: #0F172A;   /* Sophistication & Premium */
    
    --bg-primary: #22C55E;
    --bg-secondary: #f0fdf4;
    --text-primary: #0F172A;
    --text-secondary: #475569;
    --card-bg: #ffffff;
    --card-border: #e2e8f0;
    --input-bg: #f8fafc;
    --success-light: #dcfce7;
    --error-light: #fee2e2;
  }

  .dark-theme {
    --bg-primary: #16a34a;
    --bg-secondary: #052e16;
    --text-primary: #f1f5f9;
    --text-secondary: #cbd5e1;
    --card-bg: #1e293b;
    --card-border: #334155;
    --input-bg: #0f172a;
    --success-light: #064e3b;
    --error-light: #7f1d1d;
  }

  /* Base Styles */
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    background: linear-gradient(135deg, var(--bg-secondary) 0%, #ffffff 100%);
    color: var(--text-primary);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    line-height: 1.5;
    min-height: 100vh;
  }

  .dark-theme body {
    background: linear-gradient(135deg, var(--bg-secondary) 0%, #0f172a 100%);
  }

  .auth-page.mini {
    max-width: 420px;
    margin: 1rem auto;
    padding: 1.5rem 1.25rem;
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
    position: relative;
    overflow: hidden;
  }

  .auth-page.mini::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--brand-blue), var(--brand-purple), var(--brand-green));
  }

  .dark-theme .auth-page.mini {
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
  }

  /* Brand Header */
  .brand-header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .logo-preview {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 1rem;
  }

  .logo-color {
    width: 16px;
    height: 16px;
    border-radius: 4px;
  }

  .logo-color.blue { background: var(--brand-blue); }
  .logo-color.purple { background: var(--brand-purple); }
  .logo-color.green { background: var(--brand-green); }
  .logo-color.black { background: var(--brand-black); }

  .page-title {
    font-size: 1.75rem;
    font-weight: 800;
    margin-bottom: 0.5rem;
    background: linear-gradient(135deg, var(--brand-blue), var(--brand-purple));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .page-subtitle {
    color: var(--text-secondary);
    font-size: 0.875rem;
    line-height: 1.4;
  }

  /* Form Sections */
  .form-section {
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--card-border);
  }

  .form-section:last-child {
    border-bottom: none;
    margin-bottom: 1.5rem;
  }

  .section-title {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 1.25rem;
    color: var(--text-primary);
  }

  .section-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: var(--brand-green);
    color: white;
    border-radius: 50%;
    font-size: 0.75rem;
    font-weight: 700;
  }

  /* Floating Labels */
  .floating-label {
    position: relative;
    margin-bottom: 1.5rem;
  }

  .floating-label input {
    width: 100%;
    padding: 1rem 2.5rem 0.5rem 1rem;
    font-size: 0.9375rem;
    background: var(--input-bg);
    border: 2px solid var(--card-border);
    border-radius: 10px;
    color: var(--text-primary);
    transition: all 0.2s ease;
  }

  .floating-label input:focus {
    outline: none;
    border-color: var(--brand-green);
    box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
  }

  .floating-label input:focus + .label-text,
  .floating-label input:not(:placeholder-shown) + .label-text {
    top: 0.5rem;
    font-size: 0.75rem;
    color: var(--brand-green);
  }

  .label-text {
    position: absolute;
    top: 1rem;
    left: 1rem;
    color: var(--text-secondary);
    font-size: 0.9375rem;
    transition: all 0.2s ease;
    pointer-events: none;
    background: var(--input-bg);
    padding: 0 0.25rem;
  }

  .age-note {
    color: var(--text-secondary);
    font-weight: normal;
    font-size: 0.875rem;
  }

  .input-icon {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
    font-size: 0.875rem;
  }

  .field-hint {
    display: block;
    margin-top: 0.25rem;
    color: var(--text-secondary);
    font-size: 0.75rem;
    line-height: 1.3;
  }

  /* Input Groups */
  .input-group {
    position: relative;
    margin-bottom: 1.5rem;
  }

  .char-counter {
    position: absolute;
    right: 1rem;
    bottom: -1.25rem;
    font-size: 0.75rem;
    color: var(--text-secondary);
  }

  /* Password Strength */
  .password-strength {
    display: flex;
    align-items: center;
    gap: 4px;
    margin-top: 0.5rem;
  }

  .strength-bar {
    flex: 1;
    height: 4px;
    background: var(--card-border);
    border-radius: 2px;
    transition: all 0.3s ease;
  }

  .strength-bar.active {
    background: var(--brand-green);
  }

  .strength-bar.active.weak { background: #ef4444; }
  .strength-bar.active.medium { background: #f59e0b; }
  .strength-bar.active.strong { background: var(--brand-green); }

  .strength-text {
    margin-left: auto;
    font-size: 0.75rem;
    color: var(--text-secondary);
  }

  /* Password Requirements */
  .password-requirements {
    background: var(--input-bg);
    border-radius: 8px;
    padding: 1rem;
    margin-top: 1rem;
  }

  .req-title {
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
  }

  .req-list {
    list-style: none;
  }

  .req-item {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    margin-bottom: 0.25rem;
    padding-left: 1.5rem;
    position: relative;
  }

  .req-item::before {
    content: '‚óã';
    position: absolute;
    left: 0;
  }

  .req-item.valid::before {
    content: '‚úì';
    color: var(--brand-green);
  }

  /* Toggle Password */
  .toggle-password {
    position: absolute;
    right: 2.5rem;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.25rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .toggle-password:hover {
    color: var(--brand-green);
  }

  /* Checkboxes */
  .checkbox-container {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    margin-bottom: 1rem;
    cursor: pointer;
    position: relative;
  }

  .checkbox-container input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
  }

  .checkmark {
    flex-shrink: 0;
    width: 20px;
    height: 20px;
    background: var(--input-bg);
    border: 2px solid var(--card-border);
    border-radius: 6px;
    position: relative;
    transition: all 0.2s ease;
  }

  .checkbox-container input:checked ~ .checkmark {
    background: var(--brand-green);
    border-color: var(--brand-green);
  }

  .checkmark::after {
    content: '';
    position: absolute;
    display: none;
    left: 6px;
    top: 2px;
    width: 5px;
    height: 10px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
  }

  .checkbox-container input:checked ~ .checkmark::after {
    display: block;
  }

  .checkbox-text {
    font-size: 0.875rem;
    line-height: 1.4;
    color: var(--text-primary);
  }

  .link {
    color: var(--brand-blue);
    text-decoration: none;
    font-weight: 500;
  }

  .link:hover {
    text-decoration: underline;
  }

  /* Buttons */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.875rem 1.5rem;
    font-size: 0.9375rem;
    font-weight: 600;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
    overflow: hidden;
  }

  .btn.primary {
    background: linear-gradient(135deg, var(--brand-green), #16a34a);
    color: white;
  }

  .btn.primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(34, 197, 94, 0.3);
  }

  .btn.primary:active {
    transform: translateY(0);
  }

  .btn.wfull {
    width: 100%;
  }

  .submit-btn {
    height: 48px;
  }

  .btn-text {
    transition: opacity 0.2s ease;
  }

  .spinner {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    gap: 4px;
  }

  .spinner.hidden {
    display: none;
  }

  .spinner-dot {
    width: 6px;
    height: 6px;
    background: white;
    border-radius: 50%;
    animation: bounce 1.4s infinite ease-in-out both;
  }

  .spinner-dot:nth-child(1) { animation-delay: -0.32s; }
  .spinner-dot:nth-child(2) { animation-delay: -0.16s; }

  @keyframes bounce {
    0%, 80%, 100% { transform: scale(0); }
    40% { transform: scale(1); }
  }

  /* Divider */
  .divider {
    display: flex;
    align-items: center;
    margin: 1.5rem 0;
    color: var(--text-secondary);
    font-size: 0.875rem;
  }

  .divider-line {
    flex: 1;
    height: 1px;
    background: var(--card-border);
  }

  .divider-text {
    padding: 0 1rem;
  }

  /* Social Buttons */
  .social-buttons {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .social-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    padding: 0.875rem 1.5rem;
    background: var(--input-bg);
    border: 2px solid var(--card-border);
    border-radius: 10px;
    color: var(--text-primary);
    font-size: 0.9375rem;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .social-btn:hover {
    background: var(--card-bg);
    border-color: var(--brand-green);
    transform: translateY(-1px);
  }

  .social-btn.google:hover {
    border-color: var(--brand-blue);
  }

  .social-icon {
    width: 20px;
    height: 20px;
  }

  .social-note {
    text-align: center;
    color: var(--text-secondary);
    font-size: 0.75rem;
    margin-top: 0.5rem;
  }

  /* Auth Switch */
  .auth-switch {
    text-align: center;
    margin-top: 1.5rem;
    color: var(--text-secondary);
    font-size: 0.875rem;
  }

  .login-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--brand-blue);
    font-weight: 600;
    text-decoration: none;
    margin-left: 0.5rem;
  }

  .login-link:hover {
    text-decoration: underline;
  }

  /* Progress Indicator */
  .progress-indicator {
    margin-top: 2rem;
  }

  .progress-bar {
    height: 4px;
    background: var(--card-border);
    border-radius: 2px;
    margin-bottom: 0.75rem;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--brand-blue), var(--brand-purple));
    width: 33%;
    transition: width 0.3s ease;
  }

  .progress-steps {
    display: flex;
    justify-content: space-between;
    padding: 0 0.5rem;
  }

  .step {
    font-size: 0.75rem;
    color: var(--text-secondary);
    position: relative;
    padding-top: 1.5rem;
  }

  .step::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 8px;
    height: 8px;
    background: var(--card-border);
    border-radius: 50%;
  }

  .step.active {
    color: var(--brand-purple);
    font-weight: 600;
  }

  .step.active::before {
    background: var(--brand-purple);
  }

  /* Flash Messages */
  .flash {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem 1.25rem;
    border-radius: 10px;
    margin-bottom: 1rem;
    font-size: 0.875rem;
    line-height: 1.4;
  }

  .flash-success {
    background: var(--success-light);
    color: #065f46;
    border: 1px solid #a7f3d0;
  }

  .flash-error {
    background: var(--error-light);
    color: #991b1b;
    border: 1px solid #fecaca;
  }

  .flash-icon {
    flex-shrink: 0;
  }

  .dark-theme .flash-success {
    color: #a7f3d0;
  }

  .dark-theme .flash-error {
    color: #fecaca;
  }

  /* Stamp */
  .stamp {
    display: block;
    text-align: center;
    font-size: 0.75rem;
    color: var(--text-secondary);
    opacity: 0.5;
    margin-bottom: 0.5rem;
  }

  /* Mobile Optimizations for Hisense U50 Lite (360px width) */
  @media (max-width: 360px) {
    .auth-page.mini {
      margin: 0;
      padding: 1.25rem 1rem;
      border-radius: 16px 16px 0 0;
      min-height: 100vh;
      max-width: 100%;
      border: none;
    }

    .auth-page.mini::before {
      height: 3px;
    }

    .page-title {
      font-size: 1.5rem;
    }

    .page-subtitle {
      font-size: 0.8125rem;
    }

    .floating-label input {
      padding: 0.875rem 2.25rem 0.375rem 0.875rem;
      font-size: 0.875rem;
    }

    .btn {
      padding: 0.75rem 1.25rem;
      font-size: 0.875rem;
    }

    .section-title {
      font-size: 0.9375rem;
    }

    .checkbox-text,
    .req-item,
    .field-hint {
      font-size: 0.75rem;
    }

    .progress-steps {
      font-size: 0.6875rem;
    }

    .social-btn {
      padding: 0.75rem 1.25rem;
      font-size: 0.875rem;
    }
  }

  /* Accessibility */
  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  /* Focus styles for keyboard navigation */
  :focus-visible {
    outline: 2px solid var(--brand-green);
    outline-offset: 2px;
  }
</style>

<script nonce="<%= typeof nonce !== 'undefined' ? nonce : '' %>">
  (function () {
    'use strict';

    // Navigation Helper
    const initNavigation = () => {
      document.querySelectorAll('a[data-nav="true"]').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          window.location.href = link.href;
        });
      });
    };

    // Password Toggle
    const initPasswordToggle = () => {
      document.querySelectorAll('.toggle-password').forEach(button => {
        button.addEventListener('click', () => {
          const targetId = button.getAttribute('data-target');
          const input = document.getElementById(targetId);
          if (!input) return;

          const isPassword = input.type === 'password';
          input.type = isPassword ? 'text' : 'password';
          
          const eyeIcon = button.querySelector('svg');
          if (eyeIcon) {
            if (isPassword) {
              eyeIcon.innerHTML = '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line>';
            } else {
              eyeIcon.innerHTML = '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>';
            }
          }
        });
      });
    };

    // Character Counter
    const initCharCounter = () => {
      const usernameInput = document.getElementById('username');
      const charCounter = document.querySelector('.char-counter[data-for="username"]');
      
      if (usernameInput && charCounter) {
        const updateCounter = () => {
          const length = usernameInput.value.length;
          charCounter.textContent = `${length}/30`;
          if (length > 25) {
            charCounter.style.color = '#ef4444';
          } else if (length > 20) {
            charCounter.style.color = '#f59e0b';
          } else {
            charCounter.style.color = 'var(--text-secondary)';
          }
        };
        
        usernameInput.addEventListener('input', updateCounter);
        updateCounter(); // Initial update
      }
    };

    // Password Strength Meter
    const initPasswordStrength = () => {
      const passwordInput = document.getElementById('password');
      const strengthBars = document.querySelectorAll('.strength-bar');
      const strengthText = document.querySelector('.strength-text');
      
      if (!passwordInput) return;

      const calculateStrength = (password) => {
        let score = 0;
        if (password.length >= 6) score++;
        if (password.length >= 10) score++;
        if (/[A-Z]/.test(password) && /[a-z]/.test(password)) score++;
        if (/[0-9]/.test(password)) score++;
        if (/[^A-Za-z0-9]/.test(password)) score++;
        
        return Math.min(score, 4);
      };

      const updateStrength = () => {
        const password = passwordInput.value;
        const strength = calculateStrength(password);
        
        strengthBars.forEach((bar, index) => {
          bar.classList.remove('active', 'weak', 'medium', 'strong');
          if (index < strength) {
            bar.classList.add('active');
            if (strength < 2) bar.classList.add('weak');
            else if (strength < 4) bar.classList.add('medium');
            else bar.classList.add('strong');
          }
        });
        
        if (strengthText) {
          const texts = ['Very Weak', 'Weak', 'Fair', 'Strong', 'Very Strong'];
          strengthText.textContent = texts[strength];
        }
      };
      
      passwordInput.addEventListener('input', updateStrength);
      updateStrength(); // Initial update
    };

    // Password Requirements Checker
    const initPasswordRequirements = () => {
      const passwordInput = document.getElementById('password');
      const requirementItems = document.querySelectorAll('.req-item');
      
      if (!passwordInput) return;

      const checkRequirements = () => {
        const password = passwordInput.value;
        
        requirementItems.forEach(item => {
          const checkType = item.getAttribute('data-check');
          let isValid = false;
          
          switch (checkType) {
            case 'length':
              isValid = password.length >= 6;
              break;
            case 'number':
              isValid = /[0-9]/.test(password);
              break;
            case 'letter':
              isValid = /[a-zA-Z]/.test(password);
              break;
          }
          
          item.classList.toggle('valid', isValid);
        });
      };
      
      passwordInput.addEventListener('input', checkRequirements);
      checkRequirements(); // Initial check
    };

    // Form Validation
    const initFormValidation = () => {
      const form = document.getElementById('signupForm');
      const submitBtn = document.getElementById('submitBtn');
      const btnText = submitBtn?.querySelector('.btn-text');
      const spinner = submitBtn?.querySelector('.spinner');
      
      if (!form) return;

      const validateForm = () => {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const confirm = document.getElementById('confirm').value;
        const age = parseInt(document.getElementById('age').value);
        const ageConfirm = document.getElementById('ageConfirm').checked;
        
        let isValid = true;
        const errors = [];
        
        // Email validation
        if (!email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
          isValid = false;
          errors.push('Please enter a valid email address');
        }
        
        // Password match validation
        if (password !== confirm) {
          isValid = false;
          errors.push('Passwords do not match');
        }
        
        // Age validation
        if (age < 16 || age > 120) {
          isValid = false;
          errors.push('Age must be between 16 and 120');
        }
        
        // Terms agreement validation
        if (!ageConfirm) {
          isValid = false;
          errors.push('You must confirm you are 16+ and agree to terms');
        }
        
        return { isValid, errors };
      };

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const validation = validateForm();
        if (!validation.isValid) {
          // Show errors in a user-friendly way
          alert(validation.errors.join('\n'));
          return;
        }
        
        // Show loading state
        if (btnText) btnText.style.opacity = '0';
        if (spinner) spinner.classList.remove('hidden');
        if (submitBtn) submitBtn.disabled = true;
        
        try {
          // Submit the form
          const formData = new FormData(form);
          const response = await fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: {
              'Accept': 'application/json'
            }
          });
          
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          
          // Success - form will redirect based on server response
          if (btnText) btnText.textContent = 'Account Created!';
          
        } catch (error) {
          console.error('Error:', error);
          alert('Something went wrong. Please try again.');
          
          // Reset button state
          if (btnText) {
            btnText.style.opacity = '1';
            btnText.textContent = 'Create Account';
          }
          if (spinner) spinner.classList.add('hidden');
          if (submitBtn) submitBtn.disabled = false;
        }
      });
    };

    // Progress Indicator
    const initProgressIndicator = () => {
      const formSections = document.querySelectorAll('.form-section');
      const progressFill = document.querySelector('.progress-fill');
      const steps = document.querySelectorAll('.step');
      
      if (!formSections.length || !progressFill) return;

      const updateProgress = () => {
        const firstSection = formSections[0].getBoundingClientRect();
        const viewportHeight = window.innerHeight;
        const scrollPosition = window.scrollY;
        
        let visibleSections = 0;
        formSections.forEach((section, index) => {
          const rect = section.getBoundingClientRect();
          if (rect.top < viewportHeight * 0.8 && rect.bottom > 0) {
            visibleSections++;
            
            // Update active step
            steps.forEach(step => step.classList.remove('active'));
            if (steps[index]) steps[index].classList.add('active');
          }
        });
        
        const progress = (visibleSections / formSections.length) * 100;
        progressFill.style.width = `${progress}%`;
      };
      
      window.addEventListener('scroll', updateProgress);
      window.addEventListener('resize', updateProgress);
      updateProgress(); // Initial update
    };

    // Initialize everything when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      initNavigation();
      initPasswordToggle();
      initCharCounter();
      initPasswordStrength();
      initPasswordRequirements();
      initFormValidation();
      initProgressIndicator();
      
      // Add subtle animation to form
      const form = document.querySelector('.auth-form');
      if (form) {
        form.style.opacity = '0';
        form.style.transform = 'translateY(10px)';
        
        setTimeout(() => {
          form.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
          form.style.opacity = '1';
          form.style.transform = 'translateY(0)';
        }, 100);
      }
    });

  })();
</script>