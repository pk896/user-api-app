<!--views/manage-products.ejs-->
<div class="products-page">
  <!-- Page Header -->
  <div class="page-header">
    <h1>ðŸ“¦ My Products</h1>
    <p class="subtitle">Manage your product inventory and listings</p>
    
    <!-- Only sellers/suppliers can add -->
    <% if (business && ["seller", "supplier"].includes(business.role)) { %>
      <a href="/products/add" class="btn-add-product">
        <span>âž• Add New Product</span>
      </a>
    <% } %>
  </div>

  <!-- Flash messages -->
  <div class="flash-container">
    <% if (success && success.length > 0) { %>
      <div class="flash flash-success">
        <svg class="flash-icon" viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
        </svg>
        <span><%= success %></span>
      </div>
    <% } %>
    <% if (error && error.length > 0) { %>
      <div class="flash flash-error">
        <svg class="flash-icon" viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
        <span><%= error %></span>
      </div>
    <% } %>
  </div>

  <!-- Products Grid -->
  <div class="products-grid <%= themeCss.includes('dark') ? 'dark-theme' : 'light-theme' %>">
    <% if (!products || products.length === 0) { %>
      <div class="empty-state">
        <div class="empty-state-icon">ðŸ“¦</div>
        <h3>No Products Yet</h3>
        <p>You haven't added any products to your inventory.</p>
        <% if (business && ["seller", "supplier"].includes(business.role)) { %>
          <a href="/products/add" class="btn-primary">Add Your First Product</a>
        <% } else { %>
          <p class="empty-state-hint">Only sellers and suppliers can add products</p>
        <% } %>
      </div>
    <% } else { %>
      <% products.forEach(product => { %>
        <div class="product-card">
          <!-- Product Image -->
          <div class="product-image-container">
            <img 
              src="<%= product.imageUrl %>" 
              alt="<%= product.name %>" 
              class="product-image"
              loading="lazy"
            />
            <% if (product.stock === 0) { %>
              <span class="stock-badge out-of-stock">Out of Stock</span>
            <% } else if (product.stock < 10) { %>
              <span class="stock-badge low-stock">Low Stock</span>
            <% } %>
          </div>

          <!-- Product Info -->
          <div class="product-content">
            <div class="product-header">
              <h3 class="product-name"><%= product.name %></h3>
              <span class="product-price">$<%= product.price.toFixed(2) %></span>
            </div>
            
            <div class="product-meta">
              <div class="meta-item">
                <svg class="meta-icon" viewBox="0 0 24 24" width="16" height="16">
                  <path fill="currentColor" d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                </svg>
                <span>Stock: <strong><%= product.stock %></strong></span>
              </div>
              <div class="meta-item">
                <svg class="meta-icon" viewBox="0 0 24 24" width="16" height="16">
                  <path fill="currentColor" d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/>
                </svg>
                <span><%= product.category || 'Uncategorized' %></span>
              </div>
            </div>

            <div class="product-footer">
              <div class="product-date">
                Added: <%= product.createdAt.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %>
              </div>
              
              <div class="product-actions">
                <a href="/products/view/<%= product.customId %>" class="btn-action btn-view">
                  <svg class="action-icon" viewBox="0 0 24 24" width="16" height="16">
                    <path fill="currentColor" d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                  </svg>
                  View
                </a>
                
                <form 
                  action="/products/<%= product.customId %>/delete" 
                  method="POST" 
                  class="delete-form"
                  onsubmit="return confirm('Are you sure you want to delete this product? This action cannot be undone.');"
                >
                  <button type="submit" class="btn-action btn-delete">
                    <svg class="action-icon" viewBox="0 0 24 24" width="16" height="16">
                      <path fill="currentColor" d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                    </svg>
                    Delete
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
      <% }); %>
    <% } %>
  </div>

  <!-- Stats Summary -->
  <% if (products && products.length > 0) { %>
    <div class="stats-summary">
      <div class="stat-card">
        <div class="stat-value"><%= products.length %></div>
        <div class="stat-label">Total Products</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">$<%= products.reduce((sum, p) => sum + (p.price * p.stock), 0).toFixed(2) %></div>
        <div class="stat-label">Total Value</div>
      </div>
      <div class="stat-card">
        <div class="stat-value"><%= products.filter(p => p.stock < 10).length %></div>
        <div class="stat-label">Low Stock</div>
      </div>
    </div>
  <% } %>
</div>

<style>
  /* Products Page Container */
  .products-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 1rem;
  }

  /* Page Header */
  .page-header {
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 2px solid #22C55E; /* Green accent */
  }

  .page-header h1 {
    margin: 0;
    font-size: 2rem;
    color: #0F172A; /* Black */
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .page-header .subtitle {
    margin: 0.5rem 0 1rem;
    color: #64748B;
    font-size: 1rem;
  }

  .dark-theme .page-header h1 {
    color: #F1F5F9;
  }

  .dark-theme .page-header .subtitle {
    color: #94A3B8;
  }

  /* Add Product Button */
  .btn-add-product {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: linear-gradient(135deg, #22C55E 0%, #16A34A 100%); /* Green gradient */
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 10px rgba(34, 197, 94, 0.2);
  }

  .btn-add-product:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
  }

  /* Flash Messages */
  .flash-container {
    margin-bottom: 1.5rem;
  }

  .flash {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem 1.25rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    font-weight: 500;
    animation: slideIn 0.3s ease;
  }

  .flash-success {
    background: linear-gradient(135deg, #DCFCE7 0%, #BBF7D0 100%);
    color: #166534;
    border-left: 4px solid #22C55E; /* Green */
  }

  .flash-error {
    background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%);
    color: #991B1B;
    border-left: 4px solid #EF4444;
  }

  .flash-icon {
    flex-shrink: 0;
  }

  /* Empty State */
  .empty-state {
    grid-column: 1 / -1;
    text-align: center;
    padding: 4rem 2rem;
    background: #F8FAFC;
    border-radius: 12px;
    border: 2px dashed #CBD5E1;
  }

  .dark-theme .empty-state {
    background: rgba(15, 23, 42, 0.5);
    border-color: #334155;
  }

  .empty-state-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
  }

  .empty-state h3 {
    margin: 0 0 0.5rem;
    color: #0F172A;
    font-size: 1.5rem;
  }

  .dark-theme .empty-state h3 {
    color: #F1F5F9;
  }

  .empty-state p {
    color: #64748B;
    margin-bottom: 1.5rem;
  }

  .empty-state-hint {
    font-size: 0.875rem;
    color: #94A3B8;
  }

  .btn-primary {
    background: #2563EB; /* Blue */
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    display: inline-block;
    transition: background 0.3s ease;
  }

  .btn-primary:hover {
    background: #1D4ED8;
  }

  /* Products Grid */
  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  @media (max-width: 640px) {
    .products-grid {
      grid-template-columns: 1fr;
    }
  }

  /* Product Card */
  .product-card {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    border: 1px solid #E2E8F0;
  }

  .dark-theme .product-card {
    background: rgba(15, 23, 42, 0.8); /* Semi-transparent black */
    border-color: #334155;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  .product-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(124, 58, 237, 0.15); /* Purple glow */
  }

  .dark-theme .product-card:hover {
    box-shadow: 0 8px 20px rgba(124, 58, 237, 0.25);
  }

  /* Product Image */
  .product-image-container {
    position: relative;
    height: 180px;
    overflow: hidden;
    background: #F1F5F9;
  }

  .product-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .product-card:hover .product-image {
    transform: scale(1.05);
  }

  .stock-badge {
    position: absolute;
    top: 12px;
    right: 12px;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    color: white;
  }

  .out-of-stock {
    background: #EF4444;
  }

  .low-stock {
    background: #F59E0B;
  }

  /* Product Content */
  .product-content {
    padding: 1.25rem;
  }

  .product-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
  }

  .product-name {
    margin: 0;
    font-size: 1.125rem;
    font-weight: 600;
    color: #0F172A;
    flex: 1;
  }

  .dark-theme .product-name {
    color: #F1F5F9;
  }

  .product-price {
    font-size: 1.25rem;
    font-weight: 700;
    color: #22C55E; /* Green */
    margin-left: 0.5rem;
  }

  /* Product Meta */
  .product-meta {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #E2E8F0;
  }

  .dark-theme .product-meta {
    border-bottom-color: #334155;
  }

  .meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #64748B;
    font-size: 0.875rem;
  }

  .dark-theme .meta-item {
    color: #94A3B8;
  }

  .meta-icon {
    color: #7C3AED; /* Purple */
  }

  /* Product Footer */
  .product-footer {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .product-date {
    font-size: 0.75rem;
    color: #94A3B8;
  }

  .product-actions {
    display: flex;
    gap: 0.5rem;
  }

  /* Action Buttons */
  .btn-action {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.625rem 1rem;
    border-radius: 6px;
    font-weight: 500;
    font-size: 0.875rem;
    text-decoration: none;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .btn-view {
    background: #2563EB; /* Blue */
    color: white;
  }

  .btn-view:hover {
    background: #1D4ED8;
  }

  .btn-delete {
    background: rgba(239, 68, 68, 0.1);
    color: #EF4444;
    border: 1px solid rgba(239, 68, 68, 0.2);
  }

  .btn-delete:hover {
    background: #EF4444;
    color: white;
  }

  .action-icon {
    flex-shrink: 0;
  }

  /* Stats Summary */
  .stats-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid #E2E8F0;
  }

  .dark-theme .stats-summary {
    border-top-color: #334155;
  }

  .stat-card {
    background: linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(124, 58, 237, 0.1) 100%);
    padding: 1.5rem;
    border-radius: 12px;
    text-align: center;
    border: 1px solid rgba(37, 99, 235, 0.2);
  }

  .dark-theme .stat-card {
    background: rgba(37, 99, 235, 0.15);
    border-color: rgba(37, 99, 235, 0.3);
  }

  .stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: #2563EB; /* Blue */
    margin-bottom: 0.25rem;
  }

  .stat-label {
    color: #64748B;
    font-size: 0.875rem;
  }

  .dark-theme .stat-label {
    color: #94A3B8;
  }

  /* Animations */
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>