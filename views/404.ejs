<!-- views/404.ejs -->
<%
  // âœ… Safe nonce (no TDZ/variable shadowing)
  const NONCE = (typeof nonce !== 'undefined' && nonce) ? String(nonce) : '';

  // âœ… Keep styles inside a string (no broken EJS tags)
  const pageStyles = `
  :root{
    --blue:#2563EB;
    --purple:#7C3AED;
    --green:#22C55E;
    --black:#0F172A;

    --bg0:#070A13;
    --bg1:#0B1022;
    --muted:#94A3B8;
    --line:rgba(148,163,184,.18);
    --w:#FFFFFF;

    --r-lg:18px;
    --r-md:14px;
    --r-sm:10px;

    --shadow: 0 18px 55px rgba(2,6,23,.45);
  }

  .nf-wrap{
    min-height: calc(100vh - 40px);
    padding: 1rem;
    display:flex;
    align-items:center;
    justify-content:center;
    background:
      radial-gradient(900px 420px at 20% -10%, rgba(124,58,237,.38), transparent 58%),
      radial-gradient(900px 420px at 95% 0%, rgba(37,99,235,.28), transparent 55%),
      radial-gradient(900px 420px at 70% 105%, rgba(34,197,94,.18), transparent 55%),
      linear-gradient(180deg, var(--bg0), var(--bg1));
    color: var(--w);
  }

  .nf-card{
    width: min(720px, 100%);
    border-radius: var(--r-lg);
    border: 1px solid rgba(124,58,237,.22);
    background: rgba(15,23,42,.72);
    box-shadow: var(--shadow);
    overflow:hidden;
    position:relative;
  }

  .nf-card::before{
    content:"";
    position:absolute; inset:0;
    background: radial-gradient(500px 180px at 10% 0%, rgba(124,58,237,.22), transparent 60%);
    pointer-events:none;
  }

  .nf-top{
    padding: 1.1rem 1.1rem .9rem;
    border-bottom: 1px solid rgba(148,163,184,.14);
    display:flex;
    gap:1rem;
    align-items:flex-start;
    justify-content:space-between;
    flex-wrap:wrap;
  }

  .nf-title{
    margin:0;
    font-size: 1.35rem;
    font-weight: 950;
    display:flex;
    gap:.6rem;
    align-items:center;
    letter-spacing:.2px;
  }

  .nf-sub{
    margin:.35rem 0 0 0;
    color: rgba(226,232,240,.86);
    font-size: .95rem;
    line-height:1.3;
  }

  .nf-badge{
    display:inline-flex;
    align-items:center;
    gap:.4rem;
    padding:.4rem .7rem;
    border-radius:999px;
    border: 1px solid rgba(37,99,235,.25);
    background: rgba(2,6,23,.35);
    color: rgba(226,232,240,.9);
    font-weight: 900;
    font-size:.78rem;
  }

  .nf-body{
    padding: 1rem 1.1rem 1.1rem;
    display:grid;
    gap: .9rem;
  }

  .nf-hint{
    margin:0;
    color: rgba(148,163,184,.95);
    font-size: .92rem;
  }

  .nf-actions{
    display:flex;
    gap:.55rem;
    flex-wrap:wrap;
  }

  .btn{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:.45rem;
    padding:.7rem 1rem;
    border-radius: 999px;
    border:1px solid transparent;
    text-decoration:none;
    cursor:pointer;
    font-weight:900;
    font-size:.92rem;
    user-select:none;
    transition: transform .12s ease, filter .12s ease;
  }

  .btn-primary{
    background: linear-gradient(135deg, rgba(124,58,237,.95), rgba(37,99,235,.9));
    border-color: rgba(124,58,237,.35);
    color: var(--w);
    box-shadow: 0 12px 22px rgba(124,58,237,.18);
  }
  .btn-primary:hover{ transform: translateY(-1px); filter: brightness(1.03); }

  .btn-ghost{
    background: rgba(2,6,23,.35);
    border-color: rgba(148,163,184,.22);
    color: rgba(226,232,240,.92);
  }
  .btn-ghost:hover{ transform: translateY(-1px); }

  .nf-meta{
    margin-top:.3rem;
    padding-top:.8rem;
    border-top: 1px dashed rgba(148,163,184,.18);
    color: rgba(148,163,184,.9);
    font-size: .82rem;
    line-height:1.3;
  }

  code{
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size: .82rem;
    color: rgba(226,232,240,.92);
  }

  @media (max-width: 520px){
    .nf-title{ font-size: 1.2rem; }
    .btn{ width: 100%; }
    .nf-actions{ flex-direction:column; }
  }

  @media (prefers-reduced-motion: reduce){
    *{ transition:none !important; animation:none !important; }
  }
  `;

  // Helpful values (optional)
  const reqPath = (typeof path !== 'undefined' && path) ? String(path) : (typeof url !== 'undefined' && url ? String(url) : '');
  const statusCode = (typeof status !== 'undefined' && status) ? String(status) : '404';
%>

<div class="nf-wrap">
  <section class="nf-card" aria-label="Not found page">
    <header class="nf-top">
      <div>
        <h1 class="nf-title"><span aria-hidden="true">ğŸ§­</span> Page not found</h1>
        <p class="nf-sub">We couldnâ€™t find the page youâ€™re looking for.</p>
      </div>
      <div class="nf-badge" aria-label="HTTP status badge">
        <span aria-hidden="true">âš ï¸</span> <%= statusCode %>
      </div>
    </header>

    <div class="nf-body">
      <p class="nf-hint">
        Try going back, or use one of the quick links below.
      </p>

      <div class="nf-actions" role="group" aria-label="404 actions">
        <a class="btn btn-primary" href="/sales"><span aria-hidden="true">ğŸ›ï¸</span> Browse Products</a>
        <a class="btn btn-ghost" href="/"><span aria-hidden="true">ğŸ </span> Home</a>
        <a class="btn btn-ghost" href="/contact"><span aria-hidden="true">ğŸ’¬</span> Contact Support</a>
      </div>

      <div class="nf-meta">
        <div>Requested path: <code><%= reqPath || 'â€”' %></code></div>
        <div>If this keeps happening, tell us what you clicked.</div>
      </div>
    </div>
  </section>
</div>

<!-- âœ… CSP-safe style injection -->
<style<% if (NONCE) { %> nonce="<%= NONCE %>"<% } %>><%- pageStyles %></style>

<!-- âœ… Optional CSP-safe small script (not required, but safe) -->
<script<% if (NONCE) { %> nonce="<%= NONCE %>"<% } %>>
  (function(){
    // No inline eval, no external calls - CSP-safe
    // Just a tiny helper: focus first primary button for keyboard users
    const btn = document.querySelector('.btn-primary');
    if (btn) btn.focus({ preventScroll: true });
  })();
</script>
