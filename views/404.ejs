<!-- views/404.ejs -->
<%
  // Page-only styles/scripts (CSP-safe with nonce)
  // âœ… IMPORTANT: Use <%- ... %> when injecting CSS/JS strings so it does NOT HTML-escape.

  const pageStyles = `
  /* =========================
     âœ… Unicoporate Brand Tokens
     Purple dominant + Blue + Green + Black
     ========================= */
  :root{
    --blue:#2563EB;
    --blue-dark:#1d4ed8;

    --purple:#7C3AED;
    --purple-dark:#6d28d9;

    --green:#22C55E;
    --green-dark:#16a34a;

    --black:#0F172A;

    --bg:#0b1220;
    --card:rgba(255,255,255,.94);
    --card-2:rgba(255,255,255,.90);
    --ink:#0f172a;
    --muted:#475569;
    --line:rgba(15, 23, 42, .12);

    --radius:18px;
    --radius-sm:12px;

    --shadow: 0 20px 55px rgba(0,0,0,.28);
    --shadow-sm: 0 10px 28px rgba(0,0,0,.18);

    --focus: 0 0 0 4px rgba(124,58,237,.18);

    --trans: all .18s ease;
  }

  /* Dark theme compatibility (if your layout sets body.dark-theme) */
  .dark-theme{
    --card:rgba(15,23,42,.72);
    --card-2:rgba(15,23,42,.64);
    --ink:#e5e7eb;
    --muted:#cbd5e1;
    --line:rgba(148,163,184,.18);
  }

  /* =========================
     âœ… Page wrapper
     ========================= */
  .nf-wrap{
    min-height: calc(100dvh - 1px);
    padding: 1rem;
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;

    background:
      radial-gradient(900px 500px at 20% 15%, rgba(124,58,237,.55) 0%, rgba(124,58,237,0) 60%),
      radial-gradient(900px 500px at 85% 25%, rgba(37,99,235,.30) 0%, rgba(37,99,235,0) 60%),
      radial-gradient(900px 550px at 50% 115%, rgba(34,197,94,.18) 0%, rgba(34,197,94,0) 60%),
      linear-gradient(180deg, #070b14 0%, #0b1220 60%, #070b14 100%);
  }

  .nf-card{
    width: min(520px, 92vw);
    background: var(--card);
    border: 1px solid var(--line);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    position:relative;
    overflow:hidden;
  }

  .nf-card::before{
    content:'';
    position:absolute;
    left:0; top:0; right:0;
    height: 6px;
    background: linear-gradient(90deg, var(--purple), var(--blue), var(--green));
  }

  .nf-inner{
    padding: 1.25rem 1.1rem 1.1rem;
    text-align:center;
  }

  /* =========================
     âœ… Header
     ========================= */
  .nf-badge{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:.45rem;
    padding:.35rem .6rem;
    border-radius:999px;
    border:1px solid var(--line);
    background: linear-gradient(180deg, rgba(124,58,237,.10), rgba(124,58,237,.04));
    color: var(--ink);
    font-weight:900;
    font-size:.82rem;
    line-height:1.1;
  }

  .nf-code{
    margin:.8rem 0 .3rem;
    font-size: 4.1rem;
    line-height:1;
    letter-spacing:-.03em;
    font-weight: 900;
    background: linear-gradient(135deg, var(--purple), var(--blue));
    -webkit-background-clip:text;
    background-clip:text;
    color: transparent;
  }

  .nf-title{
    margin:.15rem 0 .35rem;
    font-size: 1.25rem;
    font-weight: 900;
    color: var(--ink);
  }

  .nf-desc{
    margin: 0 auto;
    max-width: 44ch;
    color: var(--muted);
    font-size: .95rem;
    line-height: 1.55;
  }

  /* =========================
     âœ… Illustration (compact)
     ========================= */
  .nf-illu{
    margin: .95rem auto .75rem;
    width: 170px;
    height: 105px;
    position: relative;
  }

  .nf-illu-base{
    position:absolute;
    left:50%; bottom:0;
    transform: translateX(-50%);
    width: 150px;
    height: 76px;
    border-radius: 16px;
    border: 2px dashed var(--line);
    background: linear-gradient(135deg, rgba(124,58,237,.11), rgba(37,99,235,.06));
  }

  .nf-illu-page{
    position:absolute;
    left:50%; top:0;
    transform: translateX(-50%) rotate(12deg);
    width: 100px;
    height: 68px;
    border-radius: 14px;
    border: 1px solid var(--line);
    background: var(--card-2);
    box-shadow: var(--shadow-sm);
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight: 900;
    color: var(--purple);
  }

  /* =========================
     âœ… Search (dropdown + input)
     ========================= */
  .nf-search{
    margin: .75rem 0 .35rem;
    display:grid;
    gap:.55rem;
  }

  .nf-search-row{
    display:grid;
    grid-template-columns: 120px 1fr 44px;
    gap:.45rem;
    align-items:center;
  }

  .nf-select,
  .nf-input{
    border: 1px solid var(--line);
    border-radius: 12px;
    padding: .72rem .75rem;
    font: inherit;
    background: rgba(255,255,255,.6);
    color: var(--ink);
    outline:none;
    transition: var(--trans);
    min-width:0;
  }

  .dark-theme .nf-select,
  .dark-theme .nf-input{
    background: rgba(15,23,42,.35);
  }

  .nf-input:focus,
  .nf-select:focus{
    border-color: rgba(124,58,237,.55);
    box-shadow: var(--focus);
  }

  .nf-go{
    border: 0;
    border-radius: 12px;
    cursor:pointer;
    font-weight: 900;
    background: var(--purple);
    color: #fff;
    transition: var(--trans);
    height: 44px;
    display:inline-flex;
    align-items:center;
    justify-content:center;
  }

  .nf-go:hover{ background: var(--purple-dark); transform: translateY(-1px); }

  .nf-hint{
    color: var(--muted);
    font-size:.82rem;
    margin:0;
  }

  /* =========================
     âœ… Actions (buttons)
     ========================= */
  .nf-actions{
    display:grid;
    gap:.55rem;
    margin: .9rem 0 .25rem;
  }

  .nf-btn{
    display:flex;
    align-items:center;
    justify-content:center;
    gap:.55rem;
    padding: .78rem 1rem;
    border-radius: 14px;
    text-decoration:none;
    font-weight: 900;
    font-size: .92rem;
    cursor:pointer;
    transition: var(--trans);
    border: 1px solid transparent;
    user-select:none;
  }

  .nf-btn:focus-visible{
    outline:none;
    box-shadow: var(--focus);
  }

  .nf-btn.primary{
    background: var(--purple);
    color:#fff;
  }
  .nf-btn.primary:hover{ background: var(--purple-dark); transform: translateY(-1px); }

  .nf-btn.blue{
    background: var(--blue);
    color:#fff;
  }
  .nf-btn.blue:hover{ background: var(--blue-dark); transform: translateY(-1px); }

  .nf-btn.outline{
    background: transparent;
    color: var(--ink);
    border-color: var(--line);
  }
  .nf-btn.outline:hover{
    border-color: rgba(124,58,237,.55);
    background: rgba(124,58,237,.06);
    transform: translateY(-1px);
  }

  .nf-btn.green{
    background: var(--green);
    color:#0b1220;
  }
  .nf-btn.green:hover{ background: var(--green-dark); color:#fff; transform: translateY(-1px); }

  /* =========================
     âœ… Quick links (chips)
     ========================= */
  .nf-links{
    margin-top: .85rem;
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    gap:.5rem;
  }

  .nf-chip{
    text-decoration:none;
    font-weight: 800;
    font-size:.8rem;
    padding:.38rem .6rem;
    border-radius: 999px;
    border: 1px solid var(--line);
    color: var(--ink);
    background: rgba(255,255,255,.55);
    transition: var(--trans);
  }

  .dark-theme .nf-chip{ background: rgba(15,23,42,.28); }

  .nf-chip:focus-visible{
    outline:none;
    box-shadow: var(--focus);
  }

  .nf-chip.purple:hover{ border-color: rgba(124,58,237,.55); background: rgba(124,58,237,.08); }
  .nf-chip.blue:hover{ border-color: rgba(37,99,235,.55); background: rgba(37,99,235,.08); }
  .nf-chip.green:hover{ border-color: rgba(34,197,94,.55); background: rgba(34,197,94,.08); }

  /* =========================
     âœ… Footer info (no inline styles)
     ========================= */
  .nf-foot{
    margin-top: 1rem;
    padding-top: .85rem;
    border-top: 1px solid var(--line);
    color: var(--muted);
    font-size: .78rem;
    line-height: 1.5;
  }

  .nf-foot a{
    color: var(--blue);
    text-decoration:none;
    font-weight: 900;
  }
  .nf-foot a:hover{ text-decoration: underline; }

  .nf-url{
    margin-top:.35rem;
    opacity:.9;
  }

  .nf-url code{
    display:inline-block;
    padding:.22rem .45rem;
    border-radius: 10px;
    border: 1px solid var(--line);
    background: rgba(15,23,42,.04);
    color: var(--muted);
    max-width: 100%;
    overflow:hidden;
    text-overflow: ellipsis;
    vertical-align: middle;
  }

  .dark-theme .nf-url code{
    background: rgba(255,255,255,.06);
    color:#cbd5e1;
  }

  /* =========================
     âœ… Mobile (Hisense U50 Lite ~360px)
     ========================= */
  @media (max-width: 480px){
    .nf-inner{ padding: 1.05rem .9rem .9rem; }
    .nf-code{ font-size: 3.6rem; }
    .nf-title{ font-size: 1.15rem; }
    .nf-desc{ font-size: .9rem; }

    .nf-illu{ width: 150px; height: 96px; }
    .nf-search-row{ grid-template-columns: 110px 1fr 42px; }
    .nf-go{ height: 42px; }
  }

  @media (max-width: 360px){
    .nf-code{ font-size: 3.25rem; }
    .nf-search-row{ grid-template-columns: 1fr; }
    .nf-go{ width: 100%; height: 44px; }
  }

  @media (prefers-reduced-motion: reduce){
    .nf-btn:hover{ transform:none; }
    .nf-go:hover{ transform:none; }
  }
  `;

  const pageScripts = `
  document.addEventListener('DOMContentLoaded', () => {
    const scopeSel  = document.getElementById('nfScope');
    const input     = document.getElementById('nfSearch');
    const goBtn     = document.getElementById('nfGo');

    const backBtn   = document.querySelector('[data-action="back"]');
    const reportBtn = document.getElementById('nfReport');

    function updatePlaceholder(){
      const scope = (scopeSel && scopeSel.value) ? scopeSel.value : 'all';
      if (!input) return;

      if (scope === 'products') input.placeholder = 'Search products... (e.g., shoes, laptop)';
      else if (scope === 'businesses') input.placeholder = 'Search businesses... (e.g., supplier, store name)';
      else if (scope === 'help') input.placeholder = 'Search help... (e.g., payments, delivery)';
      else input.placeholder = 'Search... (products, businesses, help)';
    }

    function performSearch(){
      const q = (input && input.value) ? input.value.trim() : '';
      if (!q){
        input && input.focus();
        return;
      }

      // âœ… Do NOT change your path: keep /search?q=
      window.location.href = '/search?q=' + encodeURIComponent(q);
    }

    if (scopeSel) scopeSel.addEventListener('change', updatePlaceholder);

    if (input) {
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          performSearch();
        }
      });
    }

    if (goBtn) {
      goBtn.addEventListener('click', (e) => {
        e.preventDefault();
        performSearch();
      });
    }

    if (backBtn) {
      backBtn.addEventListener('click', (e) => {
        e.preventDefault();
        if (window.history.length > 1) window.history.back();
        else window.location.href = '/';
      });
    }

    if (reportBtn) {
      reportBtn.addEventListener('click', (e) => {
        e.preventDefault();
        const currentUrl = window.location.href;
        const mailtoLink =
          'mailto:support@unicoporate.com' +
          '?subject=' + encodeURIComponent('404 Error Report') +
          '&body=' + encodeURIComponent('I encountered a 404 error at: ' + currentUrl);

        window.location.href = mailtoLink;
      });
    }

    // Nice UX: focus input after page loads
    setTimeout(() => { if (input) input.focus(); }, 250);

    console.warn('404 Error - Page not found:', window.location.pathname);
  });
  `;
%>

<!-- âœ… Inject Styles (RAW) -->
<style nonce="<%= nonce %>"><%- pageStyles %></style>

<div class="nf-wrap">
  <section class="nf-card" aria-label="404 - Page Not Found">
    <div class="nf-inner">
      <div class="nf-badge">ğŸ›¡ï¸ Unicoporate.com â€¢ Not Found</div>

      <div class="nf-code">404</div>
      <h1 class="nf-title">Page Not Found</h1>
      <p class="nf-desc">
        The page youâ€™re looking for doesnâ€™t exist (or it was moved). Use search or go back safely.
      </p>

      <div class="nf-illu" aria-hidden="true">
        <div class="nf-illu-page">404</div>
        <div class="nf-illu-base"></div>
      </div>

      <div class="nf-search" aria-label="Search the website">
        <div class="nf-search-row">
          <select id="nfScope" class="nf-select" aria-label="Search scope">
            <option value="all">All</option>
            <option value="products">Products</option>
            <option value="businesses">Businesses</option>
            <option value="help">Help</option>
          </select>

          <input
            id="nfSearch"
            class="nf-input"
            type="search"
            placeholder="Search... (products, businesses, help)"
            aria-label="Search input"
            autocomplete="off"
          />

          <button id="nfGo" class="nf-go" type="button" aria-label="Search">ğŸ”</button>
        </div>

        <p class="nf-hint">Tip: try a product name, category, or â€œpaymentsâ€.</p>
      </div>

      <div class="nf-actions">
        <!-- âœ… DO NOT change paths/links -->
        <a class="nf-btn primary" href="/">
          ğŸ  Go to Homepage
        </a>

        <button class="nf-btn blue" type="button" data-action="back">
          â†©ï¸ Go Back
        </button>

        <a class="nf-btn green" href="/business/signup">
          ğŸš€ Start Your Business
        </a>

        <button id="nfReport" class="nf-btn outline" type="button">
          ğŸ“§ Report This Error
        </button>
      </div>

      <nav class="nf-links" aria-label="Quick links">
        <!-- âœ… DO NOT change paths/links -->
        <a class="nf-chip purple" href="/about">About Us</a>
        <a class="nf-chip blue" href="/contact">Contact Support</a>
        <a class="nf-chip green" href="/privacy">Privacy Policy</a>
        <a class="nf-chip purple" href="/terms">Terms of Service</a>
      </nav>

      <footer class="nf-foot">
        <div>
          Â© <%= new Date().getFullYear() %> Unicoporate.com.
          Need help? <a href="/contact">Contact our support team</a>
        </div>

        <div class="nf-url">
          Error URL:
          <code><%= (typeof req !== 'undefined' && req && req.originalUrl) ? req.originalUrl : '' %></code>
        </div>
      </footer>
    </div>
  </section>
</div>

<!-- âœ… Inject Scripts (RAW) -->
<script nonce="<%= nonce %>"><%- pageScripts %></script>
