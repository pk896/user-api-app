<!-- views/business-change-email.ejs -->
<% const NONCE = typeof nonce !== 'undefined' ? nonce : '' %>
<% const b = business || {} %>

<main class="ce-page">
  <section class="ce-wrap">
    <header class="ce-hdr">
      <div class="ce-badge">BUSINESS • SECURITY</div>
      <h1 class="ce-title"><%= title || 'Change Email' %></h1>
      <p class="ce-sub">
        Update your login email. We will send a new verification link to the new address.
      </p>
    </header>

    <!-- Flash -->
    <% if (success && success.length) { %><div class="flash flash-success"><%= success[0] %></div><% } %>
    <% if (error && error.length) { %><div class="flash flash-error"><%= error[0] %></div><% } %>
    <% if (warning && warning.length) { %><div class="flash flash-warning"><%= warning[0] %></div><% } %>
    <% if (info && info.length) { %><div class="flash flash-info"><%= info[0] %></div><% } %>

    <section class="ce-card">
      <div class="ce-row">
        <div class="ce-pill ce-pill-purple">Purple is dominant</div>
        <a class="ce-back" href="/business/verify-pending">← Back to verify</a>
      </div>

      <div class="ce-kv">
        <div class="k">Current Email</div>
        <div class="v mono"><%= b.email || '—' %></div>
      </div>

      <form method="POST" action="/business/change-email" class="ce-form" autocomplete="on">
        <div class="field">
          <label for="newEmail">New Email</label>
          <input
            id="newEmail"
            name="newEmail"
            type="email"
            placeholder="e.g. newemail@gmail.com"
            required
          />
          <div class="hint">We will send a verification link to this address.</div>
        </div>

        <div class="field">
          <label for="password">Confirm Password</label>
          <input
            id="password"
            name="password"
            type="password"
            placeholder="Enter your current password"
            required
          />
          <div class="hint">For security, we confirm it’s really you.</div>
        </div>

        <button class="btn btn-purple" type="submit" id="ceBtn">Update Email & Send Link</button>
      </form>

      <div class="ce-note">
        <div class="ce-note-title">What happens next?</div>
        <ul class="ce-ul">
          <li>Your email changes immediately.</li>
          <li>Your account returns to <b>unverified</b> until you click the new email link.</li>
          <li>If you don’t receive it, go back and use <b>Resend</b>.</li>
        </ul>
      </div>
    </section>
  </section>
</main>

<style nonce="<%= NONCE %>">
  :root{
    --blue:#2563EB; --purple:#7C3AED; --green:#22C55E; --black:#0F172A;
    --slate:#64748b; --border: rgba(15,23,42,.12);
  }

  .ce-page{ padding: 1rem; }
  .ce-wrap{ max-width: 760px; margin: 0 auto; display: grid; gap: .9rem; }

  .ce-hdr{
    border-radius: 18px;
    padding: 1rem;
    background: linear-gradient(135deg, rgba(124,58,237,.18), rgba(37,99,235,.10));
    border: 1px solid rgba(124,58,237,.28);
  }
  .ce-badge{
    display:inline-flex; width: fit-content;
    padding:.25rem .6rem; border-radius:999px;
    font-weight: 950; font-size:.72rem; letter-spacing:.08em;
    background: rgba(124,58,237,.16); color: var(--purple);
    border: 1px solid rgba(124,58,237,.28);
  }
  .ce-title{ margin:.35rem 0 0; font-size: 1.25rem; font-weight: 950; color: var(--black); }
  .ce-sub{ margin:.25rem 0 0; color: var(--slate); font-weight: 700; font-size:.88rem; }

  .ce-card{
    border-radius: 18px;
    padding: 1rem;
    background: rgba(255,255,255,.92);
    border: 1px solid var(--border);
  }

  .ce-row{ display:flex; justify-content:space-between; gap:.75rem; flex-wrap:wrap; align-items:center; margin-bottom:.75rem; }
  .ce-pill{
    display:inline-flex; align-items:center;
    padding:.28rem .65rem; border-radius:999px;
    font-size:.72rem; font-weight: 950;
    border: 1px solid rgba(124,58,237,.25);
  }
  .ce-pill-purple{ background: rgba(124,58,237,.14); color: var(--purple); }
  .ce-back{
    text-decoration:none; font-weight: 900; color: var(--blue);
    padding:.5rem .7rem; border-radius: 14px;
    background: rgba(37,99,235,.10); border: 1px solid rgba(37,99,235,.20);
  }

  .ce-kv{ display:flex; justify-content:space-between; gap:.75rem; padding:.75rem; border-radius: 16px; background: rgba(15,23,42,.06); border: 1px solid rgba(15,23,42,.10); }
  .k{ font-size:.75rem; font-weight: 950; color: var(--purple); }
  .v{ font-size:.9rem; font-weight: 900; color: var(--black); text-align:right; word-break: break-word; }
  .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }

  .ce-form{ display:grid; gap:.75rem; margin-top:.9rem; }
  .field{ padding:.75rem; border-radius: 16px; border: 1px solid rgba(124,58,237,.16); background: rgba(124,58,237,.06); }
  label{ display:block; font-size:.75rem; font-weight: 950; color: var(--purple); margin-bottom:.4rem; }
  input{
    width:100%;
    padding:.8rem .85rem;
    border-radius: 16px;
    border: 1.5px solid rgba(15,23,42,.12);
    font-size: .95rem;
    outline:none;
    background:#fff;
  }
  input:focus{ border-color: rgba(124,58,237,.70); box-shadow: 0 0 0 3px rgba(124,58,237,.14); }
  .hint{ margin-top:.4rem; color: var(--slate); font-weight: 700; font-size:.8rem; }

  .btn{
    min-height: 48px;
    border-radius: 16px;
    border: 1px solid transparent;
    font-weight: 950;
    font-size: .95rem;
    padding: .85rem 1rem;
    cursor:pointer;
  }
  .btn-purple{ background: var(--purple); color:#fff; box-shadow: 0 14px 32px rgba(124,58,237,.18); }

  .ce-note{
    margin-top: .9rem;
    border-radius: 18px;
    padding: .9rem;
    background: rgba(34,197,94,.10);
    border: 1px solid rgba(34,197,94,.22);
  }
  .ce-note-title{ font-weight: 950; color: var(--black); margin-bottom:.35rem; }
  .ce-ul{ margin:.2rem 0 0 1.1rem; color: var(--black); font-weight: 800; }
  .ce-ul li{ margin:.25rem 0; }

  .flash{ padding:12px 14px; border-radius:14px; margin:0; font-weight:900; }
  .flash-success{ background:#DCFCE7; color:#166534; border:1px solid rgba(34,197,94,.25); }
  .flash-error{ background:#FEE2E2; color:#991b1b; border:1px solid rgba(239,68,68,.25); }
  .flash-warning{ background:#FEF3C7; color:#92400e; border:1px solid rgba(245,158,11,.25); }
  .flash-info{ background:#DBEAFE; color:#1e40af; border:1px solid rgba(37,99,235,.25); }
</style>

<script nonce="<%= NONCE %>">
  (function(){
    const btn = document.getElementById('ceBtn');
    if (!btn) return;
    btn.addEventListener('click', function(){
      btn.disabled = true;
      btn.textContent = 'Updating...';
    });
  })();
</script>
