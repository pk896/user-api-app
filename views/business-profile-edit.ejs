<!--viewa/business-profile-edit.ejs-->
<section class="business-edit-page">
  <h1 class="page-title">‚úèÔ∏è Edit Business Profile</h1>
  <p class="subtitle">
    Update your business contact details. Your login email stays protected for security.
  </p>

  <!-- Flash messages -->
  <% (success || []).forEach(msg => { %>
    <div class="flash flash-success">‚úÖ <%= msg %></div>
  <% }) %>
  <% (error || []).forEach(msg => { %>
    <div class="flash flash-error">‚ùå <%= msg %></div>
  <% }) %>

  <% const isVerified = business && business.isVerified; %>

  <form
    action="/business/profile/edit"
    method="POST"
    class="business-form"
  >
    <!-- Readonly email + role row -->
    <div class="readonly-row">
      <div class="readonly-field">
        <label>Email</label>
        <div class="value-with-badge">
          <span><%= business.email %></span>
          <% if (isVerified) { %>
            <span class="badge badge-verified">‚úÖ Verified</span>
          <% } else { %>
            <span class="badge badge-unverified">‚ö†Ô∏è Not verified</span>
          <% } %>
        </div>
        <p class="hint">
          Email changes affect login and verification.  
          Use the verification page to confirm this address or contact support to change it.
        </p>
      </div>

      <div class="readonly-field">
        <label>Role</label>
        <div class="readonly-value">
          <%= business.role && business.role.toUpperCase() %>
        </div>
      </div>
    </div>

    <!-- Editable fields -->
    <div class="form-grid">
      <div class="field">
        <label for="name">Business Name <span class="required">*</span></label>
        <input
          type="text"
          id="name"
          name="name"
          value="<%= business.name %>"
          required
        />
      </div>

      <div class="field">
        <label for="phone">Phone <span class="required">*</span></label>
        <input
          type="text"
          id="phone"
          name="phone"
          value="<%= business.phone %>"
          required
        />
      </div>

      <div class="field">
        <label for="country">Country <span class="required">*</span></label>
        <input
          type="text"
          id="country"
          name="country"
          value="<%= business.country %>"
          required
        />
      </div>

      <div class="field">
        <label for="city">City <span class="required">*</span></label>
        <input
          type="text"
          id="city"
          name="city"
          value="<%= business.city %>"
          required
        />
      </div>

      <div class="field field-full">
        <label for="address">Address <span class="required">*</span></label>
        <input
          type="text"
          id="address"
          name="address"
          value="<%= business.address %>"
          required
        />
      </div>

      <div class="field field-full">
        <label for="password">
          New Password
          <small>(leave blank to keep current)</small>
        </label>
        <input
          type="password"
          id="password"
          name="password"
          placeholder="Enter new password"
          autocomplete="new-password"
        />
        <p class="hint">
          Minimum 6 characters. Use a unique password you don‚Äôt reuse anywhere else.
        </p>
      </div>
    </div>

    <div class="actions-row">
      <button type="submit" class="btn primary">üíæ Save changes</button>
      <a href="/business/profile" class="btn light">‚ùå Cancel</a>
    </div>
  </form>
</section>

<style nonce="<%= nonce %>">
  .business-edit-page {
    max-width: 800px;
    margin: 0 auto 2rem;
    padding: 1rem;
  }

  .page-title {
    margin-top: .4rem;
    font-size: 1.6rem;
    font-weight: 800;
    text-align: center;
  }

  .subtitle {
    text-align: center;
    margin: .2rem 0 1rem;
    color: #6b7280;
  }
  .dark-theme .subtitle { color: #cbd5e1; }

  .flash {
    padding: .6rem .9rem;
    border-radius: .6rem;
    margin: .4rem auto;
    max-width: 700px;
    font-weight: 600;
  }
  .flash-success {
    background: #dcfce7;
    color: #166534;
    border: 1px solid #86efac;
  }
  .flash-error {
    background: #fee2e2;
    color: #b91c1c;
    border: 1px solid #fecaca;
  }

  .business-form {
    margin-top: 1rem;
    padding: 1rem;
    border-radius: .9rem;
    background: #ffffff;
    border: 1px solid rgba(148, 163, 184, .2);
    box-shadow: 0 1px 4px rgba(15, 23, 42, 0.06);
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .dark-theme .business-form {
    background: #020617;
    border-color: #1f2937;
  }

  .readonly-row {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: .3rem;
  }
  .readonly-field {
    flex: 1 1 220px;
  }

  .business-form label {
    font-weight: 700;
    font-size: .9rem;
    margin-bottom: .25rem;
    display: block;
  }

  .readonly-value {
    padding: .55rem .7rem;
    border-radius: .7rem;
    background: #f3f4f6;
    border: 1px solid #e5e7eb;
    font-weight: 600;
    font-size: .95rem;
  }
  .dark-theme .readonly-value {
    background: #1f2937;
    border-color: #374151;
    color: #e5e7eb;
  }

  .value-with-badge {
    display: inline-flex;
    flex-wrap: wrap;
    align-items: center;
    gap: .4rem;
    padding: .55rem .7rem;
    border-radius: .7rem;
    background: #f3f4f6;
    border: 1px solid #e5e7eb;
    font-weight: 600;
    font-size: .95rem;
  }
  .dark-theme .value-with-badge {
    background: #1f2937;
    border-color: #374151;
    color: #e5e7eb;
  }

  .badge {
    padding: .15rem .5rem;
    border-radius: 999px;
    font-size: .75rem;
    font-weight: 700;
  }
  .badge-verified {
    background: #dcfce7;
    color: #166534;
    border: 1px solid #86efac;
  }
  .badge-unverified {
    background: #fef3c7;
    color: #92400e;
    border: 1px solid #fde68a;
  }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: .9rem .9rem;
  }

  .field {
    display: flex;
    flex-direction: column;
  }
  .field-full {
    grid-column: 1 / -1;
  }

  .business-form input {
    padding: .55rem .6rem;
    border-radius: .6rem;
    border: 1px solid #d1d5db;
    font-size: .95rem;
  }
  .business-form input:focus {
    outline: none;
    border-color: #2563eb;
    box-shadow: 0 0 0 1px rgba(37, 99, 235, .3);
  }
  .dark-theme .business-form input {
    background: #111827;
    border-color: #4b5563;
    color: #e5e7eb;
  }

  .required {
    color: #dc2626;
  }

  .hint {
    margin-top: .2rem;
    font-size: .8rem;
    color: #6b7280;
  }
  .dark-theme .hint { color: #9ca3af; }

  .actions-row {
    display: flex;
    flex-wrap: wrap;
    gap: .6rem;
    margin-top: .3rem;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: .3rem;
    padding: .45rem .9rem;
    border-radius: .7rem;
    border: 1px solid #e5e7eb;
    background: #f9fafb;
    color: #111827;
    font-weight: 700;
    font-size: .86rem;
    text-decoration: none;
    cursor: pointer;
  }
  .btn.primary {
    background: #2563eb;
    border-color: #1d4ed8;
    color: #fff;
  }
  .btn.light {
    background: #f3f4f6;
    border-color: #e5e7eb;
  }
</style>
