<!-- views/business-profile-edit.ejs -->
<% const NONCE = typeof nonce !== 'undefined' ? nonce : '' %>
<% const payouts = (business && business.payouts) ? business.payouts : {}; %>
<% const payoutsEnabled = typeof payouts.enabled === 'boolean' ? payouts.enabled : false %>
<% const paypalEmail = payouts.paypalEmail || '' %>

<div class="bp-edit-page">
  <!-- Header Section -->
  <div class="bp-page-header">
    <div class="bp-header-content">
      <div class="bp-header-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" width="28" height="28">
          <path fill="currentColor" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
        </svg>
      </div>
      <div class="bp-header-text">
        <h1 class="bp-title">Edit Business Profile</h1>
        <p class="bp-subtitle">
          Update your business information and settings. If you change your email, you‚Äôll need to verify it again.
        </p>

        <!-- Brand chips -->
        <div class="bp-brand-chips" aria-label="Brand colors">
          <span class="chip c-purple">Purple</span>
          <span class="chip c-blue">Blue</span>
          <span class="chip c-green">Green</span>
          <span class="chip c-black">Black</span>
        </div>
      </div>
    </div>

    <a href="/business/profile" class="bp-back">
      <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
        <path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
      </svg>
      Back to Profile
    </a>
  </div>

  <!-- Flash Messages (kept ‚Äì but fully scoped so it won't affect layout) -->
  <div class="bp-flash">
    <% (success || []).forEach(msg => { %>
      <div class="flash flash-success">
        <svg class="flash-icon" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
          <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
        </svg>
        <div class="flash-content">
          <strong>Success</strong>
          <p><%= msg %></p>
        </div>
      </div>
    <% }) %>

    <% (error || []).forEach(msg => { %>
      <div class="flash flash-error">
        <svg class="flash-icon" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
          <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
        </svg>
        <div class="flash-content">
          <strong>Error</strong>
          <p><%= msg %></p>
        </div>
      </div>
    <% }) %>
  </div>

  <!-- Main Layout -->
  <div class="bp-grid">

    <!-- Sidebar -->
    <aside class="bp-sidebar">
      <!-- Status Card -->
      <div class="card card-blue">
        <div class="card-head">
          <div class="card-head-left">
            <div class="card-ic ic-blue" aria-hidden="true">üõ°Ô∏è</div>
            <div>
              <h2>Business Status</h2>
              <p class="muted">Account + verification snapshot</p>
            </div>
          </div>
          <span class="status-dot <%= business.isVerified ? 'ok' : 'warn' %>" title="Email verified indicator"></span>
        </div>

        <div class="card-body">
          <div class="row">
            <span class="k">Account Type</span>
            <span class="v"><%= business.role ? (business.role.charAt(0).toUpperCase() + business.role.slice(1)) : 'Business' %></span>
          </div>

          <!-- Email verification -->
          <div class="row">
            <span class="k">Email</span>
            <span class="v">
              <% if (business.isVerified) { %>
                <span class="pill pill-green">Verified</span>
              <% } else { %>
                <span class="pill pill-amber">Unverified</span>
              <% } %>
            </span>
          </div>

          <!-- Business number verification -->
          <div class="row row-top">
            <span class="k">Business Number</span>
            <span class="v v-stack">
              <% const v = (business.verification && business.verification.status) ? business.verification.status : 'unverified'; %>

              <% if (v === 'verified') { %>
                <span class="pill pill-green">Verified</span>
              <% } else if (v === 'pending') { %>
                <span class="pill pill-amber">Pending</span>
              <% } else if (v === 'rejected') { %>
                <span class="pill pill-red">Rejected</span>
                <% if (business.verification && business.verification.reason) { %>
                  <span class="mini-note">
                    <strong>Reason:</strong> <%= business.verification.reason %>
                  </span>
                <% } %>
              <% } else { %>
                <span class="pill pill-amber">Not Verified</span>
              <% } %>
            </span>
          </div>

          <!-- Payouts snapshot -->
          <div class="row row-top">
            <span class="k">PayPal Payouts</span>
            <span class="v v-stack">
              <% if (payoutsEnabled) { %>
                <span class="pill pill-green">Enabled</span>
              <% } else { %>
                <span class="pill pill-amber">Disabled</span>
              <% } %>

              <% if (paypalEmail) { %>
                <span class="mini-note"><strong>To:</strong> <%= paypalEmail %></span>
              <% } else { %>
                <span class="mini-note">No PayPal email set</span>
              <% } %>
            </span>
          </div>

          <div class="row">
            <span class="k">Member Since</span>
            <span class="v">
              <%= business.createdAt ? new Date(business.createdAt).toLocaleDateString('en-US', { month: 'short', year: 'numeric' }) : 'Recently' %>
            </span>
          </div>
        </div>

        <% const bnStatus = business.verification?.status || 'unverified'; %>
        <% if (!business.isVerified || bnStatus !== 'verified') { %>
          <div class="card-foot">
            <p class="note">‚ö†Ô∏èthis page handles sensetive business infomation</p>
            <a href="/privacy" class="btn btn-primary btn-full">
              <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
                <path fill="currentColor" d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
              </svg>
              Unicoporate regularly monitors accounts to ensure compliance with our terms.<br><br>TO REGULARLY UPGRADE YOUR BUSINESS SECURITY IS OUR PRIORITY.
            </a>
          </div>
        <% } %>
      </div>

      <!-- Quick Actions -->
      <div class="card card-purple">
        <div class="card-head">
          <div class="card-head-left">
            <div class="card-ic ic-purple" aria-hidden="true">‚ö°</div>
            <div>
              <h2>Quick Actions</h2>
              <p class="muted">Fast navigation</p>
            </div>
          </div>
          <span class="tag tag-purple">Links</span>
        </div>

        <div class="card-body action-list">
          <a href="/business/profile" class="action-item">
            <span class="a-ic" aria-hidden="true">üë§</span>
            <span class="a-txt">View Profile</span>
            <span class="a-go" aria-hidden="true">‚Ä∫</span>
          </a>

          <a href="/business/verify" class="action-item">
            <span class="a-ic" aria-hidden="true">‚úÖ</span>
            <span class="a-txt">Account Verification</span>
            <span class="a-go" aria-hidden="true">‚Ä∫</span>
          </a>

          <a href="/business/settings" class="action-item">
            <span class="a-ic" aria-hidden="true">‚öôÔ∏è</span>
            <span class="a-txt">Settings</span>
            <span class="a-go" aria-hidden="true">‚Ä∫</span>
          </a>
        </div>
      </div>
    </aside>

    <!-- Main Form -->
    <main class="bp-main">
      <form
        action="/business/profile/edit"
        method="POST"
        class="form card card-black"
        id="profileEditForm"
        autocomplete="on"
      >
        <!-- Account Information -->
        <section class="section section-purple">
          <header class="section-head">
            <div class="section-left">
              <span class="s-ic s-purple" aria-hidden="true">üìß</span>
              <div>
                <h3>Account Information</h3>
                <p>Email updates may require verification again</p>
              </div>
            </div>
            <span class="tag tag-purple">Important</span>
          </header>

          <div class="grid">
            <div class="field full">
              <label for="email">Email Address <span class="req">*</span></label>
              <div class="input-ic">
                <span class="ii" aria-hidden="true">‚úâÔ∏è</span>
                <input
                  type="email"
                  id="email"
                  name="email"
                  value="<%= business.email || '' %>"
                  required
                  placeholder="admin@company.com"
                  autocomplete="email"
                  inputmode="email"
                />
              </div>

              <div class="hintline">
                <% if (business.isVerified) { %>
                  <span class="pill pill-green">Verified</span>
                <% } else { %>
                  <span class="pill pill-amber">Unverified</span>
                <% } %>
                <span class="hint">
                  Changing your email will require verification again. We‚Äôll send a new link to the new email.
                </span>
              </div>
            </div>
          </div>
        </section>

        <!-- Business Details -->
        <section class="section section-blue">
          <header class="section-head">
            <div class="section-left">
              <span class="s-ic s-blue" aria-hidden="true">üè¢</span>
              <div>
                <h3>Business Details</h3>
                <p>Keep details accurate for payouts and verification</p>
              </div>
            </div>
            <span class="tag tag-blue">Profile</span>
          </header>

          <div class="grid">
            <div class="field">
              <label for="name">Business Name <span class="req">*</span></label>
              <input
                type="text"
                id="name"
                name="name"
                value="<%= business.name || '' %>"
                required
                placeholder="Enter business name"
                autocomplete="organization"
              />
            </div>

            <div class="field">
              <label for="phone">Phone Number <span class="req">*</span></label>
              <div class="input-ic">
                <span class="ii" aria-hidden="true">üìû</span>
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  value="<%= business.phone || '' %>"
                  required
                  placeholder="+27..."
                  autocomplete="tel"
                />
              </div>
            </div>

            <div class="field">
              <label for="country">Country <span class="req">*</span></label>
              <input
                type="text"
                id="country"
                name="country"
                value="<%= business.country || '' %>"
                required
                placeholder="South Africa"
                autocomplete="country-name"
              />
            </div>

            <div class="field">
              <label for="city">City <span class="req">*</span></label>
              <input
                type="text"
                id="city"
                name="city"
                value="<%= business.city || '' %>"
                required
                placeholder="Johannesburg"
                autocomplete="address-level2"
              />
            </div>

            <div class="field full">
              <label for="address">Business Address <span class="req">*</span></label>
              <div class="input-ic">
                <span class="ii" aria-hidden="true">üìç</span>
                <input
                  type="text"
                  id="address"
                  name="address"
                  value="<%= business.address || '' %>"
                  required
                  placeholder="Full business address"
                  autocomplete="street-address"
                />
              </div>
            </div>
          </div>
        </section>

        <!-- Representative (required by schema) -->
        <section class="section section-purple">
          <header class="section-head">
            <div class="section-left">
              <span class="s-ic s-purple" aria-hidden="true">üßë‚Äçüíº</span>
              <div>
                <h3>Authorized Representative</h3>
                <p>Required: person responsible for this business account</p>
              </div>
            </div>
            <span class="tag tag-purple">Required</span>
          </header>

          <div class="grid">
            <div class="field">
              <label for="repFullName">Full Name <span class="req">*</span></label>
              <input
                id="repFullName"
                name="representative[fullName]"
                type="text"
                value="<%= (business.representative && business.representative.fullName) ? business.representative.fullName : '' %>"
                required
                placeholder="Representative full name"
                autocomplete="name"
              />
            </div>

            <div class="field">
              <label for="repPhone">Phone <span class="req">*</span></label>
              <input
                id="repPhone"
                name="representative[phone]"
                type="tel"
                value="<%= (business.representative && business.representative.phone) ? business.representative.phone : '' %>"
                required
                placeholder="+27..."
                autocomplete="tel"
              />
            </div>

            <div class="field full">
              <label for="repIdNumber">ID Number <span class="req">*</span></label>
              <input
                id="repIdNumber"
                name="representative[idNumber]"
                type="text"
                value="<%= (business.representative && business.representative.idNumber) ? business.representative.idNumber : '' %>"
                required
                placeholder="Representative ID number"
                autocomplete="off"
              />
              <p class="help">Used for security and account ownership verification.</p>
            </div>
          </div>
        </section>

        <!-- Business Number (required by schema) -->
        <section class="section section-purple">
          <header class="section-head">
            <div class="section-left">
              <span class="s-ic s-purple" aria-hidden="true">üßæ</span>
              <div>
                <h3>Business Number</h3>
                <p>Required: official number used for verification</p>
              </div>
            </div>
            <span class="tag tag-purple">Required</span>
          </header>

          <div class="grid">
            <div class="field">
              <label for="officialNumber">Business Number <span class="req">*</span></label>
              <input
                type="text"
                id="officialNumber"
                name="officialNumber"
                value="<%= business.officialNumber || '' %>"
                required
                placeholder="Registration / VAT / Tax number"
                autocomplete="off"
              />
              <p class="help">Changing this may trigger re-verification of your business details.</p>
            </div>

            <div class="field">
              <label for="officialNumberType">Business Number Type <span class="req">*</span></label>
              <select id="officialNumberType" name="officialNumberType" required>
                <option value="CIPC_REG" <%= business.officialNumberType === 'CIPC_REG' ? 'selected' : '' %>>Company Registration</option>
                <option value="VAT" <%= business.officialNumberType === 'VAT' ? 'selected' : '' %>>VAT Number</option>
                <option value="TIN" <%= business.officialNumberType === 'TIN' ? 'selected' : '' %>>Tax Identification Number</option>
                <option value="OTHER" <%= (!business.officialNumberType || business.officialNumberType === 'OTHER') ? 'selected' : '' %>>Other</option>
              </select>
              <p class="help">Must match your official number type.</p>
            </div>
          </div>
        </section>

        <!-- Bank Details -->
        <section class="section section-green">
          <header class="section-head">
            <div class="section-left">
              <span class="s-ic s-green" aria-hidden="true">üè¶</span>
              <div>
                <h3>Bank Details</h3>
                <p>Optional, but recommended for payouts</p>
              </div>
            </div>
            <span class="tag tag-green">Payouts</span>
          </header>

          <div class="grid">
            <!-- ‚úÖ PayPal Email (for payouts) -->
            <div class="field full">
              <label for="paypalEmail">PayPal Email (for payouts)</label>
              <div class="input-ic">
                <span class="ii" aria-hidden="true">üÖøÔ∏è</span>
                <input
                  type="email"
                  id="paypalEmail"
                  name="paypalEmail"
                  value="<%= paypalEmail %>"
                  placeholder="paypal@email.com"
                  autocomplete="email"
                  inputmode="email"
                />
              </div>
              <p class="help">Leave empty to disable PayPal payouts (or toggle payouts off).</p>
            </div>

            <!-- ‚úÖ Enable PayPal Payouts -->
            <div class="field full">
              <label>Enable PayPal Payouts</label>

              <!-- Hidden so backend ALWAYS receives a value (0) even when unchecked -->
              <input type="hidden" name="payoutsEnabled" value="0" />

              <label class="toggle">
                <input
                  type="checkbox"
                  name="payoutsEnabled"
                  value="1"
                  <%= payoutsEnabled ? 'checked' : '' %>
                />
                <span class="toggle-ui" aria-hidden="true"></span>
                <span class="toggle-text" data-on="Enabled" data-off="Disabled">
                  <%= payoutsEnabled ? 'Enabled' : 'Disabled' %>
                </span>
              </label>

              <p class="help">To be eligible: payouts enabled + PayPal email set + available balance.</p>
            </div>

            <!-- ‚úÖ Bank Details -->
            <div class="field">
              <label for="bankAccountHolderName">Account Holder Name</label>
              <input
                id="bankAccountHolderName"
                name="bankDetails[accountHolderName]"
                type="text"
                value="<%= (business.bankDetails && business.bankDetails.accountHolderName) ? business.bankDetails.accountHolderName : '' %>"
                placeholder="Full name / business name"
                autocomplete="name"
              />
            </div>

            <div class="field">
              <label for="bankName">Bank Name</label>
              <input
                id="bankName"
                name="bankDetails[bankName]"
                type="text"
                value="<%= (business.bankDetails && business.bankDetails.bankName) ? business.bankDetails.bankName : '' %>"
                placeholder="e.g., Standard Bank"
                autocomplete="off"
              />
            </div>

            <div class="field">
              <label for="bankAccountNumber">Account Number</label>
              <input
                id="bankAccountNumber"
                name="bankDetails[accountNumber]"
                type="text"
                value="<%= (business.bankDetails && business.bankDetails.accountNumber) ? business.bankDetails.accountNumber : '' %>"
                placeholder="Account number"
                autocomplete="off"
                inputmode="numeric"
              />
              <p class="help">For security, this might not be prefilled if you mask bank details in views.</p>
            </div>

            <div class="field">
              <label for="bankAccountType">Account Type</label>
              <select id="bankAccountType" name="bankDetails[accountType]">
                <option value="" <%= !(business.bankDetails && business.bankDetails.accountType) ? 'selected' : '' %>>Select account type</option>
                <option value="Savings" <%= (business.bankDetails && business.bankDetails.accountType === 'Savings') ? 'selected' : '' %>>Savings</option>
                <option value="Current" <%= (business.bankDetails && business.bankDetails.accountType === 'Current') ? 'selected' : '' %>>Current</option>
                <option value="Cheque" <%= (business.bankDetails && business.bankDetails.accountType === 'Cheque') ? 'selected' : '' %>>Cheque</option>
                <option value="Business" <%= (business.bankDetails && business.bankDetails.accountType === 'Business') ? 'selected' : '' %>>Business</option>
                <option value="Other" <%= (business.bankDetails && business.bankDetails.accountType === 'Other') ? 'selected' : '' %>>Other</option>
              </select>
            </div>

            <div class="field">
              <label for="bankBranchCode">Branch Code</label>
              <input
                id="bankBranchCode"
                name="bankDetails[branchCode]"
                type="text"
                value="<%= (business.bankDetails && business.bankDetails.branchCode) ? business.bankDetails.branchCode : '' %>"
                placeholder="Branch code"
                autocomplete="off"
              />
            </div>

            <div class="field">
              <label for="bankSwiftCode">SWIFT Code</label>
              <input
                id="bankSwiftCode"
                name="bankDetails[swiftCode]"
                type="text"
                value="<%= (business.bankDetails && business.bankDetails.swiftCode) ? business.bankDetails.swiftCode : '' %>"
                placeholder="SWIFT / BIC"
                autocomplete="off"
              />
            </div>

            <div class="field">
              <label for="bankIban">IBAN</label>
              <input
                id="bankIban"
                name="bankDetails[iban]"
                type="text"
                value="<%= (business.bankDetails && business.bankDetails.iban) ? business.bankDetails.iban : '' %>"
                placeholder="IBAN (if applicable)"
                autocomplete="off"
              />
            </div>

            <div class="field">
              <label for="bankCurrency">Payout Currency</label>
              <select id="bankCurrency" name="bankDetails[currency]">
                <option value="" <%= !(business.bankDetails && business.bankDetails.currency) ? 'selected' : '' %>>Select currency</option>
                <option value="ZAR" <%= (business.bankDetails && business.bankDetails.currency === 'ZAR') ? 'selected' : '' %>>ZAR (South African Rand)</option>
                <option value="USD" <%= (business.bankDetails && business.bankDetails.currency === 'USD') ? 'selected' : '' %>>USD (US Dollar)</option>
                <option value="EUR" <%= (business.bankDetails && business.bankDetails.currency === 'EUR') ? 'selected' : '' %>>EUR (Euro)</option>
                <option value="GBP" <%= (business.bankDetails && business.bankDetails.currency === 'GBP') ? 'selected' : '' %>>GBP (British Pound)</option>
                <option value="Other" <%= (business.bankDetails && business.bankDetails.currency === 'Other') ? 'selected' : '' %>>Other</option>
              </select>
            </div>

            <div class="field full">
              <label for="bankPayoutMethod">Preferred Payout Method</label>
              <select id="bankPayoutMethod" name="bankDetails[payoutMethod]">
                <option value="bank" <%= (business.bankDetails && business.bankDetails.payoutMethod === 'bank') ? 'selected' : '' %>>Bank Transfer</option>
                <option value="paypal" <%= (business.bankDetails && business.bankDetails.payoutMethod === 'paypal') ? 'selected' : '' %>>PayPal</option>
                <option value="other" <%= (business.bankDetails && business.bankDetails.payoutMethod === 'other') ? 'selected' : '' %>>Other</option>
              </select>
              <p class="help">You can set/replace these later in payout settings too.</p>
            </div>
          </div>
        </section>

        <!-- Security Settings -->
        <section class="section section-black">
          <header class="section-head">
            <div class="section-left">
              <span class="s-ic s-black" aria-hidden="true">üîí</span>
              <div>
                <h3>Security Settings</h3>
                <p>Optional: leave blank if you don‚Äôt want to change password</p>
              </div>
            </div>

            <!-- keep links exactly as your system uses -->
            <a class="mini-link" href="/business/change-password">Use Separate Change Password Page</a>
          </header>

          <div class="grid">
            <div class="field">
              <label for="currentPassword">Current Password</label>
              <div class="pw">
                <input
                  type="password"
                  id="currentPassword"
                  name="currentPassword"
                  placeholder="Your current password"
                  autocomplete="current-password"
                />
                <button type="button" class="pw-btn toggle-password" data-target="currentPassword" aria-label="Toggle password visibility">üëÅ</button>
              </div>
            </div>

            <div class="field">
              <label for="newPassword">New Password</label>
              <div class="pw">
                <input
                  type="password"
                  id="newPassword"
                  name="newPassword"
                  placeholder="Enter new password"
                  autocomplete="new-password"
                />
                <button type="button" class="pw-btn toggle-password" data-target="newPassword" aria-label="Toggle password visibility">üëÅ</button>
              </div>

              <div class="pw-strength" id="passwordStrength" hidden>
                <div class="bar"><div class="fill" id="strengthFill"></div></div>
                <div class="t">Strength: <span id="strengthText">Weak</span></div>
              </div>
            </div>

            <div class="field full">
              <label for="confirmPassword">Confirm New Password</label>
              <div class="pw">
                <input
                  type="password"
                  id="confirmPassword"
                  name="confirmPassword"
                  placeholder="Re-enter new password"
                  autocomplete="new-password"
                />
                <button type="button" class="pw-btn toggle-password" data-target="confirmPassword" aria-label="Toggle password visibility">üëÅ</button>
              </div>
              <p class="help">Must match the new password.</p>
            </div>
          </div>
        </section>

        <!-- Actions -->
        <div class="actions">
          <!-- ‚úÖ CSP-safe: no onclick -->
          <a class="btn btn-ghost" href="/business/profile">Cancel</a>

          <button type="submit" class="btn btn-primary">
            Save Changes
          </button>
        </div>
      </form>

      <!-- Danger Zone -->
      <div class="danger card card-red">
        <div class="danger-head">
          <div class="danger-left">
            <span class="danger-ic" aria-hidden="true">‚ö†Ô∏è</span>
            <div>
              <h3>Danger Zone</h3>
              <p>Deleting your account is permanent</p>
            </div>
          </div>
        </div>

        <p class="note">
          To confirm, type <strong>DELETE</strong> and enter your password.
        </p>

        <form action="/business/profile/delete" method="POST" class="danger-form" autocomplete="off">
          <div class="grid">
            <div class="field">
              <label for="confirmText">Type DELETE</label>
              <input
                id="confirmText"
                name="confirmText"
                type="text"
                placeholder="DELETE"
                autocapitalize="characters"
                autocomplete="off"
              />
            </div>

            <div class="field">
              <label for="deletePassword">Password</label>
              <div class="pw">
                <input
                  id="deletePassword"
                  name="password"
                  type="password"
                  placeholder="Your password"
                  autocomplete="current-password"
                />
                <button type="button" class="pw-btn toggle-password" data-target="deletePassword" aria-label="Toggle password visibility">üëÅ</button>
              </div>
            </div>
          </div>

          <div class="actions">
            <button type="submit" class="btn btn-danger">
              Delete Business Account
            </button>
          </div>
        </form>
      </div>

    </main>
  </div>
</div>

<style nonce="<%= NONCE %>">
  /* Scoped only to this page */
  .bp-edit-page{
    --purple:#7C3AED;
    --purple2:#6D28D9;
    --blue:#2563EB;
    --green:#22C55E;
    --black:#0F172A;

    --bg:#F8FAFC;
    --card:#FFFFFF;
    --border:#E2E8F0;
    --muted:#64748B;
    --text:#0F172A;

    --shadow:0 10px 22px rgba(15,23,42,.08);
    --r:16px;
    --r2:12px;

    background: var(--bg);
    padding: 14px 12px 22px;
    max-width: 1200px;
    margin: 0 auto;
  }

  /* Header */
  .bp-page-header{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:12px;
    padding: 14px;
    border-radius: var(--r);
    border: 1px solid rgba(124,58,237,.22);
    background: linear-gradient(135deg, rgba(124,58,237,.14), rgba(37,99,235,.10));
    box-shadow: var(--shadow);
  }
  .bp-header-content{ display:flex; gap:12px; align-items:flex-start; min-width:0; }
  .bp-header-icon{
    width:56px; height:56px;
    border-radius: 14px;
    display:flex; align-items:center; justify-content:center;
    background: linear-gradient(135deg, var(--purple), var(--blue));
    color:#fff;
    flex-shrink:0;
  }
  .bp-header-text{ min-width:0; }
  .bp-title{ margin:0; font-size: 18px; font-weight: 900; color: var(--text); }
  .bp-subtitle{ margin:6px 0 0; color: var(--muted); font-size: 13px; line-height: 1.35; }

  .bp-brand-chips{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
  .chip{
    font-size: 11px; font-weight: 900;
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid transparent;
    background:#fff;
  }
  .c-purple{ color: var(--purple); border-color: rgba(124,58,237,.25); background: rgba(124,58,237,.10); }
  .c-blue{ color: var(--blue); border-color: rgba(37,99,235,.25); background: rgba(37,99,235,.10); }
  .c-green{ color: #15803D; border-color: rgba(34,197,94,.25); background: rgba(34,197,94,.10); }
  .c-black{ color: var(--black); border-color: rgba(15,23,42,.18); background: rgba(15,23,42,.06); }

  .bp-back{
    display:inline-flex;
    gap:8px;
    align-items:center;
    padding: 10px 12px;
    border-radius: 12px;
    text-decoration:none;
    font-weight: 900;
    color: var(--purple);
    border: 1px solid rgba(124,58,237,.25);
    background: rgba(255,255,255,.8);
    white-space: nowrap;
  }
  .bp-back:hover{ background: rgba(124,58,237,.08); }

  /* Flash */
  .bp-flash{ margin: 12px 0 0; }
  .flash{
    display:flex; gap:10px;
    padding: 12px;
    border-radius: 14px;
    border: 1px solid transparent;
    margin-top: 10px;
    box-shadow: 0 6px 14px rgba(15,23,42,.06);
  }
  .flash-success{ background: rgba(34,197,94,.12); border-color: rgba(34,197,94,.22); color:#166534; }
  .flash-error{ background: rgba(239,68,68,.12); border-color: rgba(239,68,68,.22); color:#991B1B; }
  .flash-content strong{ display:block; font-weight: 1000; font-size: 13px; }
  .flash-content p{ margin:4px 0 0; font-size: 12.5px; line-height: 1.35; }

  /* Main grid */
  .bp-grid{
    display:grid;
    grid-template-columns: 360px 1fr;
    gap: 12px;
    margin-top: 12px;
    align-items:start;
  }
  @media (max-width: 1024px){
    .bp-grid{ grid-template-columns: 1fr; }
  }

  /* Cards */
  .card{
    background: rgba(255,255,255,.95);
    border: 1px solid var(--border);
    border-radius: var(--r);
    box-shadow: var(--shadow);
    overflow:hidden;
  }
  .card-head{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:10px;
    padding: 12px;
    border-bottom: 1px solid rgba(226,232,240,.9);
  }
  .card-head-left{ display:flex; gap:10px; min-width:0; }
  .card-ic{
    width:44px; height:44px;
    border-radius: 14px;
    display:flex; align-items:center; justify-content:center;
    font-size: 18px;
    border: 1px solid transparent;
    flex-shrink:0;
  }
  .ic-purple{ background: rgba(124,58,237,.12); border-color: rgba(124,58,237,.22); }
  .ic-blue{ background: rgba(37,99,235,.12); border-color: rgba(37,99,235,.22); }

  .card h2{ margin:0; font-size: 14px; font-weight: 1000; color: var(--text); }
  .muted{ margin:4px 0 0; color: var(--muted); font-size: 12px; line-height: 1.35; }

  .tag{
    font-size: 11px;
    font-weight: 1000;
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid transparent;
    white-space: nowrap;
  }
  .tag-purple{ color: var(--purple); background: rgba(124,58,237,.10); border-color: rgba(124,58,237,.22); }
  .tag-blue{ color: var(--blue); background: rgba(37,99,235,.10); border-color: rgba(37,99,235,.22); }
  .tag-green{ color:#15803D; background: rgba(34,197,94,.10); border-color: rgba(34,197,94,.22); }

  .card-body{ padding: 12px; }

  .row{
    display:flex;
    justify-content:space-between;
    gap:10px;
    padding: 10px 0;
    border-bottom: 1px dashed rgba(203,213,225,.7);
  }
  .row:last-child{ border-bottom:none; }
  .row-top{ align-items:flex-start; }

  .k{ font-size: 12px; font-weight: 900; color: var(--muted); min-width: 110px; }
  .v{ font-size: 12.5px; font-weight: 1000; color: var(--text); text-align:right; max-width: 65%; }
  .v-stack{ display:flex; flex-direction:column; gap:6px; align-items:flex-end; }
  .mini-note{ font-size: 11.5px; color: var(--muted); line-height: 1.3; max-width: 220px; text-align:right; }
  .mini-note strong{ color:#991B1B; }

  .status-dot{ width: 12px; height: 12px; border-radius: 999px; margin-top: 6px; }
  .status-dot.ok{ background: var(--green); box-shadow: 0 0 0 4px rgba(34,197,94,.18); }
  .status-dot.warn{ background: #F59E0B; box-shadow: 0 0 0 4px rgba(245,158,11,.18); }

  .card-foot{
    padding: 12px;
    border-top: 1px solid rgba(226,232,240,.9);
    background: rgba(248,250,252,.85);
  }

  /* Sidebar actions */
  .action-list{ display:flex; flex-direction:column; gap:10px; }
  .action-item{
    display:flex; align-items:center; gap:10px;
    padding: 12px;
    border-radius: 14px;
    border: 1px solid rgba(124,58,237,.18);
    text-decoration:none;
    background: rgba(124,58,237,.06);
    color: var(--text);
  }
  .action-item:hover{ border-color: rgba(124,58,237,.35); background: rgba(124,58,237,.10); }
  .a-ic{ width: 38px; height: 38px; border-radius: 14px; display:flex; align-items:center; justify-content:center; background:#fff; border: 1px solid rgba(124,58,237,.18); }
  .a-txt{ font-weight: 1000; font-size: 13px; }
  .a-go{ margin-left:auto; font-size: 20px; font-weight: 1000; color: rgba(124,58,237,.55); }

  /* Pills */
  .pill{
    display:inline-flex;
    align-items:center;
    padding: 6px 10px;
    border-radius: 999px;
    font-size: 11.5px;
    font-weight: 1000;
    border: 1px solid transparent;
    white-space: nowrap;
  }
  .pill-green{ background: rgba(34,197,94,.12); border-color: rgba(34,197,94,.22); color:#15803D; }
  .pill-amber{ background: rgba(245,158,11,.14); border-color: rgba(245,158,11,.26); color:#B45309; }
  .pill-red{ background: rgba(239,68,68,.12); border-color: rgba(239,68,68,.24); color:#991B1B; }

  /* Form */
  .bp-main .form{ padding-bottom: 6px; }
  .section{ margin: 0; padding: 12px; border-bottom: 1px solid rgba(226,232,240,.9); }
  .section:last-of-type{ border-bottom: none; }

  .section-head{
    display:flex;
    gap:10px;
    align-items:flex-start;
    justify-content:space-between;
    margin-bottom: 12px;
  }
  .section-left{ display:flex; gap:10px; min-width:0; }
  .s-ic{
    width: 44px; height: 44px;
    border-radius: 14px;
    display:flex; align-items:center; justify-content:center;
    border: 1px solid transparent;
    background:#fff;
    flex-shrink:0;
  }
  .s-purple{ background: rgba(124,58,237,.12); border-color: rgba(124,58,237,.22); }
  .s-blue{ background: rgba(37,99,235,.12); border-color: rgba(37,99,235,.22); }
  .s-green{ background: rgba(34,197,94,.12); border-color: rgba(34,197,94,.22); }
  .s-black{ background: rgba(15,23,42,.08); border-color: rgba(15,23,42,.18); }

  .section h3{ margin:0; font-size: 14px; font-weight: 1100; color: var(--text); }
  .section-head p{ margin:4px 0 0; font-size: 12px; color: var(--muted); line-height: 1.35; }

  /* Visible section accents */
  .section-purple{ border-left: 5px solid rgba(124,58,237,.85); }
  .section-blue{ border-left: 5px solid rgba(37,99,235,.85); }
  .section-green{ border-left: 5px solid rgba(34,197,94,.85); }
  .section-black{ border-left: 5px solid rgba(15,23,42,.85); }

  .mini-link{
    font-size: 12px;
    font-weight: 1000;
    text-decoration:none;
    color: var(--purple);
    white-space: nowrap;
    padding: 8px 10px;
    border-radius: 12px;
    border: 1px solid rgba(124,58,237,.22);
    background: rgba(124,58,237,.06);
  }
  .mini-link:hover{ background: rgba(124,58,237,.10); }

  .grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }
  @media (max-width: 760px){
    .grid{ grid-template-columns: 1fr; }
    .bp-page-header{ flex-direction:column; }
    .bp-back{ width: 100%; justify-content:center; }
  }

  .field{ display:flex; flex-direction:column; gap:7px; }
  .full{ grid-column: 1 / -1; }
  label{ font-size: 12.5px; font-weight: 1000; color: var(--text); }
  .req{ color:#EF4444; }

  input, select{
    width:100%;
    padding: 12px 12px;
    border-radius: 14px;
    border: 2px solid rgba(226,232,240,.95);
    background: #fff;
    color: var(--text);
    font-weight: 800;
    font-size: 13px;
    outline: none;
  }
  input:focus, select:focus{
    border-color: rgba(124,58,237,.55);
    box-shadow: 0 0 0 4px rgba(124,58,237,.14);
  }

  .help{
    margin:0;
    font-size: 11.5px;
    color: var(--muted);
    line-height: 1.35;
  }

  .input-ic{ position:relative; }
  .ii{
    position:absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    opacity:.75;
    pointer-events:none;
  }
  .input-ic input{ padding-left: 40px; }

  .hintline{
    display:flex;
    gap:8px;
    align-items:center;
    flex-wrap:wrap;
  }
  .hint{
    font-size: 11.5px;
    color: var(--muted);
    line-height: 1.35;
  }

  /* Toggle (same behavior as your details page) */
  .toggle { display:flex; align-items:center; gap:10px; user-select:none; }
  .toggle input { position:absolute; opacity:0; pointer-events:none; }
  .toggle-ui {
    width:52px; height:30px;
    border-radius:999px;
    background: rgba(124,58,237,.25);
    border: 2px solid rgba(124,58,237,.35);
    position:relative;
    transition: all .2s ease;
    flex-shrink:0;
  }
  .toggle-ui::after{
    content:'';
    position:absolute;
    top:50%;
    left:3px;
    width:24px;
    height:24px;
    border-radius:999px;
    background:#fff;
    transform: translateY(-50%);
    transition: all .2s ease;
    box-shadow: 0 6px 14px rgba(15,23,42,.18);
  }
  .toggle input:checked + .toggle-ui { background: rgba(34,197,94,.25); border-color: rgba(34,197,94,.45); }
  .toggle input:checked + .toggle-ui::after { left:23px; }
  .toggle-text { font-size:.875rem; font-weight:1000; color: var(--text); }

  /* Password */
  .pw{ position:relative; }
  .pw input{ padding-right: 44px; }
  .pw-btn{
    position:absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    border: 1px solid rgba(124,58,237,.22);
    background: rgba(124,58,237,.06);
    color: var(--purple);
    border-radius: 12px;
    width: 34px; height: 34px;
    cursor:pointer;
    font-weight: 1000;
  }
  .pw-btn:hover{ background: rgba(124,58,237,.10); }

  .pw-strength{ margin-top: 8px; }
  .bar{ height: 6px; border-radius: 999px; background: rgba(226,232,240,.95); overflow:hidden; }
  .fill{ height: 100%; width: 30%; background: #EF4444; transition: width .2s ease; }
  .pw-strength .t{ margin-top: 6px; font-size: 11.5px; color: var(--muted); }
  .pw-strength .t span{ font-weight: 1000; }

  /* Buttons */
  .actions{
    display:flex;
    gap:10px;
    justify-content:flex-end;
    padding: 12px;
    border-top: 1px solid rgba(226,232,240,.9);
    background: rgba(248,250,252,.85);
  }
  @media (max-width: 520px){
    .actions{ flex-direction:column; }
  }

  .btn{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    padding: 12px 14px;
    border-radius: 14px;
    border: 1px solid transparent;
    font-weight: 1000;
    font-size: 13px;
    cursor:pointer;
    text-decoration:none;
    min-height: 44px;
  }
  .btn-full{ width: 100%; }

  .btn-primary{
    background: var(--purple);
    border-color: rgba(124,58,237,.55);
    color:#fff;
  }
  .btn-primary:hover{ background: var(--purple2); }

  .btn-ghost{
    background: rgba(255,255,255,.9);
    border-color: rgba(124,58,237,.22);
    color: var(--purple);
  }
  .btn-ghost:hover{ background: rgba(124,58,237,.08); }

  .btn-danger{
    background: #EF4444;
    border-color: rgba(239,68,68,.55);
    color:#fff;
  }
  .btn-danger:hover{ background: #DC2626; }

  /* Danger */
  .card-red{
    border-color: rgba(239,68,68,.22);
    background: rgba(255,255,255,.95);
  }
  .danger{ margin-top: 12px; }
  .danger-head{ padding: 12px; border-bottom: 1px solid rgba(239,68,68,.18); background: rgba(239,68,68,.06); }
  .danger-left{ display:flex; gap:10px; align-items:center; }
  .danger-ic{
    width: 44px; height: 44px;
    border-radius: 14px;
    display:flex; align-items:center; justify-content:center;
    background: rgba(239,68,68,.12);
    border: 1px solid rgba(239,68,68,.22);
    font-size: 18px;
  }
  .danger h3{ margin:0; font-size: 14px; font-weight: 1100; color:#991B1B; }
  .danger-head p{ margin:4px 0 0; font-size: 12px; color:#7f1d1d; }
  .danger .note{ padding: 12px; margin:0; color:#7f1d1d; font-size: 12px; line-height: 1.35; }
  .danger-form{ padding: 0 12px 12px; }

  /* Small phones */
  @media (max-width: 360px){
    .bp-edit-page{ padding-left: 10px; padding-right: 10px; }
    .bp-title{ font-size: 16px; }
  }
</style>

<script nonce="<%= NONCE %>">
  document.addEventListener("DOMContentLoaded", () => {
    // ‚úÖ Make PayPal email required only when payouts enabled
    (function () {
      const paypal = document.getElementById('paypalEmail');
      const checkbox = document.querySelector('input[type="checkbox"][name="payoutsEnabled"]');
      const text = document.querySelector('.toggle-text');

      if (!checkbox) return;

      const render = () => {
        const on = checkbox.checked;
        if (text) text.textContent = on ? (text.dataset.on || 'Enabled') : (text.dataset.off || 'Disabled');
        if (paypal) {
          if (on) paypal.setAttribute('required', 'required');
          else paypal.removeAttribute('required');
        }
      };

      checkbox.addEventListener('change', render);
      render();
    })();

    // Strength (new password only)
    const newPasswordInput = document.getElementById('newPassword');
    const passwordStrength = document.getElementById('passwordStrength');
    const strengthFill = document.getElementById('strengthFill');
    const strengthText = document.getElementById('strengthText');

    if (newPasswordInput && passwordStrength) {
      newPasswordInput.addEventListener('input', function() {
        const password = String(this.value || '');

        if (!password.length) {
          passwordStrength.hidden = true;
          return;
        }

        passwordStrength.hidden = false;

        let strength = 0;
        if (password.length >= 8) strength++;
        if (password.length >= 12) strength++;
        if (/[a-z]/.test(password)) strength++;
        if (/[A-Z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^A-Za-z0-9]/.test(password)) strength++;

        const percentage = Math.min((strength / 6) * 100, 100);
        if (strengthFill) strengthFill.style.width = percentage + '%';

        let label = 'Weak';
        let color = '#EF4444';
        if (strength >= 5) { label = 'Strong'; color = '#22C55E'; }
        else if (strength >= 3) { label = 'Good'; color = '#F59E0B'; }
        else if (strength >= 2) { label = 'Fair'; color = '#F59E0B'; }

        if (strengthText) strengthText.textContent = label;
        if (strengthFill) strengthFill.style.backgroundColor = color;
      });
    }

    // Toggle password visibility
    document.querySelectorAll('.toggle-password').forEach((btn) => {
      btn.addEventListener('click', () => {
        const targetId = btn.getAttribute('data-target');
        const input = targetId ? document.getElementById(targetId) : null;
        if (!input) return;
        input.type = (input.type === 'password') ? 'text' : 'password';
      });
    });
  });
</script>


