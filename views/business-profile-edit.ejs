<div class="profile-edit-page">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-icon">
        <svg viewBox="0 0 24 24" width="28" height="28">
          <path fill="currentColor" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
        </svg>
      </div>
      <div>
        <h1 class="page-title">Edit Business Profile</h1>
        <p class="page-subtitle">
          Update your business information and settings. Your login email is protected for security.
        </p>
      </div>
    </div>
    <a href="/business/profile" class="back-button">
      <svg viewBox="0 0 24 24" width="20" height="20">
        <path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
      </svg>
      Back to Profile
    </a>
  </div>

  <!-- Flash Messages -->
  <div class="flash-container">
    <% (success || []).forEach(msg => { %>
      <div class="flash flash-success">
        <svg class="flash-icon" viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
        </svg>
        <div class="flash-content">
          <strong>Success!</strong>
          <p><%= msg %></p>
        </div>
      </div>
    <% }) %>
    <% (error || []).forEach(msg => { %>
      <div class="flash flash-error">
        <svg class="flash-icon" viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
        </svg>
        <div class="flash-content">
          <strong>Error!</strong>
          <p><%= msg %></p>
        </div>
      </div>
    <% }) %>
  </div>

  <!-- Profile Edit Container -->
  <div class="profile-edit-container">
    <div class="profile-sidebar">
      <!-- Business Status Card -->
      <div class="status-card">
        <div class="status-header">
          <h3>Business Status</h3>
          <span class="status-indicator <%= business.isVerified ? 'active' : 'inactive' %>"></span>
        </div>
        
        <div class="status-content">
          <div class="status-item">
            <div class="status-label">Account Type</div>
            <div class="status-value"><%= business.role.charAt(0).toUpperCase() + business.role.slice(1) %></div>
          </div>
          
          <div class="status-item">
            <div class="status-label">Verification</div>
            <div class="status-value">
              <% if (business.isVerified) { %>
                <span class="verified-badge">
                  <svg viewBox="0 0 24 24" width="16" height="16">
                    <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                  </svg>
                  Verified
                </span>
              <% } else { %>
                <span class="unverified-badge">
                  <svg viewBox="0 0 24 24" width="16" height="16">
                    <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                  </svg>
                  Unverified
                </span>
              <% } %>
            </div>
          </div>
          
          <div class="status-item">
            <div class="status-label">Member Since</div>
            <div class="status-value">
              <%= business.createdAt ? new Date(business.createdAt).toLocaleDateString('en-US', { month: 'short', year: 'numeric' }) : 'Recently' %>
            </div>
          </div>
        </div>
        
        <% if (!business.isVerified) { %>
          <div class="verification-cta">
            <p>Verify your account to unlock full features</p>
            <a href="/business/verify" class="btn-verify">
              <svg viewBox="0 0 24 24" width="16" height="16">
                <path fill="currentColor" d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
              </svg>
              Verify Now
            </a>
          </div>
        <% } %>
      </div>

      <!-- Quick Actions -->
      <div class="actions-card">
        <h3>Quick Actions</h3>
        <div class="action-list">
          <a href="/business/profile" class="action-item">
            <svg viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
            View Profile
          </a>
          <a href="/business/verify" class="action-item">
            <svg viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
            </svg>
            Account Verification
          </a>
          <a href="/business/settings" class="action-item">
            <svg viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/>
            </svg>
            Settings
          </a>
        </div>
      </div>
    </div>

    <!-- Main Form -->
    <div class="profile-form-container">
      <form
        action="/business/profile/edit"
        method="POST"
        class="business-edit-form"
        id="profileEditForm"
      >
        <!-- Email Field (Read-only) -->
        <div class="form-section">
          <div class="section-header">
            <svg class="section-icon" viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V8l8 5 8-5v10zm-8-7L4 6h16l-8 5z"/>
            </svg>
            <h3>Account Information</h3>
          </div>
          
          <div class="readonly-field">
            <label class="form-label">Email Address</label>
            <div class="readonly-input">
              <div class="email-display">
                <svg class="email-icon" viewBox="0 0 24 24" width="20" height="20">
                  <path fill="currentColor" d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                </svg>
                <span class="email-value"><%= business.email %></span>
                <% if (business.isVerified) { %>
                  <span class="verified-tag">
                    <svg viewBox="0 0 24 24" width="16" height="16">
                      <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    Verified
                  </span>
                <% } else { %>
                  <span class="unverified-tag">
                    <svg viewBox="0 0 24 24" width="16" height="16">
                      <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                    </svg>
                    Unverified
                  </span>
                <% } %>
              </div>
              <p class="field-hint">
                For security reasons, email changes require verification. 
                Contact support or visit the verification page to update.
              </p>
            </div>
          </div>
        </div>

        <!-- Business Details -->
        <div class="form-section">
          <div class="section-header">
            <svg class="section-icon" viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
            </svg>
            <h3>Business Details</h3>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="name" class="form-label">
                Business Name
                <span class="required">*</span>
              </label>
              <input
                type="text"
                id="name"
                name="name"
                value="<%= business.name %>"
                required
                class="form-input"
                placeholder="Enter business name"
              />
            </div>

            <div class="form-group">
              <label for="phone" class="form-label">
                Phone Number
                <span class="required">*</span>
              </label>
              <div class="input-with-icon">
                <svg class="input-icon" viewBox="0 0 24 24" width="18" height="18">
                  <path fill="currentColor" d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
                </svg>
                <input
                  type="text"
                  id="phone"
                  name="phone"
                  value="<%= business.phone %>"
                  required
                  class="form-input"
                  placeholder="+1 (555) 123-4567"
                />
              </div>
            </div>

            <div class="form-group">
              <label for="country" class="form-label">
                Country
                <span class="required">*</span>
              </label>
              <input
                type="text"
                id="country"
                name="country"
                value="<%= business.country %>"
                required
                class="form-input"
                placeholder="Enter country"
              />
            </div>

            <div class="form-group">
              <label for="city" class="form-label">
                City
                <span class="required">*</span>
              </label>
              <input
                type="text"
                id="city"
                name="city"
                value="<%= business.city %>"
                required
                class="form-input"
                placeholder="Enter city"
              />
            </div>

            <div class="form-group full-width">
              <label for="address" class="form-label">
                Business Address
                <span class="required">*</span>
              </label>
              <div class="input-with-icon">
                <svg class="input-icon" viewBox="0 0 24 24" width="18" height="18">
                  <path fill="currentColor" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                </svg>
                <input
                  type="text"
                  id="address"
                  name="address"
                  value="<%= business.address %>"
                  required
                  class="form-input"
                  placeholder="Enter full business address"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- Password Update -->
        <div class="form-section">
          <div class="section-header">
            <svg class="section-icon" viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
            </svg>
            <h3>Security Settings</h3>
          </div>

          <div class="form-group">
            <label for="password" class="form-label">
              New Password
            </label>
            <div class="password-container">
              <input
                type="password"
                id="password"
                name="password"
                placeholder="Enter new password (optional)"
                autocomplete="new-password"
                class="form-input"
              />
              <button
                type="button"
                class="toggle-password"
                data-target="password"
                aria-label="Toggle password visibility"
              >
                <svg class="eye-icon" viewBox="0 0 24 24" width="20" height="20">
                  <path fill="currentColor" d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                </svg>
              </button>
            </div>
            <div class="password-strength" id="passwordStrength" style="display: none;">
              <div class="strength-bar">
                <div class="strength-fill" id="strengthFill"></div>
              </div>
              <div class="strength-label">
                Strength: <span id="strengthText">Weak</span>
              </div>
            </div>
            <p class="field-hint">
              Leave blank to keep your current password. Minimum 8 characters recommended.
            </p>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="window.location.href='/business/profile'">
            <svg viewBox="0 0 24 24" width="18" height="18">
              <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
            Cancel
          </button>
          <button type="submit" class="btn btn-primary">
            <svg viewBox="0 0 24 24" width="18" height="18">
              <path fill="currentColor" d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
            </svg>
            Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<style nonce="<%= nonce %>">
  /* Page Container */
  .profile-edit-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 1rem;
  }

  /* Page Header */
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #22C55E; /* Green accent */
  }

  .header-content {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .header-icon {
    background: linear-gradient(135deg, #2563EB 0%, #7C3AED 100%);
    width: 56px;
    height: 56px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .header-icon svg {
    color: white;
  }

  .page-title {
    margin: 0;
    font-size: 1.8rem;
    font-weight: 700;
    color: #0F172A;
  }

  .dark-theme .page-title {
    color: #F1F5F9;
  }

  .page-subtitle {
    margin: 0.25rem 0 0;
    color: #64748B;
    font-size: 0.95rem;
  }

  .back-button {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: rgba(37, 99, 235, 0.1);
    color: #2563EB;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
  }

  .back-button:hover {
    background: rgba(37, 99, 235, 0.2);
    transform: translateX(-2px);
  }

  /* Flash Messages */
  .flash-container {
    margin-bottom: 2rem;
  }

  .flash {
    display: flex;
    gap: 1rem;
    padding: 1.25rem;
    border-radius: 12px;
    margin-bottom: 1rem;
    animation: slideIn 0.3s ease;
  }

  .flash-success {
    background: linear-gradient(135deg, #DCFCE7 0%, #BBF7D0 100%);
    border-left: 4px solid #22C55E;
    color: #166534;
  }

  .flash-error {
    background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%);
    border-left: 4px solid #EF4444;
    color: #991B1B;
  }

  .flash-icon {
    flex-shrink: 0;
  }

  .flash-content strong {
    display: block;
    margin-bottom: 0.25rem;
    font-size: 0.875rem;
  }

  /* Main Layout */
  .profile-edit-container {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 2rem;
  }

  @media (max-width: 1024px) {
    .profile-edit-container {
      grid-template-columns: 1fr;
    }
  }

  /* Sidebar */
  .profile-sidebar {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  /* Status Card */
  .status-card {
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    border: 1px solid #E2E8F0;
  }

  .dark-theme .status-card {
    background: rgba(15, 23, 42, 0.8);
    border-color: #334155;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  .status-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }

  .status-header h3 {
    margin: 0;
    font-size: 1.2rem;
    color: #0F172A;
  }

  .dark-theme .status-header h3 {
    color: #F1F5F9;
  }

  .status-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
  }

  .status-indicator.active {
    background: #22C55E;
    box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
  }

  .status-indicator.inactive {
    background: #EF4444;
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
  }

  .status-content {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .status-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .status-label {
    font-size: 0.875rem;
    color: #64748B;
  }

  .status-value {
    font-weight: 600;
    color: #0F172A;
  }

  .dark-theme .status-value {
    color: #F1F5F9;
  }

  .verified-badge,
  .unverified-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .verified-badge {
    background: #DCFCE7;
    color: #166534;
  }

  .unverified-badge {
    background: #FEF3C7;
    color: #92400E;
  }

  .verification-cta {
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid #E2E8F0;
    text-align: center;
  }

  .dark-theme .verification-cta {
    border-top-color: #334155;
  }

  .verification-cta p {
    margin: 0 0 1rem;
    font-size: 0.875rem;
    color: #64748B;
  }

  .btn-verify {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: #2563EB;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .btn-verify:hover {
    background: #1D4ED8;
    transform: translateY(-2px);
  }

  /* Actions Card */
  .actions-card {
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    border: 1px solid #E2E8F0;
  }

  .dark-theme .actions-card {
    background: rgba(15, 23, 42, 0.8);
    border-color: #334155;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  .actions-card h3 {
    margin: 0 0 1rem;
    font-size: 1.2rem;
    color: #0F172A;
  }

  .dark-theme .actions-card h3 {
    color: #F1F5F9;
  }

  .action-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .action-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    border-radius: 8px;
    text-decoration: none;
    color: #0F172A;
    font-weight: 500;
    transition: all 0.3s ease;
  }

  .dark-theme .action-item {
    color: #F1F5F9;
  }

  .action-item:hover {
    background: rgba(37, 99, 235, 0.1);
    transform: translateX(4px);
  }

  .action-item svg {
    color: #64748B;
  }

  /* Form Container */
  .profile-form-container {
    background: white;
    border-radius: 16px;
    padding: 2rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }

  .dark-theme .profile-form-container {
    background: rgba(15, 23, 42, 0.8);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  }

  /* Form Sections */
  .form-section {
    margin-bottom: 2.5rem;
  }

  .section-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
  }

  .section-icon {
    color: #2563EB;
  }

  .section-header h3 {
    margin: 0;
    font-size: 1.2rem;
    color: #0F172A;
  }

  .dark-theme .section-header h3 {
    color: #F1F5F9;
  }

  /* Readonly Field */
  .readonly-field {
    margin-bottom: 1.5rem;
  }

  .form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #0F172A;
    font-size: 0.95rem;
  }

  .dark-theme .form-label {
    color: #E2E8F0;
  }

  .required {
    color: #EF4444;
  }

  .readonly-input {
    background: #F8FAFC;
    border: 2px solid #E2E8F0;
    border-radius: 8px;
    padding: 1rem;
  }

  .dark-theme .readonly-input {
    background: rgba(15, 23, 42, 0.5);
    border-color: #334155;
  }

  .email-display {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
  }

  .email-icon {
    color: #64748B;
    flex-shrink: 0;
  }

  .email-value {
    font-weight: 600;
    color: #0F172A;
    flex: 1;
  }

  .dark-theme .email-value {
    color: #F1F5F9;
  }

  .verified-tag,
  .unverified-tag {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .verified-tag {
    background: #DCFCE7;
    color: #166534;
  }

  .unverified-tag {
    background: #FEF3C7;
    color: #92400E;
  }

  .field-hint {
    margin: 0;
    font-size: 0.875rem;
    color: #64748B;
    line-height: 1.4;
  }

  /* Form Grid */
  .form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
  }

  @media (max-width: 768px) {
    .form-grid {
      grid-template-columns: 1fr;
    }
  }

  .full-width {
    grid-column: 1 / -1;
  }

  /* Form Elements */
  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-input {
    width: 100%;
    padding: 0.875rem 1rem;
    font-size: 1rem;
    border: 2px solid #E2E8F0;
    border-radius: 8px;
    background: white;
    color: #0F172A;
    transition: all 0.3s ease;
  }

  .dark-theme .form-input {
    background: rgba(15, 23, 42, 0.5);
    border-color: #334155;
    color: #F1F5F9;
  }

  .form-input:focus {
    outline: none;
    border-color: #2563EB;
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
  }

  .input-with-icon {
    position: relative;
  }

  .input-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: #64748B;
  }

  .input-with-icon .form-input {
    padding-left: 3rem;
  }

  /* Password Container */
  .password-container {
    position: relative;
  }

  .toggle-password {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    color: #64748B;
  }

  .eye-icon {
    display: block;
  }

  /* Password Strength */
  .password-strength {
    margin-top: 0.75rem;
  }

  .strength-bar {
    height: 4px;
    background: #E2E8F0;
    border-radius: 2px;
    margin-bottom: 0.5rem;
    overflow: hidden;
  }

  .strength-fill {
    height: 100%;
    width: 30%;
    background: #EF4444;
    border-radius: 2px;
    transition: all 0.3s ease;
  }

  .strength-label {
    font-size: 0.875rem;
    color: #64748B;
  }

  .strength-label span {
    font-weight: 600;
  }

  /* Form Actions */
  .form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    padding-top: 2rem;
    border-top: 1px solid #E2E8F0;
  }

  .dark-theme .form-actions {
    border-top-color: #334155;
  }

  .btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.875rem 2rem;
    font-size: 1rem;
    font-weight: 600;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
  }

  .btn-primary {
    background: linear-gradient(135deg, #22C55E 0%, #16A34A 100%);
    color: white;
    box-shadow: 0 2px 10px rgba(34, 197, 94, 0.2);
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
  }

  .btn-secondary {
    background: rgba(37, 99, 235, 0.1);
    color: #2563EB;
    border: 1px solid rgba(37, 99, 235, 0.2);
  }

  .btn-secondary:hover {
    background: rgba(37, 99, 235, 0.2);
  }

  /* Animations */
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script nonce="<%= nonce %>">
  document.addEventListener("DOMContentLoaded", () => {
    console.log("âœ… Business profile edit loaded with CSP nonce");

    // Password strength indicator
    const passwordInput = document.getElementById('password');
    const passwordStrength = document.getElementById('passwordStrength');
    const strengthFill = document.getElementById('strengthFill');
    const strengthText = document.getElementById('strengthText');

    if (passwordInput && passwordStrength) {
      passwordInput.addEventListener('input', function() {
        const password = this.value;
        
        if (password.length === 0) {
          passwordStrength.style.display = 'none';
          return;
        }
        
        passwordStrength.style.display = 'block';
        
        let strength = 0;
        
        // Length check
        if (password.length >= 8) strength++;
        if (password.length >= 12) strength++;
        
        // Character type checks
        if (/[a-z]/.test(password)) strength++;
        if (/[A-Z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^A-Za-z0-9]/.test(password)) strength++;
        
        // Calculate percentage (max 6 checks)
        const percentage = Math.min((strength / 6) * 100, 100);
        if (strengthFill) {
          strengthFill.style.width = percentage + '%';
        }
        
        // Update text and color
        let label = 'Weak';
        let color = '#EF4444';
        
        if (strength >= 5) {
          label = 'Strong';
          color = '#22C55E';
        } else if (strength >= 3) {
          label = 'Good';
          color = '#F59E0B';
        } else if (strength >= 2) {
          label = 'Fair';
          color = '#F59E0B';
        }
        
        if (strengthText) {
          strengthText.textContent = label;
        }
        if (strengthFill) {
          strengthFill.style.backgroundColor = color;
        }
      });
    }

    // Toggle password visibility
    const togglePassword = document.querySelector('.toggle-password');
    if (togglePassword) {
      togglePassword.addEventListener('click', () => {
        const isPassword = passwordInput.type === 'password';
        passwordInput.type = isPassword ? 'text' : 'password';
        
        // Update eye icon
        const eyeIcon = togglePassword.querySelector('.eye-icon');
        if (eyeIcon) {
          eyeIcon.innerHTML = isPassword ? 
            '<path fill="currentColor" d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>' :
            '<path fill="currentColor" d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>';
        }
      });
    }

    // Form validation
    const form = document.getElementById('profileEditForm');
    if (form) {
      form.addEventListener('submit', function(e) {
        const requiredFields = this.querySelectorAll('[required]');
        let isValid = true;
        
        requiredFields.forEach(field => {
          if (!field.value.trim()) {
            isValid = false;
            field.style.borderColor = '#EF4444';
            field.style.animation = 'shake 0.5s ease';
            
            // Scroll to first error
            if (isValid === false) {
              field.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
          } else {
            field.style.borderColor = '';
            field.style.animation = '';
          }
        });
        
        if (!isValid) {
          e.preventDefault();
          
          // Show error message
          const errorDiv = document.createElement('div');
          errorDiv.className = 'flash flash-error';
          errorDiv.innerHTML = `
            <svg class="flash-icon" viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
            </svg>
            <div class="flash-content">
              <strong>Please fill in all required fields</strong>
              <p>All fields marked with * are required</p>
            </div>
          `;
          
          const flashContainer = document.querySelector('.flash-container');
          if (flashContainer) {
            flashContainer.insertBefore(errorDiv, flashContainer.firstChild);
            
            // Remove after 5 seconds
            setTimeout(() => {
              errorDiv.remove();
            }, 5000);
          }
        }
      });
    }

    // Add shake animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
        20%, 40%, 60%, 80% { transform: translateX(5px); }
      }
    `;
    document.head.appendChild(style);
  });
</script>