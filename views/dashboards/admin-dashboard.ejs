<!-- views/dashboards/admin-dashboard.ejs -->
<h1 class="page-title">üß≠ Admin Dashboard</h1>

<!-- ‚úÖ Flash Messages -->
<% if (success && success.length > 0) { %>
  <div class="flash flash-success" role="status" aria-live="polite"><%= success %></div>
<% } %>
<% if (error && error.length > 0) { %>
  <div class="flash flash-error" role="alert" aria-live="assertive"><%= error %></div>
<% } %>

<!-- üëã Welcome / top row -->
<div class="top-row">
  <div class="who">
    <h2 class="hello">Hi, <%= (admin && admin.name) || "Admin" %> üëã</h2>
    <div class="pills">
      <!-- Mailer status pill (pass mailerOk from route) -->
      <div class="status-pill <%= mailerOk ? 'ok' : 'bad' %>" title="<%= mailerOk ? 'Mailer configured' : 'Mailer not configured' %>">
        <span class="dot"></span>
        Mail: <strong><%= mailerOk ? 'OK' : 'OFF' %></strong>
      </div>

      <!-- PayPal mode pill (computed in view from env via locals if you expose it, else just show Sandbox by default) -->
      <div class="status-pill neutral" title="Current PayPal mode">
        <span class="dot"></span>
        PayPal: <strong><%= (process.env && (process.env.PAYPAL_MODE || 'sandbox')).toUpperCase() %></strong>
      </div>

      <!-- Theme hint (optional) -->
      <div class="status-pill neutral" title="Active Theme">
        <span class="dot"></span>
        Theme: <strong><%= (themeCss && themeCss.includes('dark')) ? 'DARK' : 'LIGHT' %></strong>
      </div>
    </div>
  </div>

  <form action="/admin/logout" method="get" class="logout-wrap">
    <button type="submit" class="btn tiny danger" aria-label="Log out of admin">üö™ Logout</button>
  </form>
</div>

<!-- üß≠ Quick Actions (cards compress on small phones) -->
<nav class="quick-grid" aria-label="Admin quick actions">
  <a class="qcard" href="/admin/orders">
    <div class="qicon">üßæ</div>
    <div class="qtitle">Manage Orders</div>
    <div class="qmeta">Review & reconcile</div>
  </a>

  <a class="qcard" href="/admin/delivery-options">
    <div class="qicon">‚öôÔ∏è</div>
    <div class="qtitle">Delivery Options</div>
    <div class="qmeta">Edit active methods</div>
  </a>

  <a class="qcard" href="/products/all">
    <div class="qicon">üì¶</div>
    <div class="qtitle">All Products</div>
    <div class="qmeta">Browse & audit</div>
  </a>

  <a class="qcard" href="/sales">
    <div class="qicon">üõí</div>
    <div class="qtitle">Shop Front</div>
    <div class="qmeta">Public sales page</div>
  </a>
</nav>

<!-- üîß Environment Snapshot (compact, no secrets) -->
<section class="cards">
  <div class="card">
    <h3 class="card-title">üîß Environment</h3>
    <ul class="kv">
      <li><span>App URL</span><strong><%= (appUrl || '') %></strong></li>
      <li><span>Frontend</span><strong><%= (frontendUrl || '') %></strong></li>
      <li><span>Node Env</span><strong><%= (process.env && (process.env.NODE_ENV || 'development')) %></strong></li>
    </ul>
  </div>

  <div class="card">
    <h3 class="card-title">üí≥ Payments</h3>
    <ul class="kv">
      <li><span>Mode</span><strong><%= (process.env && (process.env.PAYPAL_MODE || 'sandbox')).toUpperCase() %></strong></li>
      <li><span>Client ID</span><strong><%= (process.env && process.env.PAYPAL_CLIENT_ID) ? 'Set' : 'Missing' %></strong></li>
    </ul>
  </div>

  <div class="card">
    <h3 class="card-title">‚úâÔ∏è Mailer</h3>
    <ul class="kv">
      <li><span>From</span><strong><%= (process.env && (process.env.SMTP_FROM || '‚Äî')) %></strong></li>
      <li><span>Status</span><strong><%= mailerOk ? 'Ready' : 'Not configured' %></strong></li>
    </ul>
  </div>
</section>

<style>
  /* Layout */
  .page-title { text-align:center; margin: .8rem 0; font-size:1.6rem; font-weight:800; }
  .top-row { display:flex; align-items:center; justify-content:space-between; gap:.6rem; padding:.3rem .5rem; max-width:1000px; margin:0 auto .5rem; }
  .hello { font-size:1.1rem; margin:.2rem 0 .35rem; }
  .pills { display:flex; flex-wrap:wrap; gap:.4rem; }

  /* Status pill (mail, mode, theme) */
  .status-pill { display:inline-flex; align-items:center; gap:.4rem; padding:.25rem .5rem; border-radius:999px; font-weight:700; font-size:.82rem; border:1px solid #e5e7eb; background:#fff; }
  .status-pill .dot { width:.55rem; height:.55rem; border-radius:999px; background:#9ca3af; display:inline-block; }
  .status-pill.ok { border-color:#bbf7d0; background:#ecfdf5; color:#065f46; }
  .status-pill.ok .dot { background:#10b981; }
  .status-pill.bad { border-color:#fecaca; background:#fef2f2; color:#991b1b; }
  .status-pill.bad .dot { background:#ef4444; }
  .status-pill.neutral { background:#f9fafb; color:#374151; }
  .dark-theme .status-pill { border-color:#374151; background:#111827; color:#e5e7eb; }
  .dark-theme .status-pill.ok { background:#052e2b; border-color:#14532d; color:#bbf7d0; }
  .dark-theme .status-pill.bad { background:#3b0d0d; border-color:#7f1d1d; color:#fecaca; }

  .logout-wrap { margin-left:auto; }
  .btn.tiny { padding:.45rem .7rem; border-radius:.5rem; border:0; font-weight:700; cursor:pointer; }
  .btn.tiny.danger { background:#ef4444; color:#fff; }
  .btn.tiny.danger:hover { background:#dc2626; }

  /* Quick grid */
  .quick-grid {
    display:grid; gap:.5rem; grid-template-columns:repeat(2, minmax(0,1fr));
    max-width:1000px; margin:.5rem auto;
  }
  .qcard { display:block; text-decoration:none; padding:.75rem .8rem; border:1px solid #e5e7eb; border-radius:.7rem; background:#fff; transition:transform .06s, background .2s, box-shadow .2s; }
  .qcard:hover { background:#f9fafb; transform:translateY(-1px); box-shadow:0 2px 8px rgba(0,0,0,.05); }
  .qicon { font-size:1.35rem; }
  .qtitle { font-weight:800; margin-top:.15rem; color:#111827; }
  .qmeta { color:#6b7280; font-size:.9rem; }
  .dark-theme .qcard { background:#0b1220; border-color:#374151; color:#e5e7eb; }

  /* Cards row */
  .cards {
    display:grid; gap:.5rem; grid-template-columns:1fr; max-width:1000px; margin:.6rem auto 1rem;
  }
  @media (min-width: 640px){ .cards { grid-template-columns: repeat(3, 1fr); } }

  .card { border:1px solid #e5e7eb; border-radius:.7rem; background:#fff; padding:.75rem .8rem; }
  .dark-theme .card { background:#0b1220; border-color:#374151; color:#e5e7eb; }
  .card-title { font-size:1rem; font-weight:800; margin:0 0 .4rem; }
  .kv { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:.3rem; }
  .kv li { display:flex; justify-content:space-between; gap:.75rem; }
  .kv li span { color:#6b7280; }
  .kv li strong { font-weight:800; }

  /* Flashes */
  .flash { max-width:1000px; margin:.5rem auto; padding:.7rem .9rem; border-radius:.6rem; text-align:center; font-weight:600; }
  .flash-success { background:#dcfce7; color:#166534; border:1px solid #bbf7d0; }
  .flash-error { background:#fee2e2; color:#991b1b; border:1px solid #fecaca; }
  .dark-theme .flash-success { background:#064e3b; color:#bbf7d0; border-color:#205b4d; }
  .dark-theme .flash-error { background:#7f1d1d; color:#fecaca; border-color:#7f1d1d; }

  /* Ultra-small phones (U50 Lite & below) */
  @media (max-width: 360px){
    .hello{ font-size:1rem; }
    .status-pill{ font-size:.78rem; padding:.22rem .45rem; }
    .qtitle{ font-size:.95rem; }
    .qmeta{ font-size:.85rem; }
  }
</style>

<script nonce="<%= nonce %>">
document.addEventListener("DOMContentLoaded", () => {
  // Auto-dismiss flashes (tap to dismiss immediately)
  document.querySelectorAll(".flash").forEach(el => {
    const hide = () => { el.style.transition = "opacity .4s, transform .4s"; el.style.opacity = "0"; el.style.transform = "translateY(-6px)"; setTimeout(()=>el.remove(), 450); };
    setTimeout(hide, 5000);
    el.addEventListener("click", hide);
  });
});
</script>
