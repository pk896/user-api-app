<!-- views/dashboards/supplier-dashboard.ejs -->
<section class="dashboard-simple supplier">
  <!-- Top Header -->
  <header class="dashboard-header">
    <div class="user-info">
      <div class="avatar">
        <% if (business && business.name) { %>
          <%= business.name.charAt(0).toUpperCase() %>
        <% } else { %>
          <span>S</span>
        <% } %>
      </div>
      <div class="user-details">
        <h1>Welcome, <span class="highlight">
          <% if (business && business.name) { %>
            <%= business.name %>
          <% } else { %>
            Supplier
          <% } %>
        </span></h1>
        <div class="status">
          <span class="badge supplier">SUPPLIER ACCOUNT</span>
          <span class="active-indicator">
            <span class="dot <%= mailerOk ? 'online' : 'offline' %>"></span>
            <%= mailerOk ? 'Mail Service Active' : 'Mail Service Offline' %>
          </span>
        </div>
      </div>
    </div>
    
    <div class="header-stats">
      <div class="stat">
        <small>Today</small>
        <strong><%= new Date().toLocaleDateString('en-ZA', { weekday: 'short', month: 'short', day: 'numeric' }) %></strong>
      </div>
      <div class="stat">
        <small>Store ID</small>
        <strong><% if (business && business._id) { %>
          <%= business._id.toString().slice(-6).toUpperCase() %>
        <% } else { %>
          N/A
        <% } %></strong>
      </div>
    </div>
  </header>

  <!-- Notifications -->
  <% if (success && success.length > 0) { %>
    <div class="notifications">
      <% success.forEach(msg => { %>
        <div class="notification success">
          <span>‚úì</span>
          <%= msg %>
          <button class="close">&times;</button>
        </div>
      <% }) %>
    </div>
  <% } %>
  
  <% if (error && error.length > 0) { %>
    <div class="notifications">
      <% error.forEach(msg => { %>
        <div class="notification error">
          <span>!</span>
          <%= msg %>
          <button class="close">&times;</button>
        </div>
      <% }) %>
    </div>
  <% } %>

  <%
    // Helper functions
    function fmtDate(d) {
      try {
        if (!d) return '';
        const dd = (d instanceof Date) ? d : new Date(d);
        return dd.toLocaleString('en-ZA', {
          timeZone: 'Africa/Johannesburg',
          dateStyle: 'medium',
          timeStyle: 'short'
        });
      } catch { return String(d); }
    }

    function fmtCurrency(amount) {
      return 'R ' + Number(amount || 0).toFixed(2);
    }

    // Use the actual data from your router
    const supplierProducts = Array.isArray(products) ? products : [];
    const supplierTotals = totals || {};
    const supplierKpis = kpis || {};
    const supplierOrders = (orders && orders.recent) ? orders.recent : [];
    const supplierTrackingStats = trackingStats || {};
    
    // Calculate real stats
    const totalProducts = supplierTotals.totalProducts || 0;
    const totalStock = supplierTotals.totalStock || 0;
    const inStockCount = supplierTotals.inStock || 0;
    const lowStockCount = supplierTotals.lowStock || 0;
    const outOfStockCount = supplierTotals.outOfStock || 0;
    
    // Calculate inventory value from products
    const inventoryValue = supplierProducts.reduce((sum, p) => {
      const price = Number(p.price) || 0;
      const stock = Number(p.stock) || 0;
      return sum + (price * stock);
    }, 0);
    
    // Get top performing products from kpis (Top 10)
    const topProducts = Array.isArray(supplierKpis.perProduct) ? 
      supplierKpis.perProduct.slice(0, 10) : [];
      
    // Get products with stock for display
    const availableProducts = supplierProducts
      .filter(p => (Number(p.stock) || 0) > 0)
      .slice(0, 3);
      
    // Get low stock products (stock < 20)
    const lowStockProducts = supplierProducts
      .filter(p => {
        const stock = Number(p.stock) || 0;
        return stock > 0 && stock < 20;
      })
      .slice(0, 5);
    
    // Get out of stock products
    const outOfStockProducts = supplierProducts
      .filter(p => (Number(p.stock) || 0) <= 0)
      .slice(0, 5);
    
    // ===== CHART DATA PROCESSING =====
    let dailyChartData = [];
    let monthlyChartData = [];
    let yearlyChartData = [];
    
    // Create daily data (last 24 hours) - ALWAYS create this even if we have backend data
    const now = new Date();
    
    // Create sample data for last 24 hours (hourly)
    for (let i = 23; i >= 0; i--) {
      const hour = new Date(now);
      hour.setHours(now.getHours() - i);
      const displayHour = hour.toLocaleTimeString('en-ZA', { 
        hour: '2-digit',
        minute: '2-digit',
        hour12: false 
      }).slice(0, 5); // Format: "14:30"
      
      // Create realistic hourly sales pattern
      let sales = 0;
      const currentHour = hour.getHours();
      
      // Business hours (9 AM - 5 PM) have more sales
      if (currentHour >= 9 && currentHour <= 17) {
        // Peak hours around lunch (12-2 PM)
        if (currentHour >= 12 && currentHour <= 14) {
          sales = Math.floor(Math.random() * 1000) + 800;
        } else {
          sales = Math.floor(Math.random() * 800) + 300;
        }
      } else if (currentHour >= 18 && currentHour <= 21) {
        // Evening hours have some sales
        sales = Math.floor(Math.random() * 600) + 200;
      } else {
        // Late night/early morning have minimal sales
        sales = Math.floor(Math.random() * 200);
      }
      
      dailyChartData.push({
        time: displayHour,
        sales: sales
      });
    }
    
    // Create monthly data (30 days)
    const totalRevenue = supplierKpis.revenueLast30 || 3000;
    const avgSaleValue = 1500;
    
    for (let i = 29; i >= 0; i--) {
      const date = new Date(now);
      date.setDate(date.getDate() - i);
      const displayDate = date.toLocaleDateString('en-ZA', { day: 'numeric', month: 'short' });
      
      // Create realistic sales pattern
      let sales = 0;
      if (i % 7 === 0 || i % 5 === 0 || i % 3 === 0) {
        sales = Math.floor(Math.random() * avgSaleValue * 2) + 500;
      }
      
      monthlyChartData.push({
        date: displayDate,
        sales: sales
      });
    }
    
    // Create yearly data (12 months)
    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const yearlyRevenue = supplierKpis.revenueLast30 * 12 || 36000;
    const monthlyRevenue = yearlyRevenue / 12;
    
    months.forEach((month, index) => {
      let sales = monthlyRevenue;
      // Create seasonal pattern
      if (index === 11) sales *= 1.5;
      if (index >= 5 && index <= 8) sales *= 0.8;
      
      // Add some randomness
      sales = sales * (0.7 + Math.random() * 0.6);
      
      yearlyChartData.push({
        month: month,
        sales: Math.max(0, Math.floor(sales))
      });
    });
    
    // For backward compatibility
    let salesTrendData = { 
      daily: dailyChartData, 
      monthly: monthlyChartData, 
      yearly: yearlyChartData 
    };
  %>

  <!-- Quick Stats Section -->
  <section class="quick-stats-section">
    <h2>Supplier Overview</h2>
    <div class="stats-grid">
      <div class="stat-card blue">
        <div class="icon">üì¶</div>
        <div class="details">
          <h3>Total Products</h3>
          <p class="value"><%= totalProducts %></p>
          <small><%= inStockCount %> in stock</small>
        </div>
      </div>
      
      <div class="stat-card purple">
        <div class="icon">üî¢</div>
        <div class="details">
          <h3>Total Stock</h3>
          <p class="value"><%= totalStock %></p>
          <small>Units available</small>
        </div>
      </div>
      
      <div class="stat-card green">
        <div class="icon">üí∞</div>
        <div class="details">
          <h3>Inventory Value</h3>
          <p class="value"><%= fmtCurrency(inventoryValue) %></p>
          <small>Current stock value</small>
        </div>
      </div>
      
      <div class="stat-card orange">
        <div class="icon">‚ö†Ô∏è</div>
        <div class="details">
          <h3>Low Stock</h3>
          <p class="value"><%= lowStockCount %></p>
          <small>Stock &lt; 20 units</small>
        </div>
      </div>
      
      <div class="stat-card black">
        <div class="icon">üìä</div>
        <div class="details">
          <h3>Out of Stock</h3>
          <p class="value"><%= outOfStockCount %></p>
          <small>Need restocking</small>
        </div>
      </div>
    </div>
  </section>

  <!-- Low Stock Products -->
  <% if (lowStockCount > 0) { %>
    <section class="low-stock">
      <div class="section-header">
        <h2>Low Stock Products (<%= lowStockCount %>)</h2>
        <a href="/products?filter=low_stock" class="view-all">View All</a>
      </div>
      
      <div class="low-stock-list">
        <% lowStockProducts.forEach(p => { 
          const stock = Number(p.stock) || 0;
          const price = Number(p.price) || 0;
          const lastUpdated = p.updatedAt || p.createdAt;
        %>
          <div class="low-product">
            <div class="low-product-info">
              <% if (p.imageUrl && p.imageUrl.trim() !== '') { %>
                <img src="<%= p.imageUrl %>" alt="<%= p.name %>" class="low-thumb" loading="lazy">
              <% } else { %>
                <div class="low-thumb-placeholder">üì¶</div>
              <% } %>
              <div class="low-details">
                <h4><%= p.name || 'Unnamed Product' %></h4>
                <div class="low-meta">
                  <span class="price"><%= fmtCurrency(price) %></span>
                  <span class="stock-warning">Stock: <%= stock %></span>
                  <span class="category"><%= p.category || 'General' %></span>
                  <% if (lastUpdated) { %>
                    <small class="last-updated">Updated: <%= fmtDate(lastUpdated).split(',')[0] %></small>
                  <% } %>
                </div>
              </div>
            </div>
            
            <div class="low-actions">
              <a href="/products/edit/<%= p._id || p.customId %>" class="btn-restock">Restock</a>
              <a href="/products/view/<%= p._id || p.customId %>" class="btn-view">View</a>
            </div>
          </div>
        <% }) %>
        
        <% if (lowStockCount > 5) { %>
          <div class="more-products">
            <span>+<%= lowStockCount - 5 %> more low stock products</span>
            <a href="/products?filter=low_stock" class="btn-view-all">View All</a>
          </div>
        <% } %>
      </div>
    </section>
  <% } %>

  <!-- Quick Actions -->
  <section class="quick-actions">
    <h2>Quick Actions</h2>
    <div class="actions-grid">
      <a href="/products/add" class="action primary">
        <span class="action-icon">‚ûï</span>
        <span class="action-text">Add Product</span>
      </a>
      
      <a href="/orders" class="action">
        <span class="action-icon">üì¶</span>
        <span class="action-text">View Orders</span>
      </a>
      
      <a href="/products" class="action">
        <span class="action-icon">üìã</span>
        <span class="action-text">All Products</span>
      </a>
      
      <a href="/supplier/analytics" class="action">
        <span class="action-icon">üìà</span>
        <span class="action-text">Analytics</span>
      </a>
    </div>
  </section>

  <!-- Sales Trend Chart - WITH DAILY VIEW -->
  <section class="sales-trend">
    <div class="section-header">
      <div>
        <h2>Sales Trend</h2>
        <div class="trend-period-toggle">
          <button class="period-btn active" id="daily-btn">Last 24 Hours</button>
          <button class="period-btn" id="monthly-btn">Last 30 Days</button>
          <button class="period-btn" id="yearly-btn">Last 12 Months</button>
        </div>
      </div>
      <span class="trend-summary">
        <small>Current: <span id="current-sales">R 0.00</span></small>
        <small>Avg: <span id="avg-sales">R 0.00</span></small>
        <small>Total: <span id="total-sales">R 0.00</span></small>
      </span>
    </div>
    
    <div class="trend-chart-container">
      <!-- Simple div-based chart -->
      <div id="simple-chart" style="width: 100%; height: 250px; display: flex; align-items: flex-end; gap: 2px; padding: 20px 40px; border-bottom: 1px solid #e2e8f0; border-left: 1px solid #e2e8f0;">
        <!-- Bars will be inserted here by JavaScript -->
      </div>
      
      <!-- X-axis labels container -->
      <div id="chart-labels" style="display: flex; justify-content: space-between; padding: 5px 40px; font-size: 10px; color: #64748b;">
        <!-- Labels will be inserted here -->
      </div>
      
      <!-- Chart Legend -->
      <div class="chart-legend">
        <div class="legend-item">
          <span class="legend-color" style="background: #22C55E;"></span>
          <span id="legend-text">Hourly Sales</span>
        </div>
      </div>
      
      <!-- Trend Stats -->
      <div class="trend-stats">
        <div class="trend-stat">
          <small>Peak</small>
          <strong id="peak-sales">R 0.00</strong>
        </div>
        <div class="trend-stat">
          <small>Lowest</small>
          <strong id="lowest-sales">R 0.00</strong>
        </div>
        <div class="trend-stat">
          <small>Growth</small>
          <strong id="growth-trend" class="positive">0%</strong>
        </div>
        <div class="trend-stat">
          <small>Projection</small>
          <strong id="projection" class="positive">+0%</strong>
        </div>
      </div>
    </div>
  </section>

  <!-- Top 10 Best Sellers -->
  <section class="best-sellers">
    <div class="section-header">
      <h2>Top 10 Best Sellers</h2>
      <a href="/products/performance" class="view-all">View All</a>
    </div>
    
    <% if (topProducts.length > 0) { %>
      <div class="sellers-list">
        <% topProducts.forEach((p, index) => { %>
          <div class="seller-item">
            <div class="seller-rank">
              <span class="rank-number"><%= index + 1 %></span>
              <% if (index < 3) { %>
                <span class="rank-badge <%= index === 0 ? 'gold' : (index === 1 ? 'silver' : (index === 2 ? 'bronze' : '')) %>">
                  <%= index === 0 ? 'ü•á' : (index === 1 ? 'ü•à' : (index === 2 ? 'ü•â' : '')) %>
                </span>
              <% } %>
            </div>
            
            <div class="seller-product">
              <% if (p.imageUrl && p.imageUrl.trim() !== '') { %>
                <img src="<%= p.imageUrl %>" alt="<%= p.name %>" class="product-thumb" loading="lazy">
              <% } else { %>
                <div class="thumb-placeholder">üì¶</div>
              <% } %>
              <div class="product-info">
                <h4><%= p.name || 'Unnamed Product' %></h4>
                <small><%= p.category || 'General' %></small>
              </div>
            </div>
            
            <div class="seller-stats">
              <div class="stat">
                <small>Sold</small>
                <strong><%= p.qty || 0 %></strong>
              </div>
              <div class="stat">
                <small>Revenue</small>
                <strong class="revenue"><%= fmtCurrency(p.estRevenue || 0) %></strong>
              </div>
            </div>
            
            <div class="seller-action">
              <a href="/products/view/<%= p.productId || '#' %>" class="btn-small">View</a>
            </div>
          </div>
        <% }) %>
      </div>
    <% } else { %>
      <div class="empty-state">
        <span>üìä</span>
        <p>No sales data available yet</p>
        <small>Start selling to see your best sellers</small>
      </div>
    <% } %>
  </section>

  <!-- Out of Stock Products -->
  <section class="out-of-stock">
    <div class="section-header">
      <h2>Out of Stock Products (<%= outOfStockCount %>)</h2>
      <% if (outOfStockCount > 0) { %>
        <a href="/products?filter=out_of_stock" class="view-all">Restock All</a>
      <% } %>
    </div>
    
    <% if (outOfStockProducts.length > 0) { %>
      <div class="out-of-stock-list">
        <% outOfStockProducts.forEach(p => { 
          const price = Number(p.price) || 0;
          const lastUpdated = p.updatedAt || p.createdAt;
        %>
          <div class="out-product">
            <div class="out-product-info">
              <% if (p.imageUrl && p.imageUrl.trim() !== '') { %>
                <img src="<%= p.imageUrl %>" alt="<%= p.name %>" class="out-thumb" loading="lazy">
              <% } else { %>
                <div class="out-thumb-placeholder">üì¶</div>
              <% } %>
              <div class="out-details">
                <h4><%= p.name || 'Unnamed Product' %></h4>
                <div class="out-meta">
                  <span class="price"><%= fmtCurrency(price) %></span>
                  <span class="category"><%= p.category || 'General' %></span>
                  <% if (lastUpdated) { %>
                    <small class="last-updated">Updated: <%= fmtDate(lastUpdated).split(',')[0] %></small>
                  <% } %>
                </div>
              </div>
            </div>
            
            <div class="out-actions">
              <a href="/products/edit/<%= p._id || p.customId %>" class="btn-restock">Restock</a>
              <a href="/products/view/<%= p._id || p.customId %>" class="btn-view">View</a>
            </div>
          </div>
        <% }) %>
        
        <% if (outOfStockCount > 5) { %>
          <div class="more-products">
            <span>+<%= outOfStockCount - 5 %> more products out of stock</span>
            <a href="/products?filter=out_of_stock" class="btn-view-all">View All</a>
          </div>
        <% } %>
      </div>
    <% } else { %>
      <div class="empty-state success">
        <span>‚úÖ</span>
        <p>All products are in stock!</p>
        <small>Great job managing your inventory</small>
      </div>
    <% } %>
  </section>

  <!-- Available Products -->
  <section class="top-products">
    <div class="section-header">
      <h2>Available Products</h2>
      <a href="/products/mine" class="view-all">View All</a>
    </div>
    
    <div class="products-list">
      <% if (availableProducts.length > 0) { %>
        <% availableProducts.forEach(p => { 
          const stock = Number(p.stock) || 0;
          const price = Number(p.price) || 0;
        %>
          <div class="product-item">
            <div class="product-image">
              <% if (p.imageUrl && p.imageUrl.trim() !== '') { %>
                <img src="<%= p.imageUrl %>" alt="<%= p.name %>" loading="lazy">
              <% } else { %>
                <div class="placeholder">üì¶</div>
              <% } %>
            </div>
            <div class="product-details">
              <h4><%= p.name || 'Unnamed Product' %></h4>
              <small>Price: <%= fmtCurrency(price) %></small>
              <div class="product-meta">
                <span class="category"><%= p.category || 'General' %></span>
                <span class="stock <%= stock < 20 ? 'low' : 'good' %>">
                  <%= stock %> in stock
                </span>
              </div>
              <% if (stock <= 0) { %>
                <span class="status out">Out of Stock</span>
              <% } else if (stock < 20) { %>
                <span class="status low">Low Stock</span>
              <% } else { %>
                <span class="status in">In Stock</span>
              <% } %>
            </div>
          </div>
        <% }) %>
      <% } else { %>
        <div class="empty-state">
          <span>üì¶</span>
          <p>No products in stock</p>
          <a href="/products/add" class="btn">Add First Product</a>
        </div>
      <% } %>
    </div>
  </section>

  <!-- Recent Orders -->
  <section class="recent-orders">
    <div class="section-header">
      <h2>Recent Orders</h2>
      <a href="/orders" class="view-all">View All</a>
    </div>
    
    <div class="orders-list">
      <% if (supplierOrders.length > 0) { %>
        <% supplierOrders.forEach(o => { 
          const status = o.status || 'pending';
          const statusClass = status.toLowerCase().replace(/\s+/g, '-');
        %>
          <div class="order-item">
            <div class="order-header">
              <span class="order-id">
                <% if (o.orderId) { %>
                  #<%= o.orderId.slice(-8) %>
                <% } else if (o._id) { %>
                  #<%= o._id.toString().slice(-8) %>
                <% } else { %>
                  #N/A
                <% } %>
              </span>
              <span class="order-amount">
                <% if (o.amount && o.amount.value) { %>
                  <%= fmtCurrency(o.amount.value) %>
                <% } else if (o.total) { %>
                  <%= fmtCurrency(o.total) %>
                <% } else { %>
                  <%= fmtCurrency(0) %>
                <% } %>
              </span>
            </div>
            <div class="order-details">
              <span class="status <%= statusClass %>">
                <%= status.charAt(0).toUpperCase() + status.slice(1) %>
              </span>
              <span class="date"><%= fmtDate(o.createdAt) %></span>
            </div>
          </div>
        <% }) %>
      <% } else { %>
        <div class="empty-state">
          <span>üìã</span>
          <p>No recent orders</p>
          <small>Orders will appear here</small>
        </div>
      <% } %>
    </div>
  </section>

  <!-- Shipping Tracking Stats -->
  <% if (supplierTrackingStats && Object.keys(supplierTrackingStats).length > 0) { %>
    <section class="tracking-stats">
      <div class="section-header">
        <h2>Shipping Status</h2>
        <a href="/orders" class="view-all">Track All</a>
      </div>
      
      <div class="stats-grid compact">
        <div class="stat-card <%= supplierTrackingStats.pending > 0 ? 'orange' : 'blue' %>">
          <div class="icon">‚è≥</div>
          <div class="details">
            <h3>Pending</h3>
            <p class="value"><%= supplierTrackingStats.pending || 0 %></p>
          </div>
        </div>
        
        <div class="stat-card <%= supplierTrackingStats.processing > 0 ? 'orange' : 'purple' %>">
          <div class="icon">‚öôÔ∏è</div>
          <div class="details">
            <h3>Processing</h3>
            <p class="value"><%= supplierTrackingStats.processing || 0 %></p>
          </div>
        </div>
        
        <div class="stat-card <%= supplierTrackingStats.shipped > 0 ? 'green' : 'blue' %>">
          <div class="icon">üöö</div>
          <div class="details">
            <h3>Shipped</h3>
            <p class="value"><%= supplierTrackingStats.shipped || 0 %></p>
          </div>
        </div>
        
        <div class="stat-card <%= supplierTrackingStats.delivered > 0 ? 'green' : 'black' %>">
          <div class="icon">‚úÖ</div>
          <div class="details">
            <h3>Delivered</h3>
            <p class="value"><%= supplierTrackingStats.delivered || 0 %></p>
          </div>
        </div>
      </div>
    </section>
  <% } %>

  <!-- Dashboard Footer -->
  <footer class="dashboard-footer">
    <div class="footer-section">
      <h4>Quick Links</h4>
      <div class="footer-links">
        <a href="/products/add">‚ûï Add Product</a>
        <a href="/products/mine">üìã View Products</a>
        <a href="/products/out-of-stock" class="pg-link">
          <span class="pg-ico">üö®</span><span>View Out of Stock</span>
        </a>
        <a href="/orders">üì¶ Orders</a>
        <a href="/business/profile">üë§ Profile</a>
        <form action="/business/logout" method="post" class="logout-form">
          <button type="submit">üö™ Logout</button>
        </form>
      </div>
    </div>
    <div class="copyright">
      <small>¬© <%= new Date().getFullYear() %> <%= business && business.name ? business.name : 'Your Business' %></small>
    </div>
  </footer>
</section>

<style>
  /* ===== COMPANY COLORS ===== */
  .dashboard-simple.supplier {
    --blue: #2563EB;
    --purple: #7C3AED;
    --green: #22C55E;
    --black: #0F172A;
    --orange: #f97316;
    
    --light-bg: #f0fdf4;
    --card-bg: #ffffff;
    --border: #e2e8f0;
    --text: #475569;
    --text-light: #94a3b8;
    
    background: var(--light-bg);
    min-height: 100vh;
    padding: 8px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-size: 14px;
  }

  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  /* ===== HEADER ===== */
  .dashboard-header {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 12px;
    margin-bottom: 12px;
    border: 1px solid var(--border);
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  }

  .user-info {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
  }

  .avatar {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--blue), var(--purple));
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    font-weight: bold;
    flex-shrink: 0;
  }

  .user-details h1 {
    font-size: 16px;
    color: var(--black);
    margin-bottom: 2px;
    line-height: 1.2;
  }

  .highlight {
    color: var(--blue);
    font-weight: 700;
  }

  .status {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
  }

  .badge.supplier {
    background: linear-gradient(135deg, var(--purple), #8B5CF6);
    color: white;
    padding: 3px 8px;
    border-radius: 12px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .active-indicator {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 12px;
    color: var(--text);
  }

  .dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
  }

  .dot.online {
    background: var(--green);
    animation: pulse 2s infinite;
  }

  .dot.offline {
    background: var(--text-light);
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }

  .header-stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 6px;
    padding-top: 8px;
    border-top: 1px solid var(--border);
  }

  .stat {
    text-align: center;
    padding: 8px;
    background: #f8fafc;
    border-radius: 6px;
    border: 1px solid var(--border);
  }

  .stat small {
    display: block;
    font-size: 10px;
    color: var(--text-light);
    margin-bottom: 2px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .stat strong {
    display: block;
    font-size: 13px;
    color: var(--black);
    font-weight: 700;
  }

  /* ===== NOTIFICATIONS ===== */
  .notifications {
    margin-bottom: 12px;
  }

  .notification {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 6px;
    font-size: 12px;
    border-left: 3px solid transparent;
  }

  .notification.success {
    background: rgba(34, 197, 94, 0.1);
    color: #166534;
    border-left-color: var(--green);
  }

  .notification.error {
    background: rgba(239, 68, 68, 0.1);
    color: #b91c1c;
    border-left-color: #ef4444;
  }

  .notification .close {
    margin-left: auto;
    background: none;
    border: none;
    font-size: 18px;
    cursor: pointer;
    opacity: 0.7;
    padding: 0;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .notification .close:hover {
    opacity: 1;
  }

  /* ===== SECTIONS ===== */
  section {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 12px;
    margin-bottom: 12px;
    border: 1px solid var(--border);
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  }

  section h2 {
    font-size: 15px;
    color: var(--black);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 600;
  }

  section h2::before {
    content: '';
    display: block;
    width: 3px;
    height: 14px;
    background: var(--blue);
    border-radius: 1.5px;
  }

  /* ===== QUICK STATS ===== */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
  }

  .stat-card {
    padding: 10px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 10px;
    border: 1px solid;
  }

  .stat-card.blue {
    background: rgba(37, 99, 235, 0.08);
    border-color: rgba(37, 99, 235, 0.2);
  }

  .stat-card.purple {
    background: rgba(124, 58, 237, 0.08);
    border-color: rgba(124, 58, 237, 0.2);
  }

  .stat-card.green {
    background: rgba(34, 197, 94, 0.08);
    border-color: rgba(34, 197, 94, 0.2);
  }

  .stat-card.orange {
    background: rgba(249, 115, 22, 0.08);
    border-color: rgba(249, 115, 22, 0.2);
  }

  .stat-card.black {
    background: rgba(15, 23, 42, 0.08);
    border-color: rgba(15, 23, 42, 0.2);
  }

  .stat-card .icon {
    font-size: 18px;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border-radius: 8px;
    border: 1px solid rgba(0,0,0,0.1);
    flex-shrink: 0;
  }

  .stat-card .details {
    flex: 1;
    min-width: 0;
  }

  .stat-card .details h3 {
    font-size: 11px;
    color: var(--text);
    margin-bottom: 2px;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .stat-card .value {
    font-size: 16px;
    font-weight: 800;
    color: var(--black);
    margin-bottom: 1px;
    line-height: 1.2;
  }

  .stat-card small {
    font-size: 10px;
    color: var(--text-light);
    display: block;
  }

  .stat-card.green .value {
    color: var(--green);
  }

  .stat-card.orange .value {
    color: var(--orange);
  }

  /* ===== LOW STOCK SECTION ===== */
  .low-stock-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .low-product {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    background: rgba(249, 115, 22, 0.05);
    border-radius: 8px;
    border: 1px solid rgba(249, 115, 22, 0.2);
  }

  .low-product-info {
    display: flex;
    align-items: center;
    gap: 10px;
    flex: 1;
    min-width: 0;
  }

  .low-thumb {
    width: 40px;
    height: 40px;
    border-radius: 6px;
    object-fit: cover;
    border: 1px solid rgba(249, 115, 22, 0.3);
  }

  .low-thumb-placeholder {
    width: 40px;
    height: 40px;
    border-radius: 6px;
    background: rgba(249, 115, 22, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    color: var(--orange);
  }

  .low-details {
    flex: 1;
    min-width: 0;
  }

  .low-details h4 {
    font-size: 13px;
    color: var(--black);
    margin-bottom: 4px;
    font-weight: 600;
  }

  .low-meta {
    display: flex;
    gap: 12px;
    align-items: center;
    flex-wrap: wrap;
  }

  .low-meta .price {
    font-size: 12px;
    color: var(--green);
    font-weight: 700;
  }

  .low-meta .stock-warning {
    font-size: 11px;
    color: var(--orange);
    font-weight: 600;
    background: rgba(249, 115, 22, 0.1);
    padding: 2px 6px;
    border-radius: 8px;
  }

  .low-meta .category {
    font-size: 11px;
    color: var(--text);
    background: rgba(124, 58, 237, 0.1);
    padding: 2px 6px;
    border-radius: 8px;
  }

  .low-meta .last-updated {
    font-size: 10px;
    color: var(--text-light);
  }

  .low-actions {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
  }

  /* ===== QUICK ACTIONS ===== */
  .actions-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
  }

  .action {
    padding: 12px;
    border-radius: 8px;
    text-decoration: none;
    text-align: center;
    border: 1px solid var(--border);
    background: #f8fafc;
    transition: all 0.2s;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 70px;
  }

  .action:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .action.primary {
    background: linear-gradient(135deg, var(--blue), #3B82F6);
    color: white;
    border: none;
  }

  .action.primary:hover {
    background: linear-gradient(135deg, #1d4ed8, #2563eb);
  }

  .action-icon {
    font-size: 20px;
    display: block;
    margin-bottom: 6px;
  }

  .action-text {
    display: block;
    font-weight: 600;
    font-size: 13px;
  }

  /* ===== SIMPLE CHART BAR STYLES ===== */
  .chart-bar {
    background: #22C55E;
    border-radius: 2px 2px 0 0;
    min-height: 1px;
    position: relative;
    flex: 1;
    transition: background-color 0.2s;
  }
  
  .chart-bar:hover {
    background: #16a34a;
  }
  
  .chart-tooltip {
    position: absolute;
    background: #1e293b;
    color: white;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 12px;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    margin-bottom: 5px;
    white-space: nowrap;
    z-index: 100;
    display: none;
    pointer-events: none;
  }
  
  .chart-bar:hover .chart-tooltip {
    display: block;
  }

  /* ===== ENHANCED SALES TREND CHART ===== */
  .sales-trend {
    overflow: hidden;
  }

  .sales-trend .section-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 16px;
    flex-wrap: wrap;
    gap: 12px;
  }

  .trend-period-toggle {
    display: flex;
    gap: 6px;
    margin-top: 8px;
    flex-wrap: wrap;
  }

  .period-btn {
    padding: 6px 10px;
    background: #f1f5f9;
    border: 1px solid #cbd5e1;
    border-radius: 6px;
    font-size: 11px;
    color: #64748b;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
    flex: 1;
    min-width: 80px;
    text-align: center;
  }

  .period-btn:hover {
    background: #e2e8f0;
  }

  .period-btn.active {
    background: var(--blue);
    color: white;
    border-color: var(--blue);
  }

  .trend-summary {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }

  .trend-summary small {
    font-size: 11px;
    color: var(--text-light);
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .trend-chart-container {
    margin-top: 16px;
  }

  .chart-legend {
    display: flex;
    gap: 16px;
    justify-content: center;
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid var(--border);
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    color: var(--text);
  }

  .legend-color {
    width: 12px;
    height: 12px;
    border-radius: 2px;
  }

  /* Enhanced Trend Stats */
  .trend-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    padding-top: 12px;
    border-top: 1px solid var(--border);
  }

  .trend-stat {
    text-align: center;
    padding: 10px;
    background: #f8fafc;
    border-radius: 8px;
    border: 1px solid var(--border);
  }

  .trend-stat small {
    display: block;
    font-size: 11px;
    color: var(--text-light);
    margin-bottom: 4px;
  }

  .trend-stat strong {
    display: block;
    font-size: 14px;
    color: var(--black);
    font-weight: 700;
  }

  /* Fix: Add missing CSS classes for dynamic elements */
  #current-sales,
  #avg-sales,
  #total-sales,
  #peak-sales,
  #lowest-sales,
  #growth-trend,
  #projection {
    font-weight: 600;
  }

  #growth-trend.positive,
  #projection.positive {
    color: var(--green);
  }

  #growth-trend.negative,
  #projection.negative {
    color: #ef4444;
  }

  /* Remove old chart styles that might conflict */
  .chart-wrapper,
  .chart-svg,
  .trendline-svg,
  .trend-chart,
  .chart-container,
  .chart-column,
  .chart-value,
  .chart-label {
    display: none;
  }

  /* ===== BEST SELLERS ===== */
  .best-sellers .sellers-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .seller-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px;
    background: #f8fafc;
    border-radius: 8px;
    border: 1px solid var(--border);
  }

  .seller-rank {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    flex-shrink: 0;
  }

  .rank-number {
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--border);
    border-radius: 50%;
    font-size: 12px;
    font-weight: 600;
    color: var(--text);
  }

  .rank-badge {
    font-size: 16px;
  }

  .rank-badge.gold { color: #fbbf24; }
  .rank-badge.silver { color: #9ca3af; }
  .rank-badge.bronze { color: #f97316; }

  .seller-product {
    display: flex;
    align-items: center;
    gap: 10px;
    flex: 1;
    min-width: 0;
  }

  .product-thumb {
    width: 40px;
    height: 40px;
    border-radius: 6px;
    object-fit: cover;
    border: 1px solid var(--border);
  }

  .thumb-placeholder {
    width: 40px;
    height: 40px;
    border-radius: 6px;
    background: var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    color: var(--text-light);
  }

  .product-info {
    flex: 1;
    min-width: 0;
  }

  .product-info h4 {
    font-size: 13px;
    color: var(--black);
    margin-bottom: 2px;
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .product-info small {
    font-size: 11px;
    color: var(--text-light);
  }

  .seller-stats {
    display: flex;
    gap: 16px;
    flex-shrink: 0;
  }

  .seller-stats .stat {
    text-align: center;
    padding: 0;
    background: none;
    border: none;
  }

  .seller-stats .stat small {
    display: block;
    font-size: 10px;
    color: var(--text-light);
    margin-bottom: 2px;
  }

  .seller-stats .stat strong {
    display: block;
    font-size: 12px;
    color: var(--black);
    font-weight: 700;
  }

  .seller-stats .stat .revenue {
    color: var(--green);
  }

  .seller-action {
    flex-shrink: 0;
  }

  .btn-small {
    padding: 6px 12px;
    background: var(--blue);
    color: white;
    border-radius: 6px;
    text-decoration: none;
    font-size: 11px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    display: inline-block;
  }

  .btn-small:hover {
    background: #1d4ed8;
  }

  /* ===== OUT OF STOCK ===== */
  .out-of-stock-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .out-product {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    background: rgba(239, 68, 68, 0.05);
    border-radius: 8px;
    border: 1px solid rgba(239, 68, 68, 0.2);
  }

  .out-product-info {
    display: flex;
    align-items: center;
    gap: 10px;
    flex: 1;
    min-width: 0;
  }

  .out-thumb {
    width: 40px;
    height: 40px;
    border-radius: 6px;
    object-fit: cover;
    border: 1px solid rgba(239, 68, 68, 0.3);
  }

  .out-thumb-placeholder {
    width: 40px;
    height: 40px;
    border-radius: 6px;
    background: rgba(239, 68, 68, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    color: #ef4444;
  }

  .out-details {
    flex: 1;
    min-width: 0;
  }

  .out-details h4 {
    font-size: 13px;
    color: var(--black);
    margin-bottom: 4px;
    font-weight: 600;
  }

  .out-meta {
    display: flex;
    gap: 12px;
    align-items: center;
    flex-wrap: wrap;
  }

  .out-meta .price {
    font-size: 12px;
    color: var(--green);
    font-weight: 700;
  }

  .out-meta .category {
    font-size: 11px;
    color: var(--text);
    background: rgba(124, 58, 237, 0.1);
    padding: 2px 6px;
    border-radius: 8px;
  }

  .out-meta .last-updated {
    font-size: 10px;
    color: var(--text-light);
  }

  .out-actions {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
  }

  .btn-restock {
    padding: 6px 12px;
    background: #ef4444;
    color: white;
    border-radius: 6px;
    text-decoration: none;
    font-size: 11px;
    font-weight: 600;
    border: none;
  }

  .btn-restock:hover {
    background: #dc2626;
  }

  .btn-view {
    padding: 6px 12px;
    background: var(--blue);
    color: white;
    border-radius: 6px;
    text-decoration: none;
    font-size: 11px;
    font-weight: 600;
    border: none;
  }

  .btn-view:hover {
    background: #1d4ed8;
  }

  .more-products {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    background: #f8fafc;
    border-radius: 8px;
    border: 1px dashed var(--border);
  }

  .more-products span {
    font-size: 12px;
    color: var(--text);
  }

  .btn-view-all {
    padding: 4px 12px;
    background: var(--purple);
    color: white;
    border-radius: 6px;
    text-decoration: none;
    font-size: 11px;
    font-weight: 600;
  }

  /* ===== PRODUCTS ===== */
  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }

  .view-all {
    font-size: 12px;
    color: var(--blue);
    text-decoration: none;
    font-weight: 600;
    padding: 4px 8px;
    border-radius: 6px;
  }

  .view-all:hover {
    background: rgba(37, 99, 235, 0.1);
  }

  .products-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .product-item {
    display: flex;
    gap: 10px;
    padding: 10px;
    background: #f8fafc;
    border-radius: 8px;
    border: 1px solid var(--border);
    align-items: center;
  }

  .product-image {
    flex-shrink: 0;
  }

  .product-image img {
    width: 44px;
    height: 44px;
    border-radius: 6px;
    object-fit: cover;
    border: 1px solid var(--border);
  }

  .product-image .placeholder {
    width: 44px;
    height: 44px;
    border-radius: 6px;
    background: var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    color: var(--text-light);
  }

  .product-details {
    flex: 1;
    min-width: 0;
  }

  .product-details h4 {
    font-size: 13px;
    color: var(--black);
    margin-bottom: 2px;
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .product-details small {
    font-size: 11px;
    color: var(--text-light);
    display: block;
    margin-bottom: 4px;
  }

  .product-meta {
    display: flex;
    gap: 8px;
    margin-bottom: 4px;
    flex-wrap: wrap;
    align-items: center;
  }

  .category {
    background: rgba(124, 58, 237, 0.1);
    color: var(--purple);
    padding: 2px 6px;
    border-radius: 8px;
    font-size: 10px;
    font-weight: 600;
    white-space: nowrap;
  }

  .stock {
    font-size: 11px;
    padding: 2px 6px;
    border-radius: 8px;
    font-weight: 600;
  }

  .stock.good {
    background: rgba(34, 197, 94, 0.1);
    color: #166534;
  }

  .stock.low {
    background: rgba(249, 115, 22, 0.1);
    color: #92400e;
  }

  .status {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 8px;
    font-size: 10px;
    font-weight: 600;
    margin-top: 2px;
  }

  .status.in {
    background: rgba(34, 197, 94, 0.1);
    color: #166534;
  }

  .status.low {
    background: rgba(249, 115, 22, 0.1);
    color: #92400e;
  }

  .status.out {
    background: rgba(239, 68, 68, 0.1);
    color: #b91c1c;
  }

  /* ===== RECENT ORDERS ===== */
  .orders-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .order-item {
    padding: 10px;
    background: #f8fafc;
    border-radius: 8px;
    border: 1px solid var(--border);
  }

  .order-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
  }

  .order-id {
    font-family: 'SF Mono', Monaco, monospace;
    font-size: 12px;
    color: var(--black);
    font-weight: 600;
    letter-spacing: 0.5px;
  }

  .order-amount {
    font-size: 13px;
    color: var(--green);
    font-weight: 700;
  }

  .order-details {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .order-details .status {
    padding: 3px 8px;
    border-radius: 8px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .status.completed,
  .status.delivered,
  .status.shipped {
    background: rgba(34, 197, 94, 0.1);
    color: #166534;
  }

  .status.pending,
  .status.processing {
    background: rgba(249, 115, 22, 0.1);
    color: #92400e;
  }

  .status.cancelled,
  .status.refunded {
    background: rgba(239, 68, 68, 0.1);
    color: #b91c1c;
  }

  .order-details .date {
    font-size: 10px;
    color: var(--text-light);
  }

  /* ===== TRACKING STATS ===== */
  .tracking-stats .stats-grid.compact {
    grid-template-columns: repeat(4, 1fr);
    gap: 6px;
  }

  .tracking-stats .stat-card {
    padding: 8px;
    text-align: center;
    justify-content: center;
  }

  .tracking-stats .stat-card .icon {
    width: 28px;
    height: 28px;
    font-size: 14px;
    margin: 0 auto 4px;
  }

  .tracking-stats .stat-card .details {
    text-align: center;
  }

  .tracking-stats .stat-card .value {
    font-size: 14px;
    margin-bottom: 0;
  }

  .tracking-stats .stat-card h3 {
    font-size: 10px;
    margin-bottom: 0;
  }

  /* ===== EMPTY STATES ===== */
  .empty-state {
    padding: 32px 16px;
    text-align: center;
    color: var(--text-light);
  }

  .empty-state.success {
    background: rgba(34, 197, 94, 0.05);
    border-radius: 8px;
  }

  .empty-state span {
    font-size: 32px;
    display: block;
    margin-bottom: 12px;
    opacity: 0.5;
  }

  .empty-state p {
    margin-bottom: 8px;
    font-size: 14px;
    color: var(--text);
  }

  .empty-state small {
    font-size: 12px;
    color: var(--text-light);
    display: block;
    margin-bottom: 16px;
  }

  .empty-state .btn {
    display: inline-block;
    padding: 10px 20px;
    background: var(--blue);
    color: white;
    border-radius: 8px;
    text-decoration: none;
    font-size: 13px;
    font-weight: 600;
    border: none;
  }

  /* ===== FOOTER ===== */
  .dashboard-footer {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 12px;
    margin-top: 12px;
    border: 1px solid var(--border);
    text-align: center;
  }

  .footer-section h4 {
    font-size: 13px;
    color: var(--black);
    margin-bottom: 8px;
    font-weight: 600;
    text-align: left;
  }

  .footer-links {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 12px;
    justify-content: center;
  }

  .footer-links a,
  .logout-form button {
    padding: 6px 10px;
    color: var(--text);
    text-decoration: none;
    font-size: 12px;
    border-radius: 6px;
    background: #f8fafc;
    border: 1px solid var(--border);
    white-space: nowrap;
  }

  .logout-form {
    display: inline;
  }

  .logout-form button {
    background: none;
    border: none;
    font-family: inherit;
    cursor: pointer;
    width: auto;
  }

  .footer-links a:hover,
  .logout-form button:hover {
    color: var(--blue);
    background: rgba(37, 99, 235, 0.1);
  }

  .copyright {
    padding-top: 8px;
    border-top: 1px solid var(--border);
  }

  .copyright small {
    font-size: 10px;
    color: var(--text-light);
  }

  /* ===== RESPONSIVE ===== */
  @media (min-width: 375px) {
    .dashboard-simple.supplier {
      padding: 12px;
    }
    
    .header-stats {
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }
    
    .stat {
      padding: 10px;
    }
    
    .stats-grid {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .tracking-stats .stats-grid.compact {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 768px) {
    .dashboard-simple.supplier {
      padding: 16px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 16px;
    }
    
    .user-info {
      margin-bottom: 0;
    }
    
    .header-stats {
      width: 200px;
      padding-top: 0;
      border-top: none;
    }
    
    .stats-grid {
      grid-template-columns: repeat(5, 1fr);
    }
    
    .actions-grid {
      grid-template-columns: repeat(4, 1fr);
    }
    
    .seller-item {
      gap: 16px;
    }
    
    .seller-stats {
      gap: 24px;
    }
    
    .out-product,
    .low-product {
      gap: 16px;
    }
    
    .tracking-stats .stats-grid.compact {
      grid-template-columns: repeat(4, 1fr);
    }
    
    .footer-links {
      justify-content: flex-start;
    }
    
    .period-btn {
      min-width: 100px;
      font-size: 12px;
      padding: 8px 12px;
    }
  }

  /* Responsive adjustments for chart */
  @media (max-width: 768px) {
    .trend-stats {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .chart-legend {
      flex-direction: column;
      gap: 8px;
    }
    
    .sales-trend .section-header {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .trend-summary {
      width: 100%;
      justify-content: space-between;
    }
    
    #simple-chart,
    #chart-labels {
      padding: 20px 20px;
    }
    
    .period-btn {
      min-width: 70px;
      font-size: 10px;
      padding: 5px 8px;
    }
  }

  @media (max-width: 375px) {
    .period-btn {
      padding: 4px 6px;
      font-size: 9px;
      min-width: 60px;
    }
    
    .trend-stats {
      grid-template-columns: 1fr;
    }
    
    #simple-chart {
      height: 200px;
      padding: 15px;
    }
    
    #chart-labels {
      padding: 5px 15px;
    }
  }

  /* Hisense U50 Lite specific (320px width) */
  @media (max-width: 320px) {
    .dashboard-simple.supplier {
      padding: 6px;
      font-size: 13px;
    }
    
    .avatar {
      width: 36px;
      height: 36px;
      font-size: 14px;
    }
    
    .user-details h1 {
      font-size: 14px;
    }
    
    .stat-card {
      padding: 8px;
      gap: 6px;
    }
    
    .stat-card .icon {
      width: 32px;
      height: 32px;
      font-size: 16px;
    }
    
    .stat-card .value {
      font-size: 14px;
    }
    
    .action {
      padding: 8px;
      min-height: 60px;
    }
    
    .action-icon {
      font-size: 18px;
      margin-bottom: 4px;
    }
    
    .action-text {
      font-size: 12px;
    }
    
    .seller-item {
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .seller-rank {
      order: 1;
    }
    
    .seller-product {
      order: 2;
      flex: 2;
    }
    
    .seller-stats {
      order: 3;
      flex: 100%;
      justify-content: space-around;
    }
    
    .seller-action {
      order: 4;
      margin-left: auto;
    }
    
    .out-product,
    .low-product {
      flex-direction: column;
      align-items: stretch;
      gap: 12px;
    }
    
    .out-actions,
    .low-actions {
      justify-content: flex-end;
    }
    
    .more-products {
      flex-direction: column;
      gap: 8px;
      text-align: center;
    }
    
    .product-item,
    .order-item {
      padding: 8px;
    }
    
    .product-image img,
    .product-image .placeholder {
      width: 36px;
      height: 36px;
    }
    
    .tracking-stats .stats-grid.compact {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .footer-links {
      flex-direction: column;
      align-items: stretch;
    }
    
    .footer-links a,
    .logout-form button {
      text-align: center;
      padding: 8px;
    }
    
    #simple-chart {
      padding: 10px;
      height: 180px;
    }
    
    #chart-labels {
      padding: 5px 10px;
      font-size: 9px;
    }
    
    .period-btn {
      min-width: 50px;
      font-size: 8px;
      padding: 3px 4px;
    }
    
    .trend-period-toggle {
      gap: 3px;
    }
  }
</style>

<script nonce="<%= nonce %>">
  // Close notifications
  function setupNotifications() {
    document.querySelectorAll('.notification .close').forEach(button => {
      button.addEventListener('click', (e) => {
        const notification = e.target.closest('.notification');
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(-10px)';
        setTimeout(() => notification.remove(), 300);
      });
    });

    // Auto-hide success notifications after 5 seconds
    setTimeout(() => {
      document.querySelectorAll('.notification.success').forEach(notification => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(-10px)';
        setTimeout(() => notification.remove(), 300);
      });
    }, 5000);
  }

  // Helper function to format currency
  function fmtCurrency(amount) {
    return 'R ' + Number(amount || 0).toFixed(2);
  }

  // WORKING SIMPLE CHART FUNCTION WITH DAILY VIEW
  function createSimpleChart() {
    console.log('üìä Creating simple chart with daily view...');
    
    // Get data directly from EJS variables
    const dailyData = <%- JSON.stringify(dailyChartData) %>;
    const monthlyData = <%- JSON.stringify(monthlyChartData) %>;
    const yearlyData = <%- JSON.stringify(yearlyChartData) %>;
    
    console.log('Daily data (24h):', dailyData);
    console.log('Monthly data (30d):', monthlyData);
    console.log('Yearly data (12m):', yearlyData);
    
    let currentPeriod = 'daily';
    let currentData = dailyData;
    
    // Update statistics
    function updateStats(data, period) {
      const values = data.map(item => item.sales || 0);
      const total = values.reduce((sum, val) => sum + val, 0);
      const avg = values.length > 0 ? total / values.length : 0;
      const peak = Math.max(...values);
      const lowest = Math.min(...values.filter(v => v > 0));
      const current = values[values.length - 1] || 0;
      
      // Calculate growth (different calculation for daily vs monthly/yearly)
      let growth = 0;
      
      if (period === 'daily') {
        // For daily (24h), compare first vs last 8 hours
        if (values.length >= 8) {
          const firstHalfAvg = values.slice(0, 8).reduce((sum, val) => sum + val, 0) / 8;
          const lastHalfAvg = values.slice(-8).reduce((sum, val) => sum + val, 0) / 8;
          growth = firstHalfAvg > 0 ? ((lastHalfAvg - firstHalfAvg) / firstHalfAvg * 100) : 0;
        }
      } else {
        // For monthly/yearly, compare first vs last data point
        const first = values[0] || 0;
        const last = values[values.length - 1] || 0;
        growth = first > 0 ? ((last - first) / first * 100) : 0;
      }
      
      // Update DOM
      document.getElementById('current-sales').textContent = fmtCurrency(current);
      document.getElementById('avg-sales').textContent = fmtCurrency(avg);
      document.getElementById('total-sales').textContent = fmtCurrency(total);
      document.getElementById('peak-sales').textContent = fmtCurrency(peak);
      document.getElementById('lowest-sales').textContent = fmtCurrency(lowest || 0);
      
      const growthEl = document.getElementById('growth-trend');
      growthEl.textContent = growth.toFixed(1) + '%';
      growthEl.className = growth >= 0 ? 'positive' : 'negative';
      
      const projectionEl = document.getElementById('projection');
      projectionEl.textContent = (growth >= 0 ? '+' : '') + growth.toFixed(1) + '%';
      projectionEl.className = growth >= 0 ? 'positive' : 'negative';
      
      // Update legend text based on period
      const legendText = document.getElementById('legend-text');
      if (period === 'daily') {
        legendText.textContent = 'Hourly Sales';
      } else if (period === 'monthly') {
        legendText.textContent = 'Daily Sales';
      } else {
        legendText.textContent = 'Monthly Sales';
      }
      
      console.log(`Stats updated for ${period}:`, { 
        total: fmtCurrency(total), 
        avg: fmtCurrency(avg), 
        peak: fmtCurrency(peak),
        growth: growth + '%' 
      });
    }
    
    // Draw the chart using DIVs
    function drawChart(data, period) {
      console.log(`Drawing ${period} chart with ${data.length} points`);
      
      const chartContainer = document.getElementById('simple-chart');
      const labelsContainer = document.getElementById('chart-labels');
      
      // Clear previous chart
      chartContainer.innerHTML = '';
      labelsContainer.innerHTML = '';
      
      // Find max value for scaling
      const values = data.map(item => item.sales || 0);
      const maxValue = Math.max(...values, 1);
      const chartHeight = 200; // px
      
      console.log('Max value for scaling:', maxValue);
      
      // Determine how many labels to show based on period
      let labelFrequency = 1;
      if (period === 'daily') {
        // For 24 hours, show every 3rd hour
        labelFrequency = 3;
      } else if (period === 'monthly') {
        // For 30 days, show every 5th day
        labelFrequency = 5;
      } else {
        // For yearly, show all months
        labelFrequency = 1;
      }
      
      // Create bars
      data.forEach((item, index) => {
        const value = item.sales || 0;
        const barHeight = (value / maxValue) * chartHeight;
        
        // Get label based on period
        let label = '';
        if (period === 'daily') {
          label = item.time;
        } else if (period === 'monthly') {
          label = item.date;
        } else {
          label = item.month;
        }
        
        // Create bar div
        const bar = document.createElement('div');
        bar.className = 'chart-bar';
        bar.style.height = barHeight + 'px';
        bar.style.minWidth = period === 'daily' ? '8px' : '10px';
        bar.title = `${label}: ${fmtCurrency(value)}`;
        
        // Add tooltip
        const tooltip = document.createElement('div');
        tooltip.className = 'chart-tooltip';
        tooltip.textContent = `${label}: ${fmtCurrency(value)}`;
        bar.appendChild(tooltip);
        
        chartContainer.appendChild(bar);
        
        // Add label (show based on frequency)
        if (period === 'yearly' || index % labelFrequency === 0 || index === data.length - 1) {
          const labelEl = document.createElement('div');
          
          // Format label differently based on period
          if (period === 'daily') {
            // For hours, just show the hour
            labelEl.textContent = label.slice(0, 5);
          } else if (period === 'monthly') {
            // For dates, show day number only
            labelEl.textContent = label.split(' ')[0];
          } else {
            // For months, show month abbreviation
            labelEl.textContent = label;
          }
          
          labelEl.style.fontSize = period === 'daily' ? '9px' : '10px';
          labelEl.style.textAlign = 'center';
          labelEl.style.flex = '1';
          labelsContainer.appendChild(labelEl);
        } else {
          // Empty placeholder for spacing
          const spacer = document.createElement('div');
          spacer.style.flex = '1';
          labelsContainer.appendChild(spacer);
        }
      });
      
      console.log('Chart drawn with max value:', maxValue);
    }
    
    // Setup period toggle
    document.getElementById('daily-btn').addEventListener('click', function() {
      // Update active button
      document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
      this.classList.add('active');
      
      // Switch data
      currentPeriod = 'daily';
      currentData = dailyData;
      updateStats(currentData, currentPeriod);
      drawChart(currentData, currentPeriod);
    });
    
    document.getElementById('monthly-btn').addEventListener('click', function() {
      // Update active button
      document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
      this.classList.add('active');
      
      // Switch data
      currentPeriod = 'monthly';
      currentData = monthlyData;
      updateStats(currentData, currentPeriod);
      drawChart(currentData, currentPeriod);
    });
    
    document.getElementById('yearly-btn').addEventListener('click', function() {
      // Update active button
      document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
      this.classList.add('active');
      
      // Switch data
      currentPeriod = 'yearly';
      currentData = yearlyData;
      updateStats(currentData, currentPeriod);
      drawChart(currentData, currentPeriod);
    });
    
    // Initial draw (default to daily view)
    updateStats(currentData, currentPeriod);
    drawChart(currentData, currentPeriod);
    
    console.log('‚úÖ Simple chart with daily view initialized');
  }
  
  // Auto-refresh KPIs
  async function refreshKPIs() {
    try {
      const res = await fetch('/business/api/supplier/kpis', {
        credentials: 'same-origin',
        headers: { 'Cache-Control': 'no-cache' }
      });
      
      if (!res.ok) return;

      const data = await res.json().catch(() => ({}));
      if (!data || data.ok === false) return;

      // Update KPI values
      const updateValue = (selector, value, formatter) => {
        const elements = document.querySelectorAll(`[data-kpi="${selector}"]`);
        elements.forEach(el => {
          const newValue = formatter ? formatter(value) : (value ?? 0);
          if (el.textContent !== newValue.toString()) {
            el.textContent = newValue;
            el.classList.add('value-updated');
            setTimeout(() => el.classList.remove('value-updated'), 500);
          }
        });
      };

      // Update values from API response
      updateValue('totalProducts', data.totalProducts);
      updateValue('totalStock', data.totalStock);
      updateValue('inStock', data.inStock);
      updateValue('lowStock', data.lowStock);
      updateValue('outOfStock', data.outOfStock);
      updateValue('soldLast30', data.soldLast30);
      updateValue('revenueLast30', data.revenueLast30, v => 'R ' + Number(v || 0).toFixed(2));

    } catch (error) {
      console.warn('KPI refresh failed:', error);
    }
  }

  // Initialize dashboard
  document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Supplier dashboard loaded, initializing...');
    
    setupNotifications();
    
    // Initialize chart with small delay
    setTimeout(() => {
      if (document.getElementById('simple-chart')) {
        createSimpleChart();
      } else {
        console.error('Chart container not found!');
      }
    }, 100);
    
    // Add click effects to buttons
    document.querySelectorAll('.action, .btn, .btn-small, .btn-restock, .btn-view, .btn-view-all')
      .forEach(button => {
        button.addEventListener('click', function() {
          this.style.transform = 'scale(0.98)';
          setTimeout(() => {
            this.style.transform = '';
          }, 150);
        });
      });
    
    // Initial KPI refresh
    refreshKPIs();
    
    // Refresh every 30 seconds
    setInterval(refreshKPIs, 30000);
    
    // Refresh when tab becomes visible
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden) {
        refreshKPIs();
      }
    });
  });
</script>