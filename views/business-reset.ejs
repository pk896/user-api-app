<div class="password-reset-page">
  <!-- Background Decoration -->
  <div class="background-decoration">
    <div class="decoration-circle circle-1"></div>
    <div class="decoration-circle circle-2"></div>
    <div class="decoration-circle circle-3"></div>
  </div>

  <!-- Main Content -->
  <div class="reset-container">
    <!-- Left Side - Information -->
    <div class="reset-info">
      <div class="info-content">
        <div class="brand-header">
          <div class="brand-logo">
            <svg viewBox="0 0 24 24" width="32" height="32">
              <path fill="currentColor" d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
            </svg>
          </div>
          <h1 class="brand-name">Unicoporate</h1>
        </div>
        
        <div class="info-welcome">
          <h2>Create New Password</h2>
          <p>Secure your business account with a strong, unique password.</p>
        </div>

        <div class="password-rules">
          <h3>Password Requirements</h3>
          <ul class="rules-list">
            <li id="rule-length" class="rule-item">
              <svg viewBox="0 0 24 24" width="16" height="16">
                <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
              </svg>
              <span>At least 8 characters</span>
            </li>
            <li id="rule-uppercase" class="rule-item">
              <svg viewBox="0 0 24 24" width="16" height="16">
                <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
              </svg>
              <span>One uppercase letter</span>
            </li>
            <li id="rule-lowercase" class="rule-item">
              <svg viewBox="0 0 24 24" width="16" height="16">
                <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
              </svg>
              <span>One lowercase letter</span>
            </li>
            <li id="rule-number" class="rule-item">
              <svg viewBox="0 0 24 24" width="16" height="16">
                <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
              </svg>
              <span>One number</span>
            </li>
            <li id="rule-match" class="rule-item">
              <svg viewBox="0 0 24 24" width="16" height="16">
                <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
              </svg>
              <span>Passwords must match</span>
            </li>
          </ul>
        </div>

        <div class="security-tips">
          <h3>Security Tips</h3>
          <div class="tips-grid">
            <div class="tip">
              <div class="tip-icon">
                <svg viewBox="0 0 24 24" width="20" height="20">
                  <path fill="currentColor" d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
                </svg>
              </div>
              <div class="tip-content">
                <h4>Unique Password</h4>
                <p>Don't reuse passwords from other sites</p>
              </div>
            </div>
            
            <div class="tip">
              <div class="tip-icon">
                <svg viewBox="0 0 24 24" width="20" height="20">
                  <path fill="currentColor" d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/>
                </svg>
              </div>
              <div class="tip-content">
                <h4>Password Manager</h4>
                <p>Use a password manager for security</p>
              </div>
            </div>
          </div>
        </div>

        <div class="info-footer">
          <p>Remember your password?</p>
          <a href="/business/login" class="btn-login">
            <svg viewBox="0 0 24 24" width="18" height="18">
              <path fill="currentColor" d="M10 17v-3H3v-4h7V7l5 5-5 5z"/>
            </svg>
            Back to Login
          </a>
        </div>
      </div>
    </div>

    <!-- Right Side - Reset Form -->
    <div class="reset-form-container <%= themeCss && themeCss.includes('dark') ? 'dark-theme' : 'light-theme' %>">
      <div class="form-header">
        <div class="header-icon">
          <svg viewBox="0 0 24 24" width="32" height="32">
            <path fill="currentColor" d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
          </svg>
        </div>
        <h2>Set New Password</h2>
        <p class="form-subtitle">Create a strong password to secure your account</p>
      </div>

      <!-- Flash Messages -->
      <div class="flash-container">
        <% (success || []).forEach(msg => { %>
          <div class="flash flash-success">
            <svg class="flash-icon" viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
            </svg>
            <div class="flash-content">
              <strong>Success!</strong>
              <p><%= msg %></p>
            </div>
          </div>
        <% }) %>
        <% (error || []).forEach(msg => { %>
          <div class="flash flash-error">
            <svg class="flash-icon" viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
            </svg>
            <div class="flash-content">
              <strong>Error!</strong>
              <p><%= msg %></p>
            </div>
          </div>
        <% }) %>
      </div>

      <form
        action="/business/password/reset/<%= token %>"
        method="post"
        class="reset-form"
        id="resetForm"
        autocomplete="on"
        novalidate
      >
        <!-- Password Strength Indicator -->
        <div class="password-strength-container">
          <div class="strength-header">
            <span class="strength-label">Password Strength</span>
            <span class="strength-value" id="strengthValue">Weak</span>
          </div>
          <div class="strength-meter">
            <div class="strength-bar" id="strengthBar"></div>
          </div>
        </div>

        <!-- New Password Field -->
        <div class="form-group">
          <label for="password" class="form-label">
            New Password
            <span class="required">*</span>
          </label>
          <div class="password-container">
            <div class="input-with-icon">
              <svg class="input-icon" viewBox="0 0 24 24" width="20" height="20">
                <path fill="currentColor" d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
              </svg>
              <input
                id="password"
                type="password"
                name="password"
                minlength="8"
                required
                autocomplete="new-password"
                placeholder="Create a strong password"
                class="form-input password-input"
              />
            </div>
            <button
              type="button"
              class="toggle-password"
              data-target="password"
              aria-label="Toggle password visibility"
            >
              <svg class="eye-icon eye-open" viewBox="0 0 24 24" width="20" height="20">
                <path fill="currentColor" d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
              </svg>
              <svg class="eye-icon eye-closed" viewBox="0 0 24 24" width="20" height="20" style="display: none;">
                <path fill="currentColor" d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>
              </svg>
            </button>
          </div>
          <div class="form-hint">Minimum 8 characters with letters and numbers</div>
        </div>

        <!-- Confirm Password Field -->
        <div class="form-group">
          <label for="confirm" class="form-label">
            Confirm Password
            <span class="required">*</span>
          </label>
          <div class="password-container">
            <div class="input-with-icon">
              <svg class="input-icon" viewBox="0 0 24 24" width="20" height="20">
                <path fill="currentColor" d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
              </svg>
              <input
                id="confirm"
                type="password"
                name="confirm"
                minlength="8"
                required
                autocomplete="new-password"
                placeholder="Re-enter your password"
                class="form-input password-input"
              />
            </div>
            <button
              type="button"
              class="toggle-password"
              data-target="confirm"
              aria-label="Toggle password visibility"
            >
              <svg class="eye-icon eye-open" viewBox="0 0 24 24" width="20" height="20">
                <path fill="currentColor" d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
              </svg>
              <svg class="eye-icon eye-closed" viewBox="0 0 24 24" width="20" height="20" style="display: none;">
                <path fill="currentColor" d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>
              </svg>
            </button>
          </div>
          <div class="form-hint">Re-enter your password to confirm</div>
          <div class="match-indicator hidden" id="matchIndicator">
            <svg viewBox="0 0 24 24" width="16" height="16">
              <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
            <span>Passwords match</span>
          </div>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary" id="submitBtn">
          Update Password
        </button>
      </form>

      <!-- Navigation Links -->
      <div class="form-footer">
        <a href="/business/login" class="form-link">
          <svg viewBox="0 0 24 24" width="16" height="16">
            <path fill="currentColor" d="M10 17v-3H3v-4h7V7l5 5-5 5z"/>
          </svg>
          Back to Login
        </a>
      </div>
    </div>
  </div>
</div>

<style nonce="<%= typeof nonce !== 'undefined' ? nonce : '' %>">
  /* ============================================
     COMPANY COLOR THEME - Unicoporate Identity
     ============================================ */
  :root {
    /* Brand Colors */
    --unicoporate-blue: #2563EB;    /* Trust & Reliability */
    --unicoporate-purple: #7C3AED;  /* Innovation & Creativity */
    --unicoporate-green: #22C55E;   /* Growth & Success - PRIMARY */
    --unicoporate-black: #0F172A;   /* Sophistication & Premium */
    
    /* Green-Focused Color Scheme */
    --primary: var(--unicoporate-green);
    --primary-dark: #16a34a;
    --secondary: var(--unicoporate-blue);
    --accent: var(--unicoporate-purple);
    --dark: var(--unicoporate-black);
    
    /* Light Theme */
    --bg-primary: #ffffff;
    --bg-secondary: #f0fdf4;        /* Light green tint */
    --bg-surface: #ffffff;
    --bg-surface-hover: #f8fafc;
    
    --text-primary: var(--unicoporate-black);
    --text-secondary: #475569;
    --text-tertiary: #64748b;
    --text-on-color: #ffffff;
    
    --border-light: #e2e8f0;
    --border-medium: #cbd5e1;
    --border-green: #a7f3d0;
    
    --success-bg: #dcfce7;
    --success-text: #065f46;
    --error-bg: #fee2e2;
    --error-text: #991b1b;
    --warning-bg: #fef3c7;
    --warning-text: #92400e;
    --info-bg: #dbeafe;
    --info-text: #1e40af;
    
    --shadow-sm: 0 1px 2px rgba(34, 197, 94, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(34, 197, 94, 0.08);
    --shadow-lg: 0 10px 15px -3px rgba(34, 197, 94, 0.08);
    --shadow-xl: 0 20px 25px -5px rgba(34, 197, 94, 0.1);
    
    --radius-sm: 0.375rem;
    --radius-md: 0.5rem;
    --radius-lg: 0.75rem;
    --radius-xl: 1rem;
  }

  .dark-theme {
    --bg-primary: #0f172a;
    --bg-secondary: #052e16;        /* Dark green */
    --bg-surface: #1e293b;
    --bg-surface-hover: #334155;
    
    --text-primary: #f1f5f9;
    --text-secondary: #cbd5e1;
    --text-tertiary: #94a3b8;
    
    --border-light: #334155;
    --border-medium: #475569;
    --border-green: #064e3b;
    
    --success-bg: #064e3b;
    --success-text: #a7f3d0;
    --error-bg: #7f1d1d;
    --error-text: #fecaca;
    --warning-bg: #78350f;
    --warning-text: #fbbf24;
    --info-bg: #1e3a8a;
    --info-text: #93c5fd;
  }

  /* ============================================
     BASE STYLES
     ============================================ */
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    line-height: 1.5;
  }

  /* ============================================
     PAGE CONTAINER - MOBILE FIRST
     ============================================ */
  .password-reset-page {
    min-height: 100vh;
    background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
  }

  /* Background Decoration */
  .background-decoration {
    position: fixed;
    width: 100%;
    height: 100%;
    z-index: 1;
    overflow: hidden;
  }

  .decoration-circle {
    position: absolute;
    border-radius: 50%;
    filter: blur(40px);
    opacity: 0.15;
  }

  .circle-1 {
    width: 200px;
    height: 200px;
    background: var(--unicoporate-blue);
    top: -50px;
    right: -50px;
  }

  .circle-2 {
    width: 150px;
    height: 150px;
    background: var(--unicoporate-purple);
    bottom: -30px;
    left: -30px;
  }

  .circle-3 {
    width: 120px;
    height: 120px;
    background: var(--unicoporate-green);
    top: 50%;
    left: 10%;
  }

  /* ============================================
     MAIN CONTAINER - Responsive Grid
     ============================================ */
  .reset-container {
    position: relative;
    z-index: 2;
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 1200px;
    background: var(--bg-surface);
    border-radius: var(--radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow-xl);
  }

  /* For mobile: single column */
  @media (max-width: 767px) {
    .reset-container {
      flex-direction: column;
      border-radius: var(--radius-lg);
    }
  }

  /* ============================================
     INFO SECTION (Left Side)
     ============================================ */
  .reset-info {
    background: linear-gradient(135deg, var(--unicoporate-blue), var(--unicoporate-purple));
    color: var(--text-on-color);
    padding: 2rem 1.5rem;
  }

  .info-content {
    max-width: 400px;
    margin: 0 auto;
  }

  /* Brand Header */
  .brand-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 2rem;
  }

  .brand-logo {
    width: 48px;
    height: 48px;
    background: rgba(255, 255, 255, 0.15);
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(8px);
  }

  .brand-name {
    font-size: 1.5rem;
    font-weight: 800;
    margin: 0;
  }

  /* Info Welcome */
  .info-welcome {
    margin-bottom: 2rem;
  }

  .info-welcome h2 {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }

  .info-welcome p {
    font-size: 0.875rem;
    opacity: 0.9;
    line-height: 1.4;
  }

  /* Password Rules */
  .password-rules {
    margin-bottom: 2rem;
  }

  .password-rules h3 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 1rem;
  }

  .rules-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .rule-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
    font-size: 0.8125rem;
    opacity: 0.8;
  }

  .rule-item.valid {
    opacity: 1;
  }

  .rule-item.valid svg {
    fill: var(--unicoporate-green);
  }

  /* Security Tips */
  .security-tips {
    margin-bottom: 2rem;
  }

  .security-tips h3 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 1rem;
  }

  .tips-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.75rem;
  }

  .tip {
    display: flex;
    gap: 0.75rem;
    align-items: flex-start;
  }

  .tip-icon {
    width: 32px;
    height: 32px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .tip-content h4 {
    font-size: 0.8125rem;
    font-weight: 600;
    margin-bottom: 0.125rem;
  }

  .tip-content p {
    font-size: 0.75rem;
    opacity: 0.8;
    margin: 0;
  }

  /* Info Footer */
  .info-footer {
    text-align: center;
  }

  .info-footer p {
    font-size: 0.8125rem;
    opacity: 0.8;
    margin-bottom: 0.75rem;
  }

  .btn-login {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-on-color);
    padding: 0.5rem 1rem;
    border-radius: var(--radius-md);
    text-decoration: none;
    font-size: 0.8125rem;
    font-weight: 500;
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.2s ease;
  }

  .btn-login:hover {
    background: rgba(255, 255, 255, 0.2);
  }

  /* ============================================
     FORM SECTION (Right Side)
     ============================================ */
  .reset-form-container {
    padding: 2rem 1.5rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  /* Form Header */
  .form-header {
    text-align: center;
    margin-bottom: 1.5rem;
  }

  .header-icon {
    width: 64px;
    height: 64px;
    background: linear-gradient(135deg, var(--success-bg), var(--border-green));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
  }

  .header-icon svg {
    color: var(--primary);
  }

  .form-header h2 {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
  }

  .form-subtitle {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin: 0;
  }

  /* Flash Container */
  .flash-container {
    margin-bottom: 1.5rem;
  }

  .flash {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 0.875rem 1rem;
    border-radius: var(--radius-md);
    margin-bottom: 0.75rem;
    font-size: 0.8125rem;
    line-height: 1.3;
  }

  .flash-success {
    background: var(--success-bg);
    color: var(--success-text);
    border: 1px solid var(--border-green);
  }

  .flash-error {
    background: var(--error-bg);
    color: var(--error-text);
    border: 1px solid var(--error-bg);
  }

  .flash-icon {
    flex-shrink: 0;
    margin-top: 0.125rem;
  }

  .flash-content strong {
    font-weight: 600;
    display: block;
    margin-bottom: 0.125rem;
  }

  /* Reset Form */
  .reset-form {
    max-width: 400px;
    margin: 0 auto;
    width: 100%;
  }

  /* Password Strength */
  .password-strength-container {
    background: var(--bg-surface-hover);
    border-radius: var(--radius-md);
    padding: 1rem;
    margin-bottom: 1.5rem;
    border: 1px solid var(--border-light);
  }

  .strength-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .strength-label {
    font-size: 0.8125rem;
    font-weight: 600;
    color: var(--text-secondary);
  }

  .strength-value {
    font-size: 0.8125rem;
    font-weight: 700;
    color: var(--error-text);
  }

  .strength-meter {
    height: 6px;
    background: var(--border-light);
    border-radius: 3px;
    overflow: hidden;
  }

  .strength-bar {
    height: 100%;
    width: 20%;
    background: var(--error-text);
    border-radius: 3px;
    transition: all 0.3s ease;
  }

  /* Form Group */
  .form-group {
    margin-bottom: 1.25rem;
  }

  .form-label {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    margin-bottom: 0.5rem;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-primary);
  }

  .required {
    color: var(--error-text);
  }

  .password-container {
    position: relative;
  }

  .input-with-icon {
    position: relative;
  }

  .input-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-tertiary);
  }

  .form-input {
    width: 100%;
    padding: 0.875rem 3.5rem 0.875rem 3rem;
    font-size: 1rem;
    background: var(--bg-surface);
    border: 2px solid var(--border-light);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    transition: all 0.2s ease;
  }

  .password-input {
    font-size: 1.125rem;
    letter-spacing: 0.5px;
  }

  .form-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.15);
  }

  .form-input::placeholder {
    color: var(--text-tertiary);
    font-size: 0.875rem;
  }

  /* Toggle Password Button - FIXED */
  .toggle-password {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--text-tertiary);
    cursor: pointer;
    padding: 0.25rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.2s ease;
  }

  .toggle-password:hover {
    color: var(--primary);
  }

  .eye-icon {
    width: 20px;
    height: 20px;
  }

  .form-hint {
    margin-top: 0.5rem;
    font-size: 0.75rem;
    color: var(--text-secondary);
  }

  /* Match Indicator */
  .match-indicator {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.5rem;
    padding: 0.5rem 0.75rem;
    background: var(--success-bg);
    border-radius: var(--radius-sm);
    font-size: 0.75rem;
    color: var(--success-text);
  }

  .match-indicator.hidden {
    display: none;
  }

  /* Buttons */
  .btn {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.875rem 1.5rem;
    font-size: 0.9375rem;
    font-weight: 600;
    border: none;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    height: 44px;
    width: 100%;
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: var(--text-on-color);
  }

  .btn-primary:hover:not(:disabled) {
    background: linear-gradient(135deg, var(--primary-dark), #15803d);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(34, 197, 94, 0.2);
  }

  .btn-primary:active:not(:disabled) {
    transform: translateY(0);
  }

  .btn-primary:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  /* Form Footer */
  .form-footer {
    text-align: center;
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--border-light);
  }

  .form-link {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    color: var(--secondary);
    text-decoration: none;
    font-size: 0.8125rem;
    font-weight: 500;
  }

  .form-link:hover {
    color: var(--accent);
    text-decoration: underline;
  }

  /* ============================================
     RESPONSIVE DESIGN
     ============================================ */
  
  /* Mobile (Hisense U50 Lite - 360px) */
  @media (max-width: 360px) {
    .password-reset-page {
      padding: 0.5rem;
    }
    
    .reset-info,
    .reset-form-container {
      padding: 1.5rem 1.25rem;
    }
    
    .brand-logo {
      width: 40px;
      height: 40px;
    }
    
    .brand-name {
      font-size: 1.25rem;
    }
    
    .info-welcome h2,
    .form-header h2 {
      font-size: 1.25rem;
    }
    
    .header-icon {
      width: 56px;
      height: 56px;
    }
    
    .form-input {
      padding: 0.75rem 3.25rem 0.75rem 2.75rem;
      font-size: 0.9375rem;
    }
    
    .password-input {
      font-size: 1.0625rem;
    }
    
    .btn {
      padding: 0.75rem 1.25rem;
      height: 42px;
      font-size: 0.875rem;
    }
    
    .tips-grid {
      grid-template-columns: 1fr;
    }
  }

  /* Tablet (768px and up) */
  @media (min-width: 768px) {
    .reset-container {
      flex-direction: row;
      min-height: 600px;
    }
    
    .reset-info {
      flex: 1;
      padding: 3rem 2rem;
    }
    
    .reset-form-container {
      flex: 1;
      padding: 3rem 2rem;
    }
    
    .info-content {
      max-width: 320px;
    }
    
    .tips-grid {
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }
  }

  /* Desktop (1024px and up) */
  @media (min-width: 1024px) {
    .reset-info {
      padding: 4rem 3rem;
    }
    
    .reset-form-container {
      padding: 4rem 3rem;
    }
    
    .info-content {
      max-width: 380px;
    }
    
    .brand-name {
      font-size: 1.75rem;
    }
    
    .info-welcome h2 {
      font-size: 1.75rem;
    }
    
    .form-header h2 {
      font-size: 1.75rem;
    }
  }

  /* ============================================
     UTILITIES
     ============================================ */
  .hidden {
    display: none !important;
  }

  /* ============================================
     ACCESSIBILITY
     ============================================ */
  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  :focus-visible {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
  }
</style>

<script nonce="<%= typeof nonce !== 'undefined' ? nonce : '' %>">
  document.addEventListener('DOMContentLoaded', function() {
    console.log('âœ… Business password reset page loaded');
    
    // Elements
    const passwordInput = document.getElementById('password');
    const confirmInput = document.getElementById('confirm');
    const strengthBar = document.getElementById('strengthBar');
    const strengthValue = document.getElementById('strengthValue');
    const matchIndicator = document.getElementById('matchIndicator');
    const submitBtn = document.getElementById('submitBtn');
    const resetForm = document.getElementById('resetForm');
    
    // Rule elements
    const ruleLength = document.getElementById('rule-length');
    const ruleUppercase = document.getElementById('rule-uppercase');
    const ruleLowercase = document.getElementById('rule-lowercase');
    const ruleNumber = document.getElementById('rule-number');
    const ruleMatch = document.getElementById('rule-match');

    // ============================================
    // PASSWORD TOGGLE FUNCTIONALITY - FIXED
    // ============================================
    const toggleButtons = document.querySelectorAll('.toggle-password');
    
    toggleButtons.forEach(button => {
      button.addEventListener('click', function() {
        const targetId = this.getAttribute('data-target');
        const input = document.getElementById(targetId);
        const openEye = this.querySelector('.eye-open');
        const closedEye = this.querySelector('.eye-closed');
        
        if (input.type === 'password') {
          input.type = 'text';
          openEye.style.display = 'none';
          closedEye.style.display = 'block';
          this.setAttribute('aria-label', 'Hide password');
        } else {
          input.type = 'password';
          openEye.style.display = 'block';
          closedEye.style.display = 'none';
          this.setAttribute('aria-label', 'Show password');
        }
      });
    });

    // ============================================
    // PASSWORD STRENGTH CALCULATION
    // ============================================
    function calculateStrength(password) {
      let strength = 0;
      
      // Length check
      if (password.length >= 8) strength += 20;
      if (password.length >= 12) strength += 10;
      
      // Character type checks
      if (/[a-z]/.test(password)) strength += 20;
      if (/[A-Z]/.test(password)) strength += 20;
      if (/[0-9]/.test(password)) strength += 20;
      if (/[^A-Za-z0-9]/.test(password)) strength += 10;
      
      return Math.min(strength, 100);
    }

    function updateStrength(password) {
      const strength = calculateStrength(password);
      strengthBar.style.width = strength + '%';
      
      // Update rules
      updateRule(ruleLength, password.length >= 8);
      updateRule(ruleUppercase, /[A-Z]/.test(password));
      updateRule(ruleLowercase, /[a-z]/.test(password));
      updateRule(ruleNumber, /[0-9]/.test(password));
      
      // Update strength value and color
      let strengthText = 'Weak';
      let color = '#ef4444'; // red
      
      if (strength >= 80) {
        strengthText = 'Strong';
        color = '#22c55e'; // green
      } else if (strength >= 60) {
        strengthText = 'Good';
        color = '#f59e0b'; // amber
      } else if (strength >= 40) {
        strengthText = 'Fair';
        color = '#f59e0b';
      }
      
      strengthValue.textContent = strengthText;
      strengthValue.style.color = color;
      strengthBar.style.backgroundColor = color;
    }

    function updateRule(ruleElement, isValid) {
      if (isValid) {
        ruleElement.classList.add('valid');
        ruleElement.querySelector('svg').innerHTML = `
          <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        `;
      } else {
        ruleElement.classList.remove('valid');
        ruleElement.querySelector('svg').innerHTML = `
          <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
        `;
      }
    }

    // ============================================
    // PASSWORD MATCH VALIDATION
    // ============================================
    function updateMatch() {
      const password = passwordInput.value;
      const confirm = confirmInput.value;
      
      if (!password || !confirm) {
        matchIndicator.classList.add('hidden');
        return;
      }
      
      if (password === confirm) {
        matchIndicator.classList.remove('hidden');
        matchIndicator.style.background = 'var(--success-bg)';
        matchIndicator.style.color = 'var(--success-text)';
        matchIndicator.querySelector('span').textContent = 'Passwords match';
        updateRule(ruleMatch, true);
      } else {
        matchIndicator.classList.remove('hidden');
        matchIndicator.style.background = 'var(--error-bg)';
        matchIndicator.style.color = 'var(--error-text)';
        matchIndicator.querySelector('span').textContent = 'Passwords do not match';
        updateRule(ruleMatch, false);
      }
    }

    // ============================================
    // FORM VALIDATION
    // ============================================
    function validateForm() {
      const password = passwordInput.value;
      const confirm = confirmInput.value;
      const errors = [];

      if (!password || password.length < 8) {
        errors.push('Password must be at least 8 characters long');
      }
      
      if (!/[A-Z]/.test(password)) {
        errors.push('Password must contain at least one uppercase letter');
      }
      
      if (!/[a-z]/.test(password)) {
        errors.push('Password must contain at least one lowercase letter');
      }
      
      if (!/[0-9]/.test(password)) {
        errors.push('Password must contain at least one number');
      }
      
      if (password !== confirm) {
        errors.push('Passwords do not match');
      }

      return errors;
    }

    // ============================================
    // EVENT LISTENERS
    // ============================================
    if (passwordInput) {
      passwordInput.addEventListener('input', function() {
        updateStrength(this.value);
        updateMatch();
      });
    }

    if (confirmInput) {
      confirmInput.addEventListener('input', updateMatch);
    }

    if (resetForm) {
      resetForm.addEventListener('submit', function(e) {
        const errors = validateForm();
        
        if (errors.length > 0) {
          e.preventDefault();
          showError(errors[0]);
          return;
        }
        
        // Disable button and show loading
        submitBtn.disabled = true;
        submitBtn.innerHTML = 'Updating...';
      });
    }

    // ============================================
    // HELPER FUNCTIONS
    // ============================================
    function showError(message) {
      // Remove existing error flashes
      const existingErrors = document.querySelectorAll('.flash-error');
      existingErrors.forEach(error => error.remove());
      
      const errorDiv = document.createElement('div');
      errorDiv.className = 'flash flash-error';
      errorDiv.innerHTML = `
        <svg class="flash-icon" viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
        </svg>
        <div class="flash-content">
          <strong>Error</strong>
          <p>${message}</p>
        </div>
      `;
      
      const flashContainer = document.querySelector('.flash-container');
      if (flashContainer) {
        flashContainer.appendChild(errorDiv);
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
          errorDiv.remove();
        }, 5000);
      }
    }

    // Auto-focus password input
    if (passwordInput) {
      setTimeout(() => {
        passwordInput.focus();
      }, 100);
    }
  });
</script>