<!-- views/500.ejs -->
<%
const pageStyles = `
  /* ‚úÖ Brand Color System */
  :root {
    --blue: #2563EB;
    --blue-dark: #1d4ed8;
    --purple: #7C3AED;
    --purple-dark: #6d28d9;
    --green: #22C55E;
    --green-dark: #16a34a;
    --black: #0F172A;
    
    --gray-50: #f8fafc;
    --gray-100: #f1f5f9;
    --gray-200: #e2e8f0;
    --gray-300: #cbd5e1;
    --gray-400: #94a3b8;
    --gray-500: #64748b;
    --gray-600: #475569;
    --gray-700: #334155;
    --gray-800: #1e293b;
    --gray-900: #0f172a;
    
    --danger: #dc2626;
    --danger-dark: #b91c1c;
    --danger-light: #fee2e2;
    
    --warning: #f59e0b;
    --warning-dark: #d97706;
    --warning-light: #fef3c7;
    
    --radius-sm: 0.375rem;
    --radius-md: 0.5rem;
    --radius-lg: 0.75rem;
    --radius-xl: 1rem;
    
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .dark-theme {
    --bg-primary: var(--black);
    --bg-secondary: var(--gray-800);
    --text-primary: var(--gray-100);
    --text-secondary: var(--gray-300);
    --border: var(--gray-700);
    --danger-bg: rgba(220, 38, 38, 0.15);
    --warning-bg: rgba(245, 158, 11, 0.15);
  }

  :root {
    --bg-primary: var(--gray-50);
    --bg-secondary: white;
    --text-primary: var(--gray-900);
    --text-secondary: var(--gray-600);
    --border: var(--gray-200);
    --danger-bg: var(--danger-light);
    --warning-bg: var(--warning-light);
  }

  /* ‚úÖ 500 Page Container */
  .server-error-page {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    background: linear-gradient(135deg, var(--green) 0%, #16a34a 100%);
    position: relative;
    overflow: hidden;
  }

  .server-error-page::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
      radial-gradient(circle at 10% 10%, rgba(220, 38, 38, 0.1) 0%, transparent 40%),
      radial-gradient(circle at 90% 90%, rgba(245, 158, 11, 0.08) 0%, transparent 40%);
    pointer-events: none;
    animation: pulseBg 4s ease-in-out infinite;
  }

  .error-card {
    background: var(--bg-secondary);
    border-radius: var(--radius-xl);
    padding: 2rem 1.5rem;
    max-width: 520px;
    width: 100%;
    text-align: center;
    position: relative;
    z-index: 1;
    border: 1px solid var(--border);
    box-shadow: var(--shadow-lg);
    animation: slideUp 0.6s ease-out;
    border-top: 4px solid var(--danger);
  }

  /* ‚úÖ Error Code Display */
  .error-code {
    font-size: 4rem;
    font-weight: 800;
    line-height: 1;
    margin-bottom: 0.5rem;
    color: var(--danger);
    position: relative;
    display: inline-block;
    font-family: monospace;
  }

  .error-code::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 3px;
    background: linear-gradient(to right, var(--danger), var(--warning));
    border-radius: 2px;
  }

  /* ‚úÖ Error Message */
  .error-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 1rem 0 0.5rem;
  }

  .error-description {
    color: var(--text-secondary);
    font-size: 0.95rem;
    line-height: 1.5;
    margin-bottom: 1.5rem;
  }

  /* ‚úÖ Illustration */
  .error-illustration {
    margin: 1.5rem auto;
    position: relative;
    width: 160px;
    height: 120px;
  }

  .server-icon {
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, var(--danger), var(--warning));
    border-radius: var(--radius-lg);
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 2.5rem;
    animation: serverPulse 2s ease-in-out infinite;
  }

  .server-pulse {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 120px;
    height: 120px;
    border: 2px solid var(--danger);
    border-radius: 50%;
    opacity: 0;
    animation: pulseRing 2s ease-out infinite;
  }

  .server-pulse:nth-child(2) {
    animation-delay: 0.5s;
  }

  .server-pulse:nth-child(3) {
    animation-delay: 1s;
  }

  /* ‚úÖ Status Information */
  .status-info {
    background: var(--danger-bg);
    border-radius: var(--radius-lg);
    padding: 1rem;
    margin: 1.5rem 0;
    border-left: 4px solid var(--danger);
    text-align: left;
  }

  .status-title {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--danger);
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .status-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .status-item {
    font-size: 0.85rem;
    color: var(--text-secondary);
    padding: 0.25rem 0;
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
  }

  .status-item::before {
    content: '‚Ä¢';
    color: var(--danger);
    flex-shrink: 0;
  }

  /* ‚úÖ Actions Section */
  .actions-section {
    margin: 2rem 0 1.5rem;
  }

  .action-buttons {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
  }

  .action-button {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: var(--green);
    color: white;
    border-radius: var(--radius-md);
    text-decoration: none;
    font-weight: 600;
    font-size: 0.875rem;
    transition: var(--transition);
    border: none;
    cursor: pointer;
    width: 100%;
  }

  .action-button:hover {
    background: var(--green-dark);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .action-button.secondary {
    background: var(--blue);
  }

  .action-button.secondary:hover {
    background: var(--blue-dark);
  }

  .action-button.danger {
    background: var(--danger);
  }

  .action-button.danger:hover {
    background: var(--danger-dark);
  }

  .action-button.outline {
    background: transparent;
    border: 2px solid var(--border);
    color: var(--text-primary);
  }

  .action-button.outline:hover {
    background: var(--bg-primary);
    border-color: var(--purple);
  }

  /* ‚úÖ Technical Info (optional) */
  .technical-info {
    background: var(--warning-bg);
    border-radius: var(--radius-lg);
    padding: 1rem;
    margin: 1.5rem 0;
    border-left: 4px solid var(--warning);
    font-family: monospace;
    font-size: 0.75rem;
    color: var(--text-secondary);
    text-align: left;
    max-height: 150px;
    overflow-y: auto;
    display: none; /* Hidden by default, can be toggled */
  }

  .technical-info pre {
    margin: 0;
    white-space: pre-wrap;
    word-break: break-all;
  }

  .toggle-tech {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: none;
    border: none;
    color: var(--warning);
    font-size: 0.8rem;
    cursor: pointer;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: var(--transition);
  }

  .toggle-tech:hover {
    background: var(--warning-bg);
  }

  /* ‚úÖ Support Links */
  .support-links {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 1.5rem;
    flex-wrap: wrap;
  }

  .support-link {
    color: var(--text-secondary);
    font-size: 0.8rem;
    text-decoration: none;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    transition: var(--transition);
  }

  .support-link:hover {
    color: var(--blue);
    background: var(--bg-primary);
  }

  /* ‚úÖ Footer */
  .error-footer {
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border);
  }

  .footer-text {
    color: var(--text-secondary);
    font-size: 0.75rem;
    line-height: 1.4;
  }

  .footer-link {
    color: var(--blue);
    text-decoration: none;
    font-weight: 500;
  }

  .footer-link:hover {
    text-decoration: underline;
  }

  /* ‚úÖ Animations */
  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes serverPulse {
    0%, 100% {
      transform: translateX(-50%) scale(1);
    }
    50% {
      transform: translateX(-50%) scale(1.05);
    }
  }

  @keyframes pulseRing {
    0% {
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.8);
    }
    50% {
      opacity: 0.3;
    }
    100% {
      opacity: 0;
      transform: translate(-50%, -50%) scale(1.5);
    }
  }

  @keyframes pulseBg {
    0%, 100% {
      opacity: 0.8;
    }
    50% {
      opacity: 1;
    }
  }

  /* ‚úÖ Mobile Optimizations */
  @media (max-width: 480px) {
    .server-error-page {
      padding: 0.75rem;
    }
    
    .error-card {
      padding: 1.5rem 1rem;
    }
    
    .error-code {
      font-size: 3.5rem;
    }
    
    .error-title {
      font-size: 1.25rem;
    }
    
    .error-description {
      font-size: 0.875rem;
    }
    
    .error-illustration {
      width: 140px;
      height: 100px;
    }
    
    .server-icon {
      width: 80px;
      height: 80px;
      font-size: 2rem;
    }
    
    .action-button {
      padding: 0.75rem;
      font-size: 0.85rem;
    }
    
    .status-info {
      padding: 0.875rem;
    }
  }

  /* ‚úÖ Very Small Screens */
  @media (max-width: 360px) {
    .error-card {
      padding: 1.25rem 0.75rem;
    }
    
    .error-code {
      font-size: 3rem;
    }
    
    .action-buttons {
      gap: 0.5rem;
    }
    
    .error-illustration {
      width: 120px;
      height: 80px;
      margin: 1rem auto;
    }
    
    .server-icon {
      width: 70px;
      height: 70px;
    }
  }

  /* ‚úÖ Tablet Optimization */
  @media (min-width: 481px) and (max-width: 768px) {
    .error-card {
      max-width: 450px;
    }
  }

  /* ‚úÖ Reduced Motion */
  @media (prefers-reduced-motion: reduce) {
    .error-card,
    .server-icon,
    .server-pulse {
      animation: none;
    }
    
    .action-button:hover {
      transform: none;
    }
    
    .server-error-page::before {
      animation: none;
    }
  }
`;

const pageScripts = `
  document.addEventListener('DOMContentLoaded', function() {
    // Retry button functionality
    const retryButton = document.querySelector('.action-button[data-action="retry"]');
    if (retryButton) {
      retryButton.addEventListener('click', function(e) {
        e.preventDefault();
        retryButton.innerHTML = '<span>‚è≥</span> Retrying...';
        retryButton.disabled = true;
        
        // Try to reload the previous page or home
        setTimeout(() => {
          if (window.history.length > 1) {
            window.location.reload();
          } else {
            window.location.href = '/';
          }
        }, 1500);
      });
    }
    
    // Report error button
    const reportButton = document.querySelector('.action-button[data-action="report"]');
    if (reportButton) {
      reportButton.addEventListener('click', function() {
        const currentUrl = encodeURIComponent(window.location.href);
        const timestamp = new Date().toISOString();
        const userAgent = encodeURIComponent(navigator.userAgent);
        
        const mailtoLink = \`mailto:support@unicoporate.com?subject=500 Error Report&body=URL: \${currentUrl}%0D%0ATime: \${timestamp}%0D%0ABrowser: \${userAgent}%0D%0A%0D%0APlease describe what you were doing when the error occurred:\`;
        window.location.href = mailtoLink;
      });
    }
    
    // Toggle technical info
    const toggleTech = document.querySelector('.toggle-tech');
    const techInfo = document.querySelector('.technical-info');
    
    if (toggleTech && techInfo) {
      toggleTech.addEventListener('click', function() {
        if (techInfo.style.display === 'block') {
          techInfo.style.display = 'none';
          toggleTech.innerHTML = '<span>üîß</span> Show Technical Details';
        } else {
          techInfo.style.display = 'block';
          toggleTech.innerHTML = '<span>üîß</span> Hide Technical Details';
          
          // Add some technical info (in production, this could come from the server)
          const errorData = {
            timestamp: new Date().toISOString(),
            url: window.location.href,
            userAgent: navigator.userAgent,
            errorCode: '500',
            errorType: 'Internal Server Error',
            requestId: Math.random().toString(36).substr(2, 9).toUpperCase()
          };
          
          techInfo.innerHTML = \`<pre>\${JSON.stringify(errorData, null, 2)}</pre>\`;
        }
      });
    }
    
    // Check server status
    const checkStatusButton = document.querySelector('.action-button[data-action="status"]');
    if (checkStatusButton) {
      checkStatusButton.addEventListener('click', async function() {
        checkStatusButton.innerHTML = '<span>‚è≥</span> Checking...';
        checkStatusButton.disabled = true;
        
        try {
          // Try to fetch a simple endpoint to check if server is back
          const response = await fetch('/api/health', { method: 'HEAD' });
          
          if (response.ok) {
            // Server is back online
            alert('‚úÖ Server is responding! Page will refresh...');
            window.location.reload();
          } else {
            throw new Error('Server still down');
          }
        } catch (error) {
          alert('‚ö†Ô∏è Server is still unavailable. Please try again in a few minutes.');
          checkStatusButton.innerHTML = '<span>üîÑ</span> Check Server Status';
          checkStatusButton.disabled = false;
        }
      });
    }
    
    // Countdown for auto-retry
    let retryCountdown = 30;
    const countdownElement = document.querySelector('.retry-countdown');
    
    if (countdownElement) {
      const countdownInterval = setInterval(() => {
        retryCountdown--;
        countdownElement.textContent = retryCountdown;
        
        if (retryCountdown <= 0) {
          clearInterval(countdownInterval);
          window.location.reload();
        }
      }, 1000);
    }
    
    // Track error for analytics
    console.error('500 Error - Internal Server Error:', {
      path: window.location.pathname,
      timestamp: new Date().toISOString(),
      referrer: document.referrer
    });
    
    // Service worker offline check
    if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
      console.log('Service Worker is active');
      
      // Check if we're offline
      if (!navigator.onLine) {
        const offlineMessage = document.createElement('div');
        offlineMessage.style.background = 'var(--warning-bg)';
        offlineMessage.style.color = 'var(--warning-dark)';
        offlineMessage.style.padding = '0.5rem';
        offlineMessage.style.borderRadius = 'var(--radius-md)';
        offlineMessage.style.marginTop = '1rem';
        offlineMessage.style.fontSize = '0.8rem';
        offlineMessage.innerHTML = '‚ö†Ô∏è You appear to be offline. Some features may be unavailable.';
        
        document.querySelector('.status-info')?.appendChild(offlineMessage);
      }
    }
    
    // Add some visual feedback for server pulses
    const serverIcon = document.querySelector('.server-icon');
    if (serverIcon) {
      serverIcon.addEventListener('animationiteration', () => {
        serverIcon.style.boxShadow = '0 0 20px rgba(220, 38, 38, 0.3)';
        setTimeout(() => {
          serverIcon.style.boxShadow = 'none';
        }, 500);
      });
    }
  });
`;
%>

<!-- ‚úÖ Inject Styles -->
<style nonce="<%= nonce %>">
  <%= pageStyles %>
</style>

<!-- ‚úÖ 500 Error Page Content -->
<div class="server-error-page">
  <div class="error-card">
    <!-- Error Code -->
    <div class="error-code">500</div>
    
    <!-- Error Message -->
    <h1 class="error-title">Internal Server Error</h1>
    <p class="error-description">
      Our servers encountered an unexpected condition. Our team has been notified and is working to resolve the issue.
    </p>
    
    <!-- Illustration -->
    <div class="error-illustration">
      <div class="server-icon">‚ö†Ô∏è</div>
      <div class="server-pulse"></div>
      <div class="server-pulse"></div>
      <div class="server-pulse"></div>
    </div>
    
    <!-- Status Information -->
    <div class="status-info">
      <div class="status-title">
        <span>üî¥</span>
        Service Status
      </div>
      <ul class="status-list">
        <li class="status-item">Our servers are experiencing technical difficulties</li>
        <li class="status-item">The issue has been logged and our team is investigating</li>
        <li class="status-item">Estimated resolution time: <strong>10-15 minutes</strong></li>
        <li class="status-item">Auto-retry in <span class="retry-countdown">30</span> seconds</li>
      </ul>
    </div>
    
    <!-- Action Buttons -->
    <div class="actions-section">
      <div class="action-buttons">
        <button class="action-button" data-action="retry">
          <span>üîÑ</span>
          Retry Now
        </button>
        
        <a href="/" class="action-button secondary">
          <span>üè†</span>
          Go to Homepage
        </a>
        
        <button class="action-button outline" data-action="report">
          <span>üìß</span>
          Report This Error
        </button>
        
        <button class="action-button outline" data-action="status">
          <span>üìä</span>
          Check Server Status
        </button>
      </div>
      
      <!-- Technical Info Toggle -->
      <button class="toggle-tech">
        <span>üîß</span>
        Show Technical Details
      </button>
      
      <!-- Technical Information (Hidden by default) -->
      <div class="technical-info"></div>
    </div>
    
    <!-- Support Links -->
    <div class="support-links">
      <a href="/contact" class="support-link">Contact Support</a>
      <a href="/status" class="support-link">Service Status</a>
      <a href="/about" class="support-link">About Us</a>
      <a href="https://status.unicoporate.com" target="_blank" class="support-link" rel="noopener">Status Page</a>
    </div>
    
    <!-- Footer -->
    <div class="error-footer">
      <p class="footer-text">
        ¬© <%= new Date().getFullYear() %> Unicoporate.com. 
        For urgent assistance: <a href="mailto:support@unicoporate.com" class="footer-link">support@unicoporate.com</a>
      </p>
      <p class="footer-text" style="margin-top: 0.5rem; font-size: 0.7rem;">
        Error ID: <code style="color: var(--text-secondary); font-family: monospace;">
          <%= typeof req !== 'undefined' ? (req.id || Math.random().toString(36).substr(2, 9).toUpperCase()) : 'N/A' %>
        </code>
      </p>
    </div>
  </div>
</div>

<!-- ‚úÖ Inject Scripts -->
<script nonce="<%= nonce %>">
  <%= pageScripts %>
</script>